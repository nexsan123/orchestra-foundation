# 🔴 永乐大典 · 主档案

> 版本：v2.0
> 更新：2026-02-06
> 定位：铁律清单 + 统一错误记录

---

## 一、强制规则（每次执行前必读）

| # | 规则 | 说明 |
|---|------|------|
| R1 | 扫描必须经由巡按御史 | 禁止自行"扫描"或凭推测描述项目 |
| R2 | 记录必须经由史官 | 所有对话、决策、事件必须记录 |
| R3 | 用户确认才生效 | 重要决策必须经用户确认 |
| R4 | 执行前必读本文件 | 每次执行前必读铁律清单 |

---

## 二、核心铁律速查

### CK · 检查验证

| 编号 | 铁律 |
|------|------|
| CK-01 | grep 空输出 ≠ 不存在，必须 view 确认 |
| CK-02 | 报告"缺少"前必须展示 view 证据 |
| CK-03 | 流程：grep 定位 → view 确认 → 再报告 |

### V · 反虚报

| 编号 | 铁律 |
|------|------|
| V-01 | "已完成"必须附带真实输出证据 |
| V-02 | 禁止"应该"、"理论上"等模糊词 |
| V-03 | 每个验证步骤必须有证据要求 |
| V-04 | 每条铁律必须能被检测 |

### CA · Code Agent 核心铁律

| 编号 | 铁律 |
|------|------|
| CA-11 | 禁止虚报：声称完成必须真完成 |
| CA-12 | 代码必执行 + 必须输出证据 |
| CA-14 | 检查必有证据 |
| CA-16 | Phase A 必须等 Test Agent 验收 |
| CA-17 | 契约锁定后不可改（除非走变更流程） |
| CA-21 | 阻断必处理：scan_code_quality_v2 阻断（grade D/F）必须处理 |

---

## 三、详细档案索引

| 类型 | 位置 | 说明 |
|------|------|------|
| Agent 铁律 | `{agent}/AGENT.md` | 完整铁律和流程 |
| Agent 铁律速查 | `{agent}/CLAUDE.md` | 核心铁律速查 |
| Skill 铁律 | `{skill}/SKILL.md` | 完整铁律和接口 |
| Skill 铁律速查 | `{skill}/CLAUDE.md` | 核心铁律速查 |
| 架构规范 | `ARCHITECTURE.md` | 组件关系和标准 |
| 地基规范 | `FOUNDATION.md` | 项目规范和 Tier |

---

## 四、错误记录规则 🆕

### 4.1 两级结构

```
主档案（本文件）
├── 统一记录所有组件的错误
├── 按组件分类索引
└── 便于查找和统计

组件 CLAUDE.md
├── 只保留核心铁律速查
├── 不记录错误
└── 错误指向本文件
```

### 4.2 错误记录格式

```markdown
### [日期] 组件名 #错误标签

**场景**：什么情况下犯的错
**错误**：具体错误描述
**后果**：对用户造成了什么影响
**教训**：今后如何避免
**状态**：待修复 / ✅ 已修复（版本号）
```

### 4.3 错误标签

| 标签 | 含义 | 适用范围 |
|------|------|----------|
| `#虚报` | 声称完成实际未完成 | Agent/Skill |
| `#空转` | 反复修改无实质进展 | Agent |
| `#越权` | 超出指令范围操作 | Agent |
| `#漏检` | 跳过验证步骤 | Agent/Skill |
| `#甩锅` | 推卸责任给其他环节 | Agent |
| `#敷衍` | 表面完成实际糊弄 | Agent/Skill |
| `#失忆` | 忘记之前的指令或约定 | Agent/Skill |
| `#阿谀` | 拍马屁、不敢直言 | 司礼监专用 |
| `#误解` | 误解皇上的意思 | 司礼监专用 |
| `#接口缺失` | 调用了不存在的接口 | Skill |
| `#版本不同步` | 文档版本与实际不一致 | 所有 |

---

## 五、错误历史记录（统一归档）

### 5.1 Agent 错误

#### Conductor Agent

（尚无记录）

#### Plan Agent

（尚无记录）

#### Spec Agent

（尚无记录）

#### Code Agent

（尚无记录）

#### Test Agent

（尚无记录）

#### Review Agent

（尚无记录）

---

### 5.2 Skill 错误

#### 司礼监 (imperial-scribe)

**[2026-01-27] #阿谀 #失忆**
- **场景**：皇上说"传司礼监"时
- **错误**：未按规矩称呼皇上，未使用规定格式
- **后果**：皇上指出"都没有叫我皇上"
- **教训**：必须严格按照 SKILL.md 规矩执行
- **状态**：✅ 已修复 v2.0

**[2026-02-02] #失忆 #漏检**
- **场景**：皇上说"传司礼监"审查
- **错误**：与 2026-01-27 错误完全相同，重蹈覆辙
- **后果**：皇上质问"你确定启动了司礼监skill吗？"
- **教训**：必须回读历史错误，不可重复犯错
- **状态**：✅ 已修复 v2.5

#### 史官 (dialogue-archivist)

（尚无记录）

#### 巡按御史 (project-scanner)

（尚无记录）

#### 将作监 (module-planner)

（尚无记录）

#### 契约守卫 (contract-guardian)

（尚无记录）

#### 其他 Skill

（尚无记录）

---

## 六、待修复问题汇总

| # | 组件 | 问题 | 发现日期 | 状态 |
|---|------|------|----------|------|
| - | - | - | - | - |

---

## 七、版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v2.0 | 2026-02-06 | 重构：建立两级结构，统一错误记录到主档案 |
| v1.0 | 初始 | 铁律清单 |

---

**防虚报审查规则**：每个验证步骤是否有强制证据要求、每个完成声明是否有可验证标准、每条铁律是否能被检测。
