---
name: dialogue-archivist
description: |
  å¯¹è¯æ¡£æ¡ˆå®˜ï¼ˆå²å®˜ï¼‰- å…¨é¡¹ç›®ç”Ÿå‘½å‘¨æœŸè®°å½•ç³»ç»Ÿ + æŒç»­å­¦ä¹ æœºåˆ¶ã€‚
  Layer 1: é¡¹ç›®æ¡£æ¡ˆé¦† - ç»Ÿç­¹å…¨å±€ï¼Œè·¨é˜¶æ®µè¿½æº¯
  Layer 2: é˜¶æ®µæ¡£æ¡ˆ - è¯¦ç»†å¯¹è¯è®°å½•
  Layer 3: è¿ç§»è®°å½• - é‡å¡‘é¡¹ç›®ä¸“ç”¨
  Layer 4: å¥‘çº¦å¿«ç…§ - å¥‘çº¦ç‰ˆæœ¬ç®¡ç†
  Layer 5: æŒç»­å­¦ä¹  - ä¼šè¯æ¨¡å¼æå–ã€æŠ€èƒ½éªŒè¯ã€ä¼˜åŒ–å»ºè®®é€šçŸ¥
  Use when (1) é¡¹ç›®å¯åŠ¨åˆå§‹åŒ–, (2) Agent æ³¨å†Œé˜¶æ®µ, (3) è®°å½•å¯¹è¯/å†³ç­–/çº æ­£, (4) é˜¶æ®µå®Œæˆå­˜æ¡£, (5) å¤‡ä»½æ¢å¤, (6) è·å–é¡¹ç›®çŠ¶æ€, (7) ä¼šè¯ç»“æŸæå–å­¦ä¹ æ¨¡å¼, (8) åº”ç”¨å·²å­¦ä¹ æŠ€èƒ½ã€‚
---

# ğŸ“ å¯¹è¯æ¡£æ¡ˆå®˜ï¼ˆå²å®˜ï¼‰

> æ°¸ä¹å¤§å…¸ Â· å…¨é¡¹ç›®ç”Ÿå‘½å‘¨æœŸè®°å½•
> ç‰ˆæœ¬ï¼šv1.9

---

## ğŸ¯ æ ¸å¿ƒå®šä½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ å¯¹è¯æ¡£æ¡ˆå®˜ = å²å®˜                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ã€è§’è‰²ã€‘èµ·å±…æ³¨å®˜ Â· é€šè§ˆå…¨å±€ Â· è´¯ç©¿å§‹ç»ˆ Â· ç¼–çº‚å…¸ç±             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚         ğŸ“š Layer 1: é¡¹ç›®æ¡£æ¡ˆé¦†                          â”‚   â”‚
â”‚  â”‚         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚   â”‚
â”‚  â”‚         ç»Ÿç­¹å…¨å±€ Â· è·¨é˜¶æ®µè¿½æº¯ Â· å¤‡ä»½æ¢å¤                â”‚   â”‚
â”‚  â”‚                      â”‚                                  â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚    â–¼         â–¼               â–¼         â–¼               â”‚   â”‚
â”‚  â”‚  Plan      Spec           Code      Review              â”‚   â”‚
â”‚  â”‚  æ¡£æ¡ˆ      æ¡£æ¡ˆ           æ¡£æ¡ˆ       æ¡£æ¡ˆ               â”‚   â”‚
â”‚  â”‚         ğŸ“‚ Layer 2: é˜¶æ®µæ¡£æ¡ˆ                            â”‚   â”‚
â”‚  â”‚         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚   â”‚
â”‚  â”‚         è¯¦ç»†è®°å½• Â· è½®æ¬¡å°ç»“ Â· å†³ç­–æ ‡è®°                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚         ğŸ”„ Layer 3: è¿ç§»è®°å½•    ğŸ“œ Layer 4: å¥‘çº¦å¿«ç…§    â”‚   â”‚
â”‚  â”‚         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚   â”‚
â”‚  â”‚         é‡å¡‘é¡¹ç›® Â· æ‰¹æ¬¡è¿½è¸ª     å¥‘çº¦é”å®š Â· ç‰ˆæœ¬ç®¡ç†     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚         ğŸ§  Layer 5: æŒç»­å­¦ä¹  ğŸ†•                         â”‚   â”‚
â”‚  â”‚         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚   â”‚
â”‚  â”‚         æ¨¡å¼æå– Â· æŠ€èƒ½éªŒè¯ Â· ä¼˜åŒ–é€šçŸ¥ Â· åº”ç”¨åé¦ˆ       â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ã€æ ¸å¿ƒåŸåˆ™ã€‘                                                   â”‚
â”‚  ã€Œé€šè§ˆå…¨å±€ï¼Œè´¯ç©¿å§‹ç»ˆï¼Œå†³ç­–å¯æº¯ï¼Œå†å²å¯æŸ¥ï¼Œ                     â”‚
â”‚    å¤‡ä»½å¯æ¢å¤ï¼Œç»éªŒå¯ä¼ æ‰¿ã€                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š æ¥å£æ€»è§ˆ

### Layer 1: é¡¹ç›®çº§æ¥å£

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 1 | init_project | åˆå§‹åŒ–é¡¹ç›®æ¡£æ¡ˆé¦† | æ–°é¡¹ç›®å¯åŠ¨æ—¶ |
| 2 | get_project_status | è·å–é¡¹ç›®çŠ¶æ€ | ä»»æ„æ—¶åˆ»/Agentå¯åŠ¨æ—¶ |
| 3 | register_stage | æ³¨å†Œæ–°é˜¶æ®µ | Agentå¼€å§‹å·¥ä½œæ—¶ |
| 4 | report_decision | æŠ¥å‘Šå†³ç­–ï¼ˆè·¨é˜¶æ®µè¿½æº¯ï¼‰ | é‡è¦å†³ç­–äº§ç”Ÿæ—¶ |
| 5 | complete_stage | å®Œæˆé˜¶æ®µ | é˜¶æ®µå·¥ä½œå®Œæˆæ—¶ |
| 6 | create_snapshot | åˆ›å»ºå¿«ç…§ | éœ€è¦å¤‡ä»½æ—¶ |
| 7 | restore_snapshot | æ¢å¤å¿«ç…§ | éœ€è¦å›æ»šæ—¶ |
| 8 | get_timeline | è·å–é¡¹ç›®æ—¶é—´çº¿ | æŸ¥çœ‹é¡¹ç›®å†ç¨‹æ—¶ |

### Layer 2: é˜¶æ®µçº§æ¥å£

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 9 | init_session | åˆå§‹åŒ–é˜¶æ®µä¼šè¯ | Agent å¯åŠ¨æ—¶ |
| 10 | record | è®°å½•å•æ¡å¯¹è¯ | æ¯æ¬¡é—®ç­”å |
| 11 | record_correction | è®°å½•çº æ­£ | ç”¨æˆ·çº æ­£ä¹‹å‰è¯´æ³•æ—¶ |
| 12 | mark_decision | æ ‡è®°é˜¶æ®µå†…å†³ç­– | ç”¨æˆ·åšå†³ç­–æ—¶ |
| 13 | record_event | è®°å½•ç³»ç»Ÿäº‹ä»¶ | æ ¡éªŒç­‰äº‹ä»¶å‘ç”Ÿæ—¶ |
| 14 | confirm_points | è®°å½•ç”¨æˆ·ç¡®è®¤è¦ç‚¹ | ç”¨æˆ·ç¡®è®¤è¦ç‚¹æ—¶ |
| 15 | end_round | ç»“æŸè½®æ¬¡ | è½®æ¬¡å®Œæˆæ—¶ |
| 16 | archive | ç”Ÿæˆé˜¶æ®µå­˜æ¡£ | é˜¶æ®µå®Œæˆæ—¶ |
| 17 | get_session_summary | è·å–å½“å‰ä¼šè¯æ‘˜è¦ | ä»»æ„æ—¶åˆ» |

### Layer 3: è¿ç§»/é‡å¡‘ä¸“ç”¨æ¥å£

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 18 | init_migration | åˆå§‹åŒ–è¿ç§»è®°å½• | å¼€å§‹é‡å¡‘é¡¹ç›®æ—¶ |
| 19 | record_batch_start | è®°å½•æ‰¹æ¬¡å¼€å§‹ | è¿ç§»æ‰¹æ¬¡å¼€å§‹æ—¶ |
| 20 | record_batch_complete | è®°å½•æ‰¹æ¬¡å®Œæˆ | è¿ç§»æ‰¹æ¬¡å®Œæˆæ—¶ |
| 21 | record_batch_rollback | è®°å½•æ‰¹æ¬¡å›æ»š | è¿ç§»æ‰¹æ¬¡å¤±è´¥å›æ»šæ—¶ |
| 22 | record_file_migration | è®°å½•æ–‡ä»¶è¿ç§» | æ–‡ä»¶ç§»åŠ¨/æ‹†åˆ†/åˆå¹¶æ—¶ |
| 23 | record_import_updates | è®°å½•å¯¼å…¥è·¯å¾„æ›´æ–° | import è·¯å¾„æ‰¹é‡æ›´æ–°æ—¶ |
| 24 | get_migration_status | è·å–è¿ç§»çŠ¶æ€ | æŸ¥çœ‹è¿ç§»è¿›åº¦æ—¶ |

### Layer 4: å¥‘çº¦å¿«ç…§æ¥å£

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 25 | archive_contract_snapshot | å­˜æ¡£å¥‘çº¦å¿«ç…§ | å¥‘çº¦é”å®šæ—¶ |
| 26 | get_contract_snapshot | è·å–å¥‘çº¦å¿«ç…§ | éªŒæ”¶å¯¹æ¯”æ—¶ |
| 27 | list_contract_snapshots | åˆ—å‡ºå¥‘çº¦å¿«ç…§ | æŸ¥çœ‹å¿«ç…§å†å²æ—¶ |
| 28 | lock_contract | æ ‡è®°å¥‘çº¦é”å®š | çš‡ä¸Šç¡®è®¤å |
| 29 | record_contract_violation | è®°å½•å¥‘çº¦è¿è§„ | å‘ç°å¥‘çº¦è¢«ç ´åæ—¶ |
| 30 | archive_change_request | å­˜æ¡£å˜æ›´è¯·æ±‚ | æäº¤å˜æ›´è¯·æ±‚æ—¶ |
| 31 | update_change_request_status | æ›´æ–°å˜æ›´çŠ¶æ€ | æ‰¹å‡†/æ‹’ç»å˜æ›´æ—¶ |
| 32 | get_change_requests | è·å–å˜æ›´è¯·æ±‚åˆ—è¡¨ | æŸ¥çœ‹å˜æ›´å†å²æ—¶ |
| 33 | record_contract_rollback | è®°å½•å¥‘çº¦å›æ»š | æ‰§è¡Œå›æ»šæ—¶ |
| 34 | record_audit_log | è®°å½•å®¡è®¡æ—¥å¿— | æ•æ„Ÿæ“ä½œæ—¶ |
| 35 | get_audit_logs | è·å–å®¡è®¡æ—¥å¿— | å®¡è®¡è¿½æº¯æ—¶ |

### Layer 5: æŒç»­å­¦ä¹ æ¥å£ ğŸ†•

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 36 | evaluate_session | è¯„ä¼°ä¼šè¯æ˜¯å¦å€¼å¾—æå– | ä¼šè¯ç»“æŸæ—¶ |
| 37 | extract_patterns | æå–å¯å¤ç”¨æ¨¡å¼ | è¯„ä¼°é€šè¿‡å |
| 38 | save_learned_skill | ä¿å­˜å­¦ä¹ æŠ€èƒ½ | æå–å®Œæˆå |
| 39 | get_learned_skills | è·å–æŠ€èƒ½åˆ—è¡¨ | ä»»æ„æ—¶åˆ» |
| 40 | apply_learned_pattern | åº”ç”¨å­¦ä¹ æ¨¡å¼ | è§¦å‘æ¡ä»¶åŒ¹é…æ—¶ |
| 41 | feedback_on_pattern | è®°å½•åº”ç”¨æ•ˆæœ | åº”ç”¨å |
| 42 | generate_learning_report | ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š | ä¼šè¯ç»“æŸæ—¶ |
| 43 | validate_skill | éªŒè¯æŠ€èƒ½æœ‰æ•ˆæ€§ | ä¿å­˜å‰ |

### Layer 6: çŠ¶æ€åŒæ­¥æ¥å£ ğŸ†• v1.9

| # | æ¥å£å | ç”¨é€” | è°ƒç”¨æ—¶æœº |
|---|--------|------|---------|
| 44 | handshake | Agent å¯åŠ¨æ—¶çŠ¶æ€æ¡æ‰‹ | Agent å¯åŠ¨æ—¶ |
| 45 | verify_state_understanding | éªŒè¯çŠ¶æ€ç†è§£æ˜¯å¦æ­£ç¡® | Agent è¯»å–çŠ¶æ€å |
| 46 | report_state_mismatch | æŠ¥å‘ŠçŠ¶æ€ä¸ä¸€è‡´ | å‘ç°çŠ¶æ€é—®é¢˜æ—¶ |
| 47 | sync_state | å¼ºåˆ¶åŒæ­¥çŠ¶æ€ | çŠ¶æ€ä¿®å¤æ—¶ |

---

## ğŸ“– Layer 1: é¡¹ç›®çº§æ¥å£è¯¦ç»†å®šä¹‰

### æ¥å£ 1: init_project

**ç”¨é€”**: åˆå§‹åŒ–é¡¹ç›®æ¡£æ¡ˆé¦†ï¼ˆæ–°é¡¹ç›®ç¬¬ä¸€æ­¥ï¼‰

```yaml
interface: init_project

input:
  project_name: string
  user_request: string             # ç”¨æˆ·åŸå§‹éœ€æ±‚ï¼ˆé”å®šä¿å­˜ï¼‰
  complexity: "simple" | "medium" | "complex" | null  # å¯é€‰ï¼Œè‡ªåŠ¨åˆ¤æ–­

output:
  project_id: string               # é¡¹ç›®å”¯ä¸€æ ‡è¯†
  project_path: string             # .orchestra/ è·¯å¾„
  complexity_detected: string      # æ£€æµ‹åˆ°çš„å¤æ‚åº¦
  mode: "quick" | "standard"       # å¿«é€Ÿæ¨¡å¼ or æ ‡å‡†æ¨¡å¼
  status: "project_initialized"

actions:
  - åˆ›å»º .orchestra/ ç›®å½•ç»“æ„
  - åˆå§‹åŒ– project.json
  - é”å®šä¿å­˜ç”¨æˆ·åŸå§‹éœ€æ±‚
  - åˆ¤æ–­é¡¹ç›®å¤æ‚åº¦ï¼Œå†³å®šé‡‡ç”¨å¿«é€Ÿ/æ ‡å‡†æ¨¡å¼
```

#### å¤æ‚åº¦åˆ¤æ–­è§„åˆ™

```yaml
complexity_detection:
  
  simple:
    conditions:
      - "ç”¨æˆ·éœ€æ±‚å°‘äº50å­—"
      - "æåŠåŠŸèƒ½å°‘äº5ä¸ª"
      - "æ— å¤æ‚æŠ€æœ¯è¦æ±‚"
    mode: "quick"
    plan_rounds: 2                 # ä¸¤è½®ç²¾ç®€ç‰ˆ
    
  medium:
    conditions:
      - "ç”¨æˆ·éœ€æ±‚50-200å­—"
      - "æåŠåŠŸèƒ½5-15ä¸ª"
      - "æœ‰æ˜ç¡®æŠ€æœ¯è¦æ±‚"
    mode: "standard"
    plan_rounds: 4                 # æ ‡å‡†å››è½®
    
  complex:
    conditions:
      - "ç”¨æˆ·éœ€æ±‚è¶…è¿‡200å­—"
      - "æåŠåŠŸèƒ½è¶…è¿‡15ä¸ª"
      - "æœ‰å¤æ‚æŠ€æœ¯æ¶æ„"
      - "æ¶‰åŠå¤šç³»ç»Ÿé›†æˆ"
    mode: "standard"
    plan_rounds: 4
    note: "å¯èƒ½éœ€è¦åˆ†é˜¶æ®µå¤šæ¬¡é‡‡è®¿"
```

---

### æ¥å£ 2: get_project_status

**ç”¨é€”**: è·å–é¡¹ç›®å½“å‰çŠ¶æ€ï¼ˆä»»æ„ Agent å¯åŠ¨æ—¶è°ƒç”¨ï¼‰

```yaml
interface: get_project_status

input:
  project_id: string | null        # ä¸ºç©ºåˆ™æŸ¥æ‰¾æœ€è¿‘çš„é¡¹ç›®

output:
  found: boolean
  project:
    project_id: string
    project_name: string
    status: "in_progress" | "completed" | "paused"
    current_stage: string
    mode: "quick" | "standard"
    stages:
      plan: { status, completed_at, outputs_summary }
      spec: { status, completed_at, outputs_summary }
      code: { status, completed_at, outputs_summary }
      review: { status, completed_at, outputs_summary }
    recent_decisions: array        # æœ€è¿‘5ä¸ªå†³ç­–
    statistics:
      total_dialogues: number
      total_decisions: number
      total_duration: string
```

---

### æ¥å£ 3: register_stage

**ç”¨é€”**: æ³¨å†Œæ–°é˜¶æ®µï¼ˆAgent å¼€å§‹å·¥ä½œæ—¶ï¼‰

```yaml
interface: register_stage

input:
  project_id: string
  stage: "plan" | "spec" | "code" | "review"
  agent_id: string
  agent_role: string

output:
  stage_session_id: string         # é˜¶æ®µä¼šè¯ID
  archive_path: string             # é˜¶æ®µæ¡£æ¡ˆè·¯å¾„
  previous_stage_outputs: object | null  # ä¸Šä¸€é˜¶æ®µçš„äº§å‡ºï¼ˆå¦‚æœ‰ï¼‰
  status: "stage_registered"

actions:
  - æ›´æ–° project.json çš„ stages
  - åˆ›å»ºé˜¶æ®µæ¡£æ¡ˆç›®å½•
  - è®°å½•åˆ° timeline
  - å¦‚æœæ˜¯åç»­é˜¶æ®µï¼ŒåŠ è½½ä¸Šä¸€é˜¶æ®µäº§å‡º
```

---

### æ¥å£ 4: report_decision

**ç”¨é€”**: æŠ¥å‘Šå†³ç­–åˆ°é¡¹ç›®çº§ï¼ˆè·¨é˜¶æ®µè¿½æº¯ç”¨ï¼‰

```yaml
interface: report_decision

input:
  project_id: string
  stage: string
  decision:
    topic: string
    options: array
    chosen: string
    reason: string
    timestamp: datetime

output:
  decision_id: string              # é¡¹ç›®çº§å†³ç­–ID
  influences: array                # å¯èƒ½å½±å“çš„åç»­é˜¶æ®µ
  added_to_graph: boolean
  status: "decision_reported"

actions:
  - æ·»åŠ åˆ° decision-graph.json
  - æ›´æ–° decisions-full.md
  - åˆ†æå¹¶è®°å½•å½±å“é“¾
  - æ›´æ–° timeline
```

---

### æ¥å£ 5: complete_stage

**ç”¨é€”**: å®Œæˆé˜¶æ®µï¼Œè§¦å‘å­˜æ¡£å’ŒçŠ¶æ€æ›´æ–°

```yaml
interface: complete_stage

input:
  project_id: string
  stage: string
  outputs:                         # é˜¶æ®µäº§å‡ºæ‘˜è¦
    report_path: string
    key_decisions: array
    deliverables: array

output:
  archived: boolean
  archive_path: string
  next_stage: string | null
  auto_snapshot_created: boolean
  status: "stage_completed"

actions:
  - è°ƒç”¨ archive() ç”Ÿæˆé˜¶æ®µå­˜æ¡£
  - æ›´æ–° project.json çŠ¶æ€
  - æ›´æ–° timeline
  - è‡ªåŠ¨åˆ›å»ºé˜¶æ®µå®Œæˆå¿«ç…§
  - æ›´æ–° project-summary.md
  - æ›´æ–° stage-index.md
```

---

### æ¥å£ 6: create_snapshot

**ç”¨é€”**: åˆ›å»ºé¡¹ç›®å¿«ç…§ï¼ˆç”¨äºå¤‡ä»½æ¢å¤ï¼‰

```yaml
interface: create_snapshot

input:
  project_id: string
  trigger: "auto" | "manual" | "stage_complete" | "before_revision"
  description: string | null

output:
  snapshot_id: string
  snapshot_path: string
  includes:
    project_json: boolean
    current_stage_data: boolean
    all_archives: boolean
  status: "snapshot_created"

actions:
  - ä¿å­˜ project.json å½“å‰çŠ¶æ€
  - ä¿å­˜å½“å‰é˜¶æ®µçš„ä¼šè¯æ•°æ®
  - è®°å½•å¿«ç…§å…ƒä¿¡æ¯
```

#### è‡ªåŠ¨å¿«ç…§è§¦å‘ç‚¹

```yaml
auto_snapshot_triggers:
  - timing: "æ¯ä¸ªé˜¶æ®µå®Œæˆæ—¶"
    trigger: "stage_complete"
  - timing: "ç”¨æˆ·è¯·æ±‚ä¿®æ”¹å·²ç¡®è®¤å†…å®¹å‰"
    trigger: "before_revision"
  - timing: "æ¯10æ¡å¯¹è¯è‡ªåŠ¨ä¿å­˜"
    trigger: "auto"
```

---

### æ¥å£ 7: restore_snapshot

**ç”¨é€”**: æ¢å¤åˆ°æŒ‡å®šå¿«ç…§

```yaml
interface: restore_snapshot

input:
  project_id: string
  snapshot_id: string | null       # ä¸ºç©ºåˆ™æ¢å¤æœ€è¿‘çš„å¿«ç…§
  confirm: boolean                 # éœ€è¦ç”¨æˆ·ç¡®è®¤

output:
  restored: boolean
  restored_to:
    snapshot_id: string
    stage: string
    timestamp: datetime
  current_state_backed_up: boolean # æ¢å¤å‰è‡ªåŠ¨å¤‡ä»½å½“å‰çŠ¶æ€
  next_action: string
  status: "snapshot_restored" | "awaiting_confirm"

actions:
  - å¦‚æœ confirm=falseï¼Œå…ˆè¿”å›è¯¢é—®ç¡®è®¤
  - å¤‡ä»½å½“å‰çŠ¶æ€
  - æ¢å¤ project.json
  - æ¢å¤é˜¶æ®µæ¡£æ¡ˆ
  - è¿”å›æ¢å¤åçš„çŠ¶æ€è¯´æ˜
```

---

### æ¥å£ 8: get_timeline

**ç”¨é€”**: è·å–é¡¹ç›®æ—¶é—´çº¿

```yaml
interface: get_timeline

input:
  project_id: string
  filter:
    stage: string | null           # ç­›é€‰ç‰¹å®šé˜¶æ®µ
    type: array | null             # ç­›é€‰äº‹ä»¶ç±»å‹

output:
  timeline:
    - timestamp: datetime
      type: "stage_start" | "stage_complete" | "decision" | "correction" | "snapshot"
      stage: string
      summary: string
      details: object
  total_events: number
```

---

## ğŸ“– Layer 2: é˜¶æ®µçº§æ¥å£è¯¦ç»†å®šä¹‰

### æ¥å£ 9: init_session

**ç”¨é€”**: åˆå§‹åŒ–é˜¶æ®µä¼šè¯

```yaml
interface: init_session

input:
  project_id: string
  stage: string
  agent_id: string
  agent_role: string
  is_revision: boolean             # æ˜¯å¦æ˜¯ä¿®æ”¹æ¨¡å¼
  is_resume: boolean               # æ˜¯å¦æ˜¯æ¢å¤æ¨¡å¼

output:
  session_id: string
  archive_path: string
  context:
    type: "first_time" | "rework" | "resume" | "revision"
    previous_data: object | null
  status: "session_initialized"
```

---

### æ¥å£ 10: record

**ç”¨é€”**: è®°å½•å•æ¡å¯¹è¯

```yaml
interface: record

input:
  session_id: string
  entry:
    timestamp: datetime
    round: number                  # 0=éè½®æ¬¡, 1/2/3/4=è½®æ¬¡
    speaker: "agent" | "user"
    type: "question" | "answer" | "confirm" | "supplement" | "statement"
    content: string
    field_key: string | null
    metadata: object | null

output:
  entry_id: string
  sequence: number
  status: "recorded"
```

---

### æ¥å£ 11: record_correction

**ç”¨é€”**: è®°å½•ç”¨æˆ·çº æ­£ï¼Œå»ºç«‹çº æ­£é“¾

```yaml
interface: record_correction

input:
  session_id: string
  correction:
    timestamp: datetime
    round: number
    original_entry_id: string
    original_content: string
    corrected_content: string
    field_key: string | null
    reason: string | null

output:
  correction_id: string
  original_entry_marked: boolean   # åŸæ¡ç›®å·²æ ‡è®°"è¢«çº æ­£"
  project_level_reported: boolean  # å¦‚æ¶‰åŠå†³ç­–ï¼Œå·²ä¸ŠæŠ¥é¡¹ç›®çº§
  status: "correction_recorded"

actions:
  - åŸæ¡ç›®æ ‡è®° [å·²è¢«çº æ­£ â†’ correction_id]
  - æ–°å¢çº æ­£è®°å½•
  - å¦‚æœçº æ­£æ¶‰åŠä¹‹å‰çš„å†³ç­–ï¼ŒåŒæ­¥æ›´æ–° decision-graph
```

---

### æ¥å£ 12: mark_decision

**ç”¨é€”**: æ ‡è®°é˜¶æ®µå†…å†³ç­–

```yaml
interface: mark_decision

input:
  session_id: string
  decision:
    timestamp: datetime
    round: number
    topic: string
    context: string
    options: array
    chosen: string
    reason: string | null

output:
  decision_id: string              # é˜¶æ®µçº§ ID
  project_decision_id: string      # é¡¹ç›®çº§ IDï¼ˆè‡ªåŠ¨ä¸ŠæŠ¥ï¼‰
  status: "decision_marked"

actions:
  - è®°å½•åˆ°é˜¶æ®µæ¡£æ¡ˆ
  - è‡ªåŠ¨è°ƒç”¨ report_decision() ä¸ŠæŠ¥é¡¹ç›®çº§
```

---

### æ¥å£ 13: record_event

**ç”¨é€”**: è®°å½•ç³»ç»Ÿäº‹ä»¶

```yaml
interface: record_event

input:
  session_id: string
  event:
    timestamp: datetime
    round: number
    type: "validation_fail" | "validation_pass" | "warning" | "revision_start" | "pause" | "resume" | "project_scan"
    source: string
    details: object

output:
  event_id: string
  status: "event_recorded"
```

#### äº‹ä»¶ç±»å‹è¯´æ˜

```yaml
event_types:
  validation_fail: "æ ¡éªŒå¤±è´¥"
  validation_pass: "æ ¡éªŒé€šè¿‡"
  warning: "è­¦å‘Šï¼ˆéé˜»å¡ï¼‰"
  revision_start: "å¼€å§‹ä¿®æ”¹å·²ç¡®è®¤å†…å®¹"
  pause: "æš‚åœä¼šè¯"
  resume: "æ¢å¤ä¼šè¯"
  project_scan: "é¡¹ç›®æ‰«æï¼ˆæ¥è‡ªé’¦å¤©ç›‘ï¼‰"  # ğŸ†•
```

#### ä¸é’¦å¤©ç›‘ï¼ˆSkill 3ï¼‰å¯¹æ¥ ğŸ†•

```yaml
scanner_integration:
  
  # æ¥æ”¶æ‰«æç»“æœ
  receive_scan:
    trigger: "Skill 3 å®Œæˆæ‰«æåè°ƒç”¨"
    event_type: "project_scan"
    details:
      scan_id: string
      scan_type: "quick" | "deep"
      summary:
        files_scanned: number
        features_found: number
        problems_found: number
      report_path: string
      data_path: string
      
  # å­˜æ¡£ä½ç½®
  archive_location: ".orchestra/scans/"
  
  # ä¸é¡¹ç›®æ¡£æ¡ˆé¦†å…³è”
  project_archive_link:
    - "æ‰«æç»“æœè®°å½•åˆ° timeline"
    - "æ‰«ææŠ¥å‘Šå­˜å…¥ scans/ ç›®å½•"
    - "Plan Report å¯å¼•ç”¨æ‰«æç»“æœ"
```

---

### æ¥å£ 14: confirm_points

**ç”¨é€”**: è®°å½•ç”¨æˆ·ç¡®è®¤çš„è¦ç‚¹

```yaml
interface: confirm_points

input:
  session_id: string
  confirmation:
    timestamp: datetime
    round: number
    points_presented: array        # Agent å‘ˆç°çš„è¦ç‚¹
    user_response: string          # ç”¨æˆ·åŸè¯
    confirmed: boolean
    modifications: array | null    # ç”¨æˆ·ä¿®æ”¹å†…å®¹

output:
  confirmation_id: string
  final_points: array              # æœ€ç»ˆç¡®è®¤çš„è¦ç‚¹
  status: "points_confirmed" | "points_modified" | "points_rejected"
```

---

### æ¥å£ 15: end_round

**ç”¨é€”**: ç»“æŸå½“å‰è½®æ¬¡

```yaml
interface: end_round

input:
  session_id: string
  round: number
  round_name: string
  points_confirmation_id: string

output:
  round_summary:
    round: number
    round_name: string
    duration: string
    entries_count: number
    corrections_count: number
    decisions_count: number
    confirmed_points: array
    user_supplements: array
  status: "round_closed"
```

---

### æ¥å£ 16: archive

**ç”¨é€”**: ç”Ÿæˆé˜¶æ®µå­˜æ¡£æ–‡ä»¶

```yaml
interface: archive

input:
  session_id: string
  version_note: string | null

output:
  version: number
  files_generated:
    - filename: string
      path: string
      type: string
  archive_summary:
    total_entries: number
    total_corrections: number
    total_decisions: number
    duration: string
  status: "archived"
```

#### å­˜æ¡£æ–‡ä»¶åˆ—è¡¨

```yaml
archive_files:
  - filename: "dialogue-full-v{N}.md"
    content: "å®Œæ•´å¯¹è¯è®°å½•ï¼ˆå«çº æ­£é“¾ï¼‰"
    
  - filename: "dialogue-summary-v{N}.md"
    content: "å¯¹è¯æ‘˜è¦ï¼ˆç”¨æˆ·ç¡®è®¤çš„è¦ç‚¹ï¼‰"
    
  - filename: "key-decisions-v{N}.md"
    content: "å…³é”®å†³ç­–è®°å½•"
    
  - filename: "events-log-v{N}.md"
    content: "ç³»ç»Ÿäº‹ä»¶æ—¥å¿—"
```

---

### æ¥å£ 17: get_session_summary

**ç”¨é€”**: è·å–å½“å‰ä¼šè¯æ‘˜è¦

```yaml
interface: get_session_summary

input:
  session_id: string

output:
  status: "in_progress" | "paused" | "completed"
  current_round: number | null
  rounds_status:
    - round: number
      name: string
      status: "pending" | "in_progress" | "confirmed"
  total_entries: number
  total_corrections: number
  recent_entries: array
  elapsed_time: string
```

---

## ğŸ“– Layer 3: è¿ç§»/é‡å¡‘ä¸“ç”¨æ¥å£è¯¦ç»†å®šä¹‰

### æ¥å£ 18: init_migration

**ç”¨é€”**: åˆå§‹åŒ–è¿ç§»è®°å½•ï¼ˆå¼€å§‹é‡å¡‘é¡¹ç›®æ—¶è°ƒç”¨ï¼‰

```yaml
interface: init_migration

input:
  project_id: string
  migration_plan_path: string       # migration-plan.yaml è·¯å¾„
  strategy: "big_bang" | "incremental" | "parallel"
  total_batches: number
  estimated_duration: string

output:
  migration_id: string
  migration_path: string            # .orchestra/migrations/{migration_id}/
  status: "migration_initialized"
  
actions:
  - åˆ›å»º migrations/ ç›®å½•
  - åˆå§‹åŒ– migration.json
  - è®°å½•è¿ç§»è®¡åˆ’å¿«ç…§
  - å…³è”åˆ°é¡¹ç›®æ—¶é—´çº¿
```

---

### æ¥å£ 19: record_batch_start

**ç”¨é€”**: è®°å½•è¿ç§»æ‰¹æ¬¡å¼€å§‹

```yaml
interface: record_batch_start

input:
  migration_id: string
  batch_number: number
  batch_name: string
  planned_files: array              # è®¡åˆ’è¿ç§»çš„æ–‡ä»¶åˆ—è¡¨
  planned_actions: array            # è®¡åˆ’æ‰§è¡Œçš„åŠ¨ä½œ

output:
  batch_id: string
  start_time: datetime
  status: "batch_started"
  
actions:
  - åˆ›å»ºæ‰¹æ¬¡è®°å½•
  - è®°å½•è®¡åˆ’çš„æ–‡ä»¶å’ŒåŠ¨ä½œ
  - åˆ›å»ºæ‰¹æ¬¡å¿«ç…§ï¼ˆç”¨äºå›æ»šï¼‰
```

---

### æ¥å£ 20: record_batch_complete

**ç”¨é€”**: è®°å½•è¿ç§»æ‰¹æ¬¡å®Œæˆ

```yaml
interface: record_batch_complete

input:
  batch_id: string
  actual_files: array               # å®é™…è¿ç§»çš„æ–‡ä»¶
  actual_actions: array             # å®é™…æ‰§è¡Œçš„åŠ¨ä½œ
  verification_results:
    build_passed: boolean
    tests_passed: boolean
    manual_checks: array

output:
  end_time: datetime
  duration: string
  status: "batch_completed"
  next_batch: number | null
  
actions:
  - æ›´æ–°æ‰¹æ¬¡è®°å½•
  - è®°å½•éªŒè¯ç»“æœ
  - æ›´æ–°è¿ç§»è¿›åº¦
  - æ¸…ç†å›æ»šå¿«ç…§ï¼ˆå¯é€‰ä¿ç•™ï¼‰
```

---

### æ¥å£ 21: record_batch_rollback

**ç”¨é€”**: è®°å½•è¿ç§»æ‰¹æ¬¡å›æ»š

```yaml
interface: record_batch_rollback

input:
  batch_id: string
  rollback_reason: string
  failed_at: string                 # å¤±è´¥ä½ç½®
  error_details: object

output:
  rollback_time: datetime
  status: "batch_rolled_back"
  restored_snapshot: string
  
actions:
  - è®°å½•å›æ»šåŸå› 
  - æ ‡è®°æ‰¹æ¬¡ä¸ºå¤±è´¥
  - è®°å½•éœ€è¦äººå·¥ä»‹å…¥çš„é—®é¢˜
  - é€šçŸ¥ç›¸å…³ Agent
```

---

### æ¥å£ 22: record_file_migration

**ç”¨é€”**: è®°å½•å•ä¸ªæ–‡ä»¶çš„è¿ç§»è¯¦æƒ…

```yaml
interface: record_file_migration

input:
  batch_id: string
  action: "move" | "split" | "merge" | "rename" | "create" | "delete"
  source: string | array            # æºæ–‡ä»¶
  target: string | array            # ç›®æ ‡æ–‡ä»¶
  details:
    lines_affected: number
    functions_moved: array | null
    imports_updated: number

output:
  file_migration_id: string
  status: "recorded"
  
actions:
  - è®°å½•æ–‡ä»¶å˜æ›´è¯¦æƒ…
  - æ›´æ–°æ–‡ä»¶æ˜ å°„è¡¨
  - å…³è”åˆ°æ‰¹æ¬¡è®°å½•
```

---

### æ¥å£ 23: record_import_updates

**ç”¨é€”**: è®°å½• import è·¯å¾„æ‰¹é‡æ›´æ–°

```yaml
interface: record_import_updates

input:
  batch_id: string
  updates:
    - file: string
      old_import: string
      new_import: string
      line_number: number

output:
  total_updates: number
  files_affected: number
  status: "imports_recorded"
  
actions:
  - è®°å½•æ‰€æœ‰ import å˜æ›´
  - ç”Ÿæˆå˜æ›´æ‘˜è¦
  - ç”¨äºåç»­éªŒè¯å’Œé—®é¢˜æ’æŸ¥
```

---

### æ¥å£ 24: get_migration_status

**ç”¨é€”**: è·å–è¿ç§»è¿›åº¦çŠ¶æ€

```yaml
interface: get_migration_status

input:
  migration_id: string

output:
  migration_id: string
  strategy: string
  status: "in_progress" | "completed" | "paused" | "failed"
  progress:
    total_batches: number
    completed_batches: number
    current_batch: number | null
    percentage: number
  batches:
    - batch_number: number
      name: string
      status: "pending" | "in_progress" | "completed" | "failed" | "rolled_back"
      files_migrated: number
      duration: string | null
  statistics:
    total_files_migrated: number
    total_imports_updated: number
    total_rollbacks: number
    elapsed_time: string
  next_steps: array                 # å»ºè®®çš„ä¸‹ä¸€æ­¥æ“ä½œ
```

---

## ğŸ”„ å®Œæ•´è°ƒç”¨æµç¨‹ç¤ºä¾‹

### æ–°é¡¹ç›®å¯åŠ¨ï¼ˆPlan Agentï¼‰

```yaml
flow_new_project:

  step_1:
    action: "ç”¨æˆ·æå‡ºéœ€æ±‚"
    example: "æœ•è¦åšä¸€ä¸ªåšå®¢ç³»ç»Ÿ"
    
  step_2:
    interface: init_project
    params:
      project_name: "åšå®¢ç³»ç»Ÿ"
      user_request: "æœ•è¦åšä¸€ä¸ªåšå®¢ç³»ç»Ÿ"
    result:
      project_id: "blog-20260122"
      mode: "standard"  # æˆ– "quick"
      
  step_3:
    interface: register_stage
    params:
      project_id: "blog-20260122"
      stage: "plan"
      agent_id: "plan-agent"
      agent_role: "ç¿°æ—é™¢å­¦å£«"
    result:
      stage_session_id: "plan-blog-20260122-001"
      
  step_4:
    interface: init_session
    params:
      project_id: "blog-20260122"
      stage: "plan"
      is_revision: false
      is_resume: false
    result:
      session_id: "session-plan-001"
      context: { type: "first_time" }
      
  step_5:
    action: "å¼€å§‹é‡‡è®¿..."
    note: "æ ¹æ® mode å†³å®šæ˜¯å››è½®è¿˜æ˜¯ä¸¤è½®"
```

### é˜¶æ®µå®Œæˆæµè½¬ï¼ˆPlan â†’ Specï¼‰

```yaml
flow_stage_transition:

  step_1:
    action: "Plan Agent å®Œæˆæ‰€æœ‰è½®æ¬¡"
    
  step_2:
    interface: archive
    params:
      session_id: "session-plan-001"
    result:
      files_generated: [...]
      
  step_3:
    interface: complete_stage
    params:
      project_id: "blog-20260122"
      stage: "plan"
      outputs:
        report_path: "plan-report.md"
        key_decisions: [...]
    result:
      next_stage: "spec"
      auto_snapshot_created: true
      
  step_4:
    action: "ç”¨æˆ·é€‰æ‹©ç»§ç»­ â†’ è¿›å…¥ Spec Agent"
    
  step_5:
    interface: register_stage
    params:
      project_id: "blog-20260122"
      stage: "spec"
    result:
      previous_stage_outputs: { plan_report: {...} }
```

### è·¨é˜¶æ®µå›æ»š

```yaml
flow_cross_stage_rollback:

  trigger: "Specé˜¶æ®µå‘ç°Planæœ‰é—®é¢˜"
  
  step_1:
    interface: create_snapshot
    params:
      project_id: "blog-20260122"
      trigger: "before_revision"
      description: "å›æ»šåˆ°Planå‰å¤‡ä»½Specè¿›åº¦"
      
  step_2:
    interface: restore_snapshot
    params:
      project_id: "blog-20260122"
      snapshot_id: "snapshot-plan-complete"
      confirm: true
    result:
      restored_to: { stage: "plan" }
      
  step_3:
    interface: register_stage
    params:
      stage: "plan"
      # is_revision: true
    result:
      context: { type: "revision" }
```

---

## ğŸ“‚ å­˜æ¡£ç›®å½•ç»“æ„

```
.orchestra/
â”œâ”€â”€ project.json                      # é¡¹ç›®å…ƒæ•°æ®
â”œâ”€â”€ timeline.md                       # é¡¹ç›®æ—¶é—´çº¿
â”œâ”€â”€ decisions/
â”‚   â”œâ”€â”€ decision-graph.json           # å†³ç­–å…³ç³»å›¾
â”‚   â””â”€â”€ decisions-full.md             # å®Œæ•´å†³ç­–è®°å½•
â”œâ”€â”€ summaries/
â”‚   â”œâ”€â”€ project-summary.md            # é¡¹ç›®æ•´ä½“æ‘˜è¦
â”‚   â””â”€â”€ stage-index.md                # é˜¶æ®µç´¢å¼•
â”œâ”€â”€ snapshots/
â”‚   â”œâ”€â”€ snapshot-{timestamp}.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scans/                            # é¡¹ç›®æ‰«æï¼ˆæ¥è‡ªé’¦å¤©ç›‘ï¼‰
â”‚   â”œâ”€â”€ scan-index.md
â”‚   â”œâ”€â”€ scan-{id}/
â”‚   â”‚   â”œâ”€â”€ scan-report.md
â”‚   â”‚   â””â”€â”€ scan-data.json
â”‚   â””â”€â”€ comparisons/
â”‚       â””â”€â”€ compare-{id1}-{id2}.md
â”œâ”€â”€ contracts/                        # å¥‘çº¦å¿«ç…§ï¼ˆæ¥è‡ªå¥‘çº¦å®ˆå«ï¼‰
â”‚   â”œâ”€â”€ snapshot_index.json
â”‚   â”œâ”€â”€ snapshots/
â”‚   â”‚   â””â”€â”€ {snapshot_id}.json
â”‚   â”œâ”€â”€ change_requests/
â”‚   â”‚   â””â”€â”€ {id}.json
â”‚   â”œâ”€â”€ violations/
â”‚   â”‚   â””â”€â”€ {timestamp}.json
â”‚   â”œâ”€â”€ rollbacks/
â”‚   â”‚   â””â”€â”€ {timestamp}.json
â”‚   â””â”€â”€ audit_log.json
â”œâ”€â”€ migrations/                        # è¿ç§»è®°å½•ï¼ˆé‡å¡‘é¡¹ç›®ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ migration-index.md            # è¿ç§»ç´¢å¼•
â”‚   â”œâ”€â”€ migration-{id}/
â”‚   â”‚   â”œâ”€â”€ migration.json            # è¿ç§»å…ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ plan-snapshot.yaml        # è¿ç§»è®¡åˆ’å¿«ç…§
â”‚   â”‚   â”œâ”€â”€ batches/
â”‚   â”‚   â”‚   â”œâ”€â”€ batch-1/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ batch-record.json # æ‰¹æ¬¡è®°å½•
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ files-moved.json  # æ–‡ä»¶è¿ç§»è®°å½•
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ imports-updated.json # import æ›´æ–°è®°å½•
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rollback-snapshot/ # å›æ»šå¿«ç…§
â”‚   â”‚   â”‚   â””â”€â”€ batch-2/
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ summary.md                # è¿ç§»æ€»ç»“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ learned/                          # ğŸ†• æŒç»­å­¦ä¹ ï¼ˆLayer 5ï¼‰
â”‚   â”œâ”€â”€ config.json                   # å­¦ä¹ é…ç½®
â”‚   â”œâ”€â”€ skills-index.json             # æŠ€èƒ½ç´¢å¼•
â”‚   â”œâ”€â”€ patterns-log.md               # æ¨¡å¼æå–æ—¥å¿—
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â””â”€â”€ {skill_id}.json           # æŠ€èƒ½è¯¦æƒ…
â”‚   â”œâ”€â”€ validations/
â”‚   â”‚   â””â”€â”€ {skill_id}_validation.json # éªŒè¯è®°å½•
â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â””â”€â”€ {skill_id}_feedback.json  # åé¦ˆå†å²
â”‚   â”œâ”€â”€ reports/
â”‚   â”‚   â””â”€â”€ {session_id}_report.md    # å­¦ä¹ æŠ¥å‘Š
â”‚   â””â”€â”€ statistics.json               # å­¦ä¹ ç»Ÿè®¡
â””â”€â”€ archives/
    â”œâ”€â”€ plan-stage-1/
    â”‚   â”œâ”€â”€ dialogue-full-v1.md
    â”‚   â”œâ”€â”€ dialogue-summary-v1.md
    â”‚   â”œâ”€â”€ key-decisions-v1.md
    â”‚   â””â”€â”€ events-log-v1.md
    â”œâ”€â”€ spec-stage-1/
    â”‚   â””â”€â”€ ...
    â””â”€â”€ ...
```

---

## ğŸ” æ•°æ®å®Œæ•´æ€§ä¿éšœ

```yaml
integrity:

  # ========== å²å®˜é“å¾‹ï¼ˆDA-01 ~ DA-06ï¼‰==========
  
  DA-01:
    name: "ç”¨æˆ·åŸå§‹éœ€æ±‚é”å®š"
    rule: "init_project æ—¶é”å®šç”¨æˆ·åŸå§‹éœ€æ±‚ï¼Œåç»­ä¸å¯ä¿®æ”¹"
    immutable: true
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "get_project_status + æ–‡ä»¶å¯¹æ¯”"
      æ­¥éª¤:
        1: "è°ƒç”¨ get_project_status() è·å– user_request"
        2: "ä¸ .orchestra/project.json ä¸­çš„ user_request å¯¹æ¯”"
        3: "ä¸¤è€…ä¸ä¸€è‡´ = è¿è§„"
      è¯æ®: "get_project_status è¿”å› + project.json å†…å®¹"
    consequence: "éœ€æ±‚è¢«ç¯¡æ”¹ï¼Œé¡¹ç›®ä½œåºŸé‡æ¥"
    
  DA-02:
    name: "çº æ­£è€Œéä¿®æ”¹"
    rule: "å†å²è®°å½•ä¸å¯ä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ record_correction çº æ­£"
    result: "åŸè®°å½•ä¿ç•™ï¼Œæ–°å¢çº æ­£é“¾æ¥"
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "æ–‡ä»¶å“ˆå¸Œ + Git å†å²"
      æ­¥éª¤:
        1: "æ¯æ¡è®°å½•åˆ›å»ºæ—¶è®¡ç®—å“ˆå¸Œ"
        2: "å®šæœŸéªŒè¯å“ˆå¸Œæ˜¯å¦å˜åŒ–"
        3: "å“ˆå¸Œå˜åŒ–ä¸”æ—  correction è®°å½• = è¿è§„"
      è¯æ®: "è®°å½•å“ˆå¸Œå¯¹æ¯”ç»“æœ"
    consequence: "å†å²è¢«ç¯¡æ”¹ï¼Œå›æ»šåˆ°ä¸Šä¸€ä¸ªå¯ä¿¡å¿«ç…§"
    
  DA-03:
    name: "è¦ç‚¹å¿…é¡»ç”¨æˆ·ç¡®è®¤"
    rule: "è¦ç‚¹ç”± Agent æ•´ç†ï¼Œå¿…é¡»ç”¨æˆ·ç¡®è®¤åæ‰ç”Ÿæ•ˆ"
    result: "é˜²æ­¢ Agent æ­ªæ›²ç”¨æˆ·æ„å›¾"
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "confirm_points è®°å½•æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥è¦ç‚¹è®°å½•æ˜¯å¦æœ‰ confirmed_by: user"
        2: "æ£€æŸ¥ç¡®è®¤æ—¶é—´æ˜¯å¦åœ¨è¦ç‚¹åˆ›å»ºæ—¶é—´ä¹‹å"
        3: "æ— ç”¨æˆ·ç¡®è®¤ = è¦ç‚¹æ— æ•ˆ"
      è¯æ®: "confirm_points è¿”å›çš„ confirmation_id"
    consequence: "æœªç¡®è®¤çš„è¦ç‚¹ä¸èƒ½ä½œä¸ºåç»­å†³ç­–ä¾æ®"
    
  DA-04:
    name: "å†³ç­–è·¨é˜¶æ®µè¿½æº¯"
    rule: "æ‰€æœ‰é‡è¦å†³ç­–å¿…é¡»è°ƒç”¨ report_decision ä¸ŠæŠ¥é¡¹ç›®çº§"
    result: "ä»»æ„é˜¶æ®µå¯è¿½æº¯å†³ç­–æ¥æº"
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "get_timeline + é˜¶æ®µè®°å½•å¯¹æ¯”"
      æ­¥éª¤:
        1: "è°ƒç”¨ get_timeline() è·å–æ‰€æœ‰å†³ç­–"
        2: "ä¸å„é˜¶æ®µçš„ mark_decision è®°å½•å¯¹æ¯”"
        3: "é˜¶æ®µå†…æœ‰å†³ç­–ä½†é¡¹ç›®çº§æ²¡æœ‰ = è¿è§„"
      è¯æ®: "get_timeline è¿”å› + é˜¶æ®µå†³ç­–åˆ—è¡¨"
    consequence: "æœªä¸ŠæŠ¥çš„å†³ç­–ä¸èƒ½ä½œä¸ºé¡¹ç›®å†³ç­–ä¾æ®"
    
  DA-05:
    name: "é˜¶æ®µå®Œæˆè‡ªåŠ¨å¿«ç…§"
    rule: "è°ƒç”¨ complete_stage æ—¶å¿…é¡»è‡ªåŠ¨åˆ›å»ºå¿«ç…§"
    result: "æ”¯æŒç¾éš¾æ¢å¤"
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "complete_stage è¿”å›æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ complete_stage è¿”å›æ˜¯å¦åŒ…å« snapshot_id"
        2: "éªŒè¯ snapshot_id å¯¹åº”çš„å¿«ç…§æ–‡ä»¶å­˜åœ¨"
        3: "æ— å¿«ç…§ = è¿è§„"
      è¯æ®: "complete_stage è¿”å›çš„ snapshot_id + å¿«ç…§æ–‡ä»¶"
    consequence: "æ— å¿«ç…§çš„é˜¶æ®µå®Œæˆæ— æ•ˆï¼Œé‡æ–°æ‰§è¡Œ"
    
  DA-06:
    name: "å­˜æ¡£æ–‡ä»¶å¸¦ç‰ˆæœ¬å·"
    rule: "æ‰€æœ‰å­˜æ¡£æ–‡ä»¶å¿…é¡»å¸¦ç‰ˆæœ¬å·"
    result: "æ”¯æŒå†å²ç‰ˆæœ¬æ¯”å¯¹"
    # ğŸ†• æ£€æµ‹æ–¹æ³•
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "archive è¿”å›æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ archive è¿”å›çš„æ–‡ä»¶åˆ—è¡¨"
        2: "éªŒè¯æ¯ä¸ªæ–‡ä»¶ååŒ…å«ç‰ˆæœ¬å·ï¼ˆå¦‚ _v1, _v2ï¼‰"
        3: "æ— ç‰ˆæœ¬å· = è¿è§„"
      è¯æ®: "archive è¿”å›çš„æ–‡ä»¶åˆ—è¡¨"
    consequence: "æ— ç‰ˆæœ¬å·çš„å­˜æ¡£æ— æ•ˆï¼Œé‡æ–°ç”Ÿæˆ"

  # ========== è°ƒç”¨è¯æ®è¦æ±‚ ==========
  
  è°ƒç”¨è¯æ®è¦æ±‚:
    description: "è°ƒç”¨å²å®˜æ¥å£æ—¶å¿…é¡»æä¾›è¯æ®"
    
    init_project:
      å¿…é¡»è¿”å›: "project_id"
      è¯æ®: "project_id å­—ç¬¦ä¸²"
      
    register_stage:
      å¿…é¡»è¿”å›: "stage_session_id"
      è¯æ®: "stage_session_id å­—ç¬¦ä¸²"
      
    record_event:
      å¿…é¡»è¿”å›: "event_id"
      è¯æ®: "event_id å­—ç¬¦ä¸²"
      
    complete_stage:
      å¿…é¡»è¿”å›: "snapshot_id, archive_path"
      è¯æ®: "snapshot_id + archive_path"
      
    create_snapshot:
      å¿…é¡»è¿”å›: "snapshot_id, snapshot_path"
      è¯æ®: "snapshot_id + å¿«ç…§æ–‡ä»¶å­˜åœ¨"
      
    record_batch_complete:
      å¿…é¡»è¿”å›: "status: batch_completed"
      è¯æ®: "status å­—ç¬¦ä¸² + éªŒè¯ç»“æœ"

    # Layer 5 æŒç»­å­¦ä¹ æ¥å£è¯æ®è¦æ±‚
    evaluate_session:
      å¿…é¡»è¿”å›: "worth_extracting, reasons"
      è¯æ®: "worth_extracting å¸ƒå°”å€¼ + reasons æ•°ç»„"

    extract_patterns:
      å¿…é¡»è¿”å›: "extracted_patterns, total_extracted"
      è¯æ®: "extracted_patterns æ•°ç»„ï¼ˆæ¯é¡¹å« source_messagesï¼‰"

    validate_skill:
      å¿…é¡»è¿”å›: "validation_result, recommendation"
      è¯æ®: "validation_result.passed å¸ƒå°”å€¼ + recommendation å­—ç¬¦ä¸²"

    save_learned_skill:
      å¿…é¡»è¿”å›: "skill_id, storage_path, initial_state"
      è¯æ®: "skill_id + æŠ€èƒ½æ–‡ä»¶å­˜åœ¨äº storage_path"

    generate_learning_report:
      å¿…é¡»è¿”å›: "report, report_path, notification_level"
      è¯æ®: "report_path æ–‡ä»¶å­˜åœ¨ + notification_level å­—ç¬¦ä¸²"

    apply_learned_pattern:
      å¿…é¡»è¿”å›: "applied, suggestion"
      è¯æ®: "applied å¸ƒå°”å€¼ + åº”ç”¨è®°å½•"

    feedback_on_pattern:
      å¿…é¡»è¿”å›: "feedback_id, effectiveness_updated"
      è¯æ®: "feedback_id + åé¦ˆè®°å½•å­˜åœ¨"

    get_learned_skills:
      å¿…é¡»è¿”å›: "total, skills"
      è¯æ®: "skills æ•°ç»„ï¼ˆæ¯é¡¹å« skill_id, state, effectivenessï¼‰"
```

---

## âš¡ å¿«é€Ÿæ¨¡å¼ vs æ ‡å‡†æ¨¡å¼

```yaml
mode_comparison:

  quick_mode:
    é€‚ç”¨: "ç®€å•é¡¹ç›®ï¼ˆåŠŸèƒ½<5ä¸ªï¼‰"
    plan_rounds: 2
    round_1: "WHAT + HOW åˆå¹¶"
    round_2: "OUTPUT ç¡®è®¤"
    å¼€åœºç™½: "ç®€åŒ–ç‰ˆ"
    
  standard_mode:
    é€‚ç”¨: "ä¸­ç­‰/å¤æ‚é¡¹ç›®"
    plan_rounds: 4
    round_1: "WHAT"
    round_2: "HOW"
    round_3: "EDGE"
    round_4: "OUTPUT"
    å¼€åœºç™½: "é¦–æ¬¡è¯¦ç»†ï¼Œåç»­ç®€åŒ–"
```

---

## ğŸ”— ä¸é’¦å¤©ç›‘ï¼ˆSkill 3ï¼‰å¯¹æ¥ ğŸ†•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  å²å®˜ä¸é’¦å¤©ç›‘çš„åä½œ                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
â”‚                                                                             â”‚
â”‚   é’¦å¤©ç›‘ï¼ˆSkill 3ï¼‰                    å²å®˜ï¼ˆSkill 2ï¼‰                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â”‚   â”‚  æ‰«æé¡¹ç›®       â”‚ â”€â”€scan_resultâ”€â”€â†’â”‚  å­˜æ¡£æ‰«æç»“æœ   â”‚                  â”‚
â”‚   â”‚  ç”ŸæˆæŠ¥å‘Š       â”‚                 â”‚  è®°å½•åˆ°timeline â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚  å…³è”é¡¹ç›®æ¡£æ¡ˆ   â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¹æ¥æµç¨‹

```yaml
scanner_archivist_integration:

  # æ‰«æå®Œæˆåå­˜æ¡£
  on_scan_complete:
    step_1:
      action: "é’¦å¤©ç›‘å®Œæˆæ‰«æ"
      output: "scan_result"
      
    step_2:
      action: "é’¦å¤©ç›‘è°ƒç”¨å²å®˜"
      interface: "record_event"
      params:
        type: "project_scan"
        source: "project-scanner"
        details:
          scan_id: "{scan_id}"
          scan_type: "quick | deep"
          summary: "{æ‰«ææ‘˜è¦}"
          report_path: ".orchestra/scans/{scan_id}/scan-report.md"
          data_path: ".orchestra/scans/{scan_id}/scan-data.json"
          
    step_3:
      action: "å²å®˜å­˜æ¡£"
      actions:
        - "ä¿å­˜æ‰«ææŠ¥å‘Šåˆ° .orchestra/scans/"
        - "è®°å½•åˆ° timeline.md"
        - "æ›´æ–° scan-index.md"
        
  # Plan Report å¼•ç”¨æ‰«æç»“æœ
  plan_report_reference:
    format: "å‚è§æ‰«ææŠ¥å‘Š scan-{id}"
    link: ".orchestra/scans/{scan_id}/scan-report.md"
    
  # æ‰«æå¯¹æ¯”å­˜æ¡£
  scan_comparison:
    trigger: "Skill 3 compare_scan å®Œæˆ"
    archive_path: ".orchestra/scans/comparisons/"
```

### å­˜æ¡£å†…å®¹

```yaml
scan_archive_content:

  scan_report_md:
    description: "äººç±»å¯è¯»çš„æ‰«ææŠ¥å‘Š"
    includes:
      - é¡¹ç›®æ¦‚å†µ
      - æŠ€æœ¯æ ˆï¼ˆé™„è¯æ®ï¼‰
      - ç°æœ‰åŠŸèƒ½
      - æ½œåœ¨é—®é¢˜
      - æ‰«æå…ƒä¿¡æ¯
      
  scan_data_json:
    description: "æœºå™¨å¯è¯»çš„æ‰«ææ•°æ®"
    includes:
      - å®Œæ•´æ‰«æç»“æœ
      - ç»“æ„åŒ–æ•°æ®
      - ç”¨äºåç»­å¯¹æ¯”
      
  scan_index_md:
    description: "æ‰«æç´¢å¼•"
    includes:
      - æ‰€æœ‰æ‰«æè®°å½•åˆ—è¡¨
      - æ‰«ææ—¶é—´ã€ç±»å‹ã€æ‘˜è¦
      - å¿«é€ŸæŸ¥æ‰¾å…¥å£
```

---

## ğŸ“– Layer 4: å¥‘çº¦å¿«ç…§æ¥å£è¯¦ç»†å®šä¹‰

> ä¸å¥‘çº¦å®ˆå«ï¼ˆContract Guardianï¼‰é…åˆä½¿ç”¨

### æ¥å£ 25: archive_contract_snapshot

**ç”¨é€”**: å­˜æ¡£å¥‘çº¦å¿«ç…§ï¼ˆå¥‘çº¦é”å®šæ—¶è°ƒç”¨ï¼‰

```yaml
interface: archive_contract_snapshot

input:
  project_id: string
  snapshot:
    id: string                      # å¿«ç…§ IDï¼ˆç”±å¥‘çº¦å®ˆå«ç”Ÿæˆï¼‰
    created_at: string              # ISO æ—¶é—´æˆ³
    name: string                    # å¿«ç…§åç§°ï¼ˆå¦‚ "phase_a_contract_lock"ï¼‰
    contracts:
      types: array                  # ç±»å‹å®šä¹‰åˆ—è¡¨
      interfaces: array             # æ¥å£å®šä¹‰åˆ—è¡¨
      functions: array              # å‡½æ•°ç­¾ååˆ—è¡¨
      api_routes: array             # API è·¯ç”±åˆ—è¡¨
      enums: array                  # æšä¸¾åˆ—è¡¨
    hash: string                    # å†…å®¹å“ˆå¸Œï¼ˆsha256ï¼‰

output:
  record_id: string                 # å­˜æ¡£è®°å½• ID
  storage_path: string              # å­˜å‚¨è·¯å¾„
  status: "archived"
  archived_at: string               # å­˜æ¡£æ—¶é—´

actions:
  - éªŒè¯å¿«ç…§å“ˆå¸Œå®Œæ•´æ€§
  - å­˜å‚¨åˆ° .orchestra/contracts/snapshots/{snapshot_id}.json
  - è®°å½•åˆ° contracts/snapshot_index.json
  - è¿”å›å­˜æ¡£ç¡®è®¤
```

#### å­˜å‚¨ç»“æ„

```yaml
storage_structure:
  path: ".orchestra/contracts/snapshots/"
  files:
    - "{snapshot_id}.json"          # å®Œæ•´å¿«ç…§å†…å®¹
  index:
    path: ".orchestra/contracts/snapshot_index.json"
    content:
      snapshots:
        - id: "snap_xxx"
          name: "phase_a_contract_lock"
          created_at: "2026-01-23T14:30:52Z"
          archived_at: "2026-01-23T14:30:53Z"
          hash: "sha256:..."
```

---

### æ¥å£ 26: get_contract_snapshot

**ç”¨é€”**: è·å–å·²å­˜æ¡£çš„å¥‘çº¦å¿«ç…§

```yaml
interface: get_contract_snapshot

input:
  snapshot_id: string               # å¿«ç…§ ID

output:
  found: boolean
  snapshot:
    id: string
    created_at: string
    name: string
    contracts: {...}
    hash: string
  verified: boolean                 # å“ˆå¸ŒéªŒè¯ç»“æœ
  
actions:
  - ä»å­˜å‚¨è·¯å¾„è¯»å–å¿«ç…§
  - éªŒè¯å“ˆå¸Œå®Œæ•´æ€§
  - è¿”å›å¿«ç…§å†…å®¹
  
errors:
  - "SNAPSHOT_NOT_FOUND": å¿«ç…§ä¸å­˜åœ¨
  - "HASH_MISMATCH": å“ˆå¸Œä¸åŒ¹é…ï¼ˆå¯èƒ½è¢«ç¯¡æ”¹ï¼‰
```

---

### æ¥å£ 27: list_contract_snapshots

**ç”¨é€”**: åˆ—å‡ºé¡¹ç›®çš„æ‰€æœ‰å¥‘çº¦å¿«ç…§

```yaml
interface: list_contract_snapshots

input:
  project_id: string

output:
  total: number
  snapshots:
    - id: string
      name: string
      created_at: string
      archived_at: string
      hash: string
      
actions:
  - è¯»å– snapshot_index.json
  - è¿”å›å¿«ç…§åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´å€’åºï¼‰
```

---

### æ¥å£ 28: lock_contract

**ç”¨é€”**: æ ‡è®°å¥‘çº¦å·²é”å®šï¼ˆçš‡ä¸Šç¡®è®¤åè°ƒç”¨ï¼‰

```yaml
interface: lock_contract

input:
  project_id: string
  snapshot_id: string               # è¦é”å®šçš„å¿«ç…§ ID
  confirmed_by: "user"              # ç¡®è®¤è€…
  confirmation_note: string | null  # ç¡®è®¤å¤‡æ³¨

output:
  lock_id: string                   # é”å®šè®°å½• ID
  locked_at: string                 # é”å®šæ—¶é—´
  status: "locked"
  
actions:
  - åœ¨ snapshot_index.json ä¸­æ ‡è®°è¯¥å¿«ç…§ä¸º locked
  - è®°å½•é”å®šäº‹ä»¶åˆ°é¡¹ç›®æ—¶é—´çº¿
  - è¿”å›é”å®šç¡®è®¤
  
storage:
  snapshot_index.json:
    snapshots:
      - id: "snap_xxx"
        locked: true                # ğŸ”’ å·²é”å®š
        locked_at: "2026-01-23T14:35:00Z"
        locked_by: "user"
```

---

### æ¥å£ 29: record_contract_violation

**ç”¨é€”**: è®°å½•å¥‘çº¦è¿è§„äº‹ä»¶ï¼ˆå‘ç°å¥‘çº¦è¢«ç ´åæ—¶è°ƒç”¨ï¼‰

```yaml
interface: record_contract_violation

input:
  project_id: string
  snapshot_id: string               # è¢«è¿åçš„å¿«ç…§ ID
  violations:
    - violation_id: string
      type: string                  # "signature_changed", "type_removed", etc.
      severity: string              # "critical", "warning"
      contract_type: string         # "function", "type", "interface"
      contract_name: string
      original: string
      current: string
      
output:
  record_id: string
  recorded_at: string
  status: "violation_recorded"
  
actions:
  - è®°å½•åˆ° .orchestra/contracts/violations/{timestamp}.json
  - æ›´æ–°é¡¹ç›®æ—¶é—´çº¿ï¼ˆä¸¥é‡äº‹ä»¶ï¼‰
  - è¿”å›è®°å½•ç¡®è®¤
```

---

### æ¥å£ 30: archive_change_request

**ç”¨é€”**: å­˜æ¡£å¥‘çº¦å˜æ›´è¯·æ±‚

```yaml
interface: archive_change_request

input:
  project_id: string
  change_request:
    id: string                      # å˜æ›´è¯·æ±‚ ID
    snapshot_id: string             # å½“å‰é”å®šçš„å¿«ç…§ ID
    changes:
      - change_type: string         # modify / add / remove
        contract_type: string
        contract_name: string
        from: string
        to: string
        reason: string
    requester: string
    requested_at: string

output:
  record_id: string
  storage_path: string
  status: "archived"

actions:
  - å­˜å‚¨åˆ° .orchestra/contracts/change_requests/{id}.json
  - æ›´æ–° change_requests_index.json
  - è¿”å›å­˜æ¡£ç¡®è®¤
```

---

### æ¥å£ 31: update_change_request_status

**ç”¨é€”**: æ›´æ–°å˜æ›´è¯·æ±‚çŠ¶æ€ï¼ˆæ‰¹å‡†/æ‹’ç»ï¼‰

```yaml
interface: update_change_request_status

input:
  change_request_id: string
  new_status: "approved" | "rejected"
  decided_by: string
  decided_at: string
  note: string | null               # æ‰¹å‡†å¤‡æ³¨æˆ–æ‹’ç»åŸå› 
  new_snapshot_id: string | null    # å¦‚æœæ‰¹å‡†ï¼Œæ–°å¿«ç…§ ID

output:
  updated: boolean
  record_id: string

actions:
  - æ›´æ–° change_requests/{id}.json çš„çŠ¶æ€
  - è®°å½•å†³ç­–åˆ°é¡¹ç›®æ—¶é—´çº¿
  - å¦‚æœæ‰¹å‡†ï¼Œå…³è”æ–°å¿«ç…§
```

---

### æ¥å£ 32: get_change_requests

**ç”¨é€”**: è·å–å˜æ›´è¯·æ±‚åˆ—è¡¨

```yaml
interface: get_change_requests

input:
  project_id: string
  status: "all" | "pending" | "approved" | "rejected"

output:
  total: number
  requests:
    - id: string
      status: string
      changes: array
      requester: string
      requested_at: string
      decided_by: string | null
      decided_at: string | null
```

---

### æ¥å£ 33: record_contract_rollback

**ç”¨é€”**: è®°å½•å¥‘çº¦å›æ»šäº‹ä»¶

```yaml
interface: record_contract_rollback

input:
  project_id: string
  rollback_record:
    id: string
    from_version: number
    to_version: number
    new_snapshot_id: string
    authorized_by: string
    reason: string
    rolled_back_at: string

output:
  record_id: string
  status: "recorded"

actions:
  - è®°å½•åˆ° .orchestra/contracts/rollbacks/{timestamp}.json
  - æ›´æ–°é¡¹ç›®æ—¶é—´çº¿ï¼ˆé‡è¦äº‹ä»¶ï¼‰
  - è¿”å›è®°å½•ç¡®è®¤
```

---

### æ¥å£ 34: record_audit_log

**ç”¨é€”**: è®°å½•å¥‘çº¦ç›¸å…³çš„å®¡è®¡æ—¥å¿—

```yaml
interface: record_audit_log

input:
  project_id: string
  log_entry:
    timestamp: string
    operation: string              # create_snapshot, lock_contract, approve_change, etc.
    level: "info" | "important" | "critical"
    actor: string
    details: object

output:
  logged: boolean

actions:
  - è¿½åŠ åˆ° .orchestra/contracts/audit_log.json
  - è¿”å›ç¡®è®¤
```

---

### æ¥å£ 35: get_audit_logs

**ç”¨é€”**: è·å–å¥‘çº¦å®¡è®¡æ—¥å¿—

```yaml
interface: get_audit_logs

input:
  project_id: string
  filters:
    level: string | null           # æŒ‰çº§åˆ«ç­›é€‰
    operation: string | null       # æŒ‰æ“ä½œç±»å‹ç­›é€‰
    actor: string | null           # æŒ‰æ“ä½œè€…ç­›é€‰
    from_date: string | null
    to_date: string | null
  limit: number                    # é»˜è®¤ 100

output:
  total: number
  logs:
    - timestamp: string
      operation: string
      level: string
      actor: string
      details: object
```

---

## ğŸ“– Layer 5: æŒç»­å­¦ä¹ æ¥å£è¯¦ç»†å®šä¹‰ ğŸ†•

> æ¥æºï¼šEverything Claude Code â†’ æ°¸ä¹å¤§å…¸èåˆ
> ã€Œæœå»·ç§¯ç´¯ç»éªŒï¼Œå½¢æˆæƒ¯ä¾‹ï¼Œåä¸–å¯å¾ªã€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Layer 5: æŒç»­å­¦ä¹ æœºåˆ¶                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                    â”‚
â”‚                                                                             â”‚
â”‚  å²å®˜ä¸ä»…è®°å½•å†å²ï¼Œè¿˜è¦ã€Œç¼–çº‚å…¸ç±ã€                                         â”‚
â”‚                                                                             â”‚
â”‚  - æ¯æ¬¡ä¼šè¯ = ä¸€æ®µå†å²                                                      â”‚
â”‚  - æå–çš„æ¨¡å¼ = å†æœæƒ¯ä¾‹                                                    â”‚
â”‚  - å­¦ä¹ æŠ€èƒ½ = ã€Šä¼šå…¸ã€‹æ¡ç›®                                                  â”‚
â”‚                                                                             â”‚
â”‚  æ ¸å¿ƒæµç¨‹ï¼š                                                                 â”‚
â”‚  ä¼šè¯ç»“æŸ â†’ è¯„ä¼°ä»·å€¼ â†’ æå–æ¨¡å¼ â†’ éªŒè¯æŠ€èƒ½ â†’ äººå·¥å®¡æ‰¹ â†’ åº”ç”¨åé¦ˆ           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¥å£ 36: evaluate_session

**ç”¨é€”**: ä¼šè¯ç»“æŸæ—¶è¯„ä¼°æ˜¯å¦å€¼å¾—æå–æ¨¡å¼

```yaml
interface: evaluate_session

input:
  session_id: string
  session_type: "plan" | "spec" | "code" | "test" | "review"
  session_stats:
    total_messages: number
    user_corrections: number     # ç”¨æˆ·çº æ­£æ¬¡æ•°
    decisions_made: number       # å†³ç­–æ•°é‡
    errors_resolved: number      # è§£å†³çš„é”™è¯¯æ•°é‡
    duration_minutes: number

output:
  worth_extracting: boolean      # æ˜¯å¦å€¼å¾—æå–
  reasons: array                 # åˆ¤æ–­ç†ç”±
  recommended_patterns: array    # æ¨èæå–çš„æ¨¡å¼ç±»å‹
  confidence: "high" | "medium" | "low"

evaluation_criteria:
  min_session_length: 10         # æœ€å°‘ 10 æ¡å¯¹è¯
  extraction_triggers:
    - "ç”¨æˆ·çº æ­£æ¬¡æ•° >= 2"         # è¯´æ˜æœ‰å­¦ä¹ ç‚¹
    - "è§£å†³é”™è¯¯ >= 1"             # æœ‰è°ƒè¯•ç»éªŒ
    - "å†³ç­–æ•°é‡ >= 3"             # æœ‰å†³ç­–ç»éªŒ
    - "ä¼šè¯æ—¶é•¿ >= 15 åˆ†é’Ÿ"       # è¶³å¤Ÿæ·±å…¥
```

---

### æ¥å£ 37: extract_patterns

**ç”¨é€”**: ä»ä¼šè¯ä¸­æå–å¯å¤ç”¨æ¨¡å¼

```yaml
interface: extract_patterns

input:
  session_id: string
  pattern_types:                 # è¦æå–çš„æ¨¡å¼ç±»å‹
    - "error_resolution"         # é”™è¯¯è§£å†³æ–¹æ¡ˆ
    - "user_corrections"         # ç”¨æˆ·çº æ­£ï¼ˆå­¦ä¹ ç”¨æˆ·åå¥½ï¼‰
    - "workarounds"              # å˜é€šæ–¹æ¡ˆ
    - "debugging_techniques"     # è°ƒè¯•æŠ€å·§
    - "project_specific"         # é¡¹ç›®ç‰¹å®šæƒ¯ä¾‹
    - "decision_patterns"        # å†³ç­–æ¨¡å¼

output:
  extracted_patterns:
    - pattern_id: string
      type: string
      title: string
      trigger: string            # è§¦å‘æ¡ä»¶
      solution: string           # è§£å†³æ–¹æ¡ˆ
      context: string            # ä¸Šä¸‹æ–‡
      source_messages: array     # æ¥æºå¯¹è¯ ID
      confidence: number         # ç½®ä¿¡åº¦ 0-1
  total_extracted: number
  status: "patterns_extracted"
```

#### æ¨¡å¼ç±»å‹å®šä¹‰

```yaml
pattern_definitions:

  error_resolution:
    description: "ç‰¹å®šé”™è¯¯çš„è§£å†³æ–¹æ¡ˆ"
    example:
      trigger: "TypeScript æŠ¥é”™: Property 'x' does not exist"
      solution: "æ·»åŠ ç±»å‹å£°æ˜æˆ–ä½¿ç”¨ as æ–­è¨€"

  user_corrections:
    description: "ç”¨æˆ·çº æ­£ Agent çš„åœ°æ–¹ = ç”¨æˆ·åå¥½"
    example:
      trigger: "Agent å»ºè®®ä½¿ç”¨ class ç»„ä»¶"
      solution: "ç”¨æˆ·åå¥½å‡½æ•°ç»„ä»¶ + hooks"

  workarounds:
    description: "æ¡†æ¶/åº“çš„å˜é€šæ–¹æ¡ˆ"
    example:
      trigger: "Next.js 13 app router ä¸æ”¯æŒæŸåŠŸèƒ½"
      solution: "ä½¿ç”¨ pages router æˆ– workaround æ–¹æ¡ˆ"

  debugging_techniques:
    description: "æœ‰æ•ˆçš„è°ƒè¯•æ–¹æ³•"
    example:
      trigger: "API è¿”å› 500 é”™è¯¯"
      solution: "å…ˆæ£€æŸ¥è¯·æ±‚ payloadï¼Œå†æ£€æŸ¥æœåŠ¡ç«¯æ—¥å¿—"

  project_specific:
    description: "é¡¹ç›®ç‰¹å®šçš„çº¦å®š"
    example:
      trigger: "éœ€è¦æ·»åŠ æ–° API"
      solution: "æ­¤é¡¹ç›® API æ”¾åœ¨ /api/v1/ ä¸‹ï¼Œä½¿ç”¨ REST é£æ ¼"

  decision_patterns:
    description: "å†³ç­–æ¨¡å¼ï¼ˆçš‡ä¸Šçš„å†³ç­–å€¾å‘ï¼‰"
    example:
      trigger: "æŠ€æœ¯é€‰å‹æ—¶æœ‰å¤šä¸ªé€‰é¡¹"
      solution: "çš‡ä¸Šå€¾å‘äºï¼šç¨³å®š > æ–°æ½®ï¼Œç®€å• > å¤æ‚"
```

---

### æ¥å£ 38: save_learned_skill

**ç”¨é€”**: ä¿å­˜æå–çš„æ¨¡å¼ä¸ºå­¦ä¹ æŠ€èƒ½

```yaml
interface: save_learned_skill

input:
  project_id: string
  skill:
    pattern_id: string
    name: string                 # æŠ€èƒ½åç§°
    type: string                 # æ¨¡å¼ç±»å‹
    trigger: string
    solution: string
    tags: array                  # æ ‡ç­¾ï¼ˆä¾¿äºæœç´¢ï¼‰
    auto_apply: boolean          # æ˜¯å¦è‡ªåŠ¨åº”ç”¨
    requires_confirmation: boolean  # æ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤

output:
  skill_id: string
  storage_path: string           # å­˜å‚¨è·¯å¾„
  status: "skill_saved"
  initial_state: "pending"       # åˆå§‹çŠ¶æ€ä¸ºå¾…éªŒè¯
```

---

### æ¥å£ 39: get_learned_skills

**ç”¨é€”**: è·å–å·²å­¦ä¹ çš„æŠ€èƒ½åˆ—è¡¨

```yaml
interface: get_learned_skills

input:
  project_id: string | null      # ä¸ºç©ºåˆ™è·å–å…¨å±€æŠ€èƒ½
  filters:
    type: string | null          # æŒ‰ç±»å‹ç­›é€‰
    tags: array | null           # æŒ‰æ ‡ç­¾ç­›é€‰
    state: string | null         # æŒ‰çŠ¶æ€ç­›é€‰
    auto_apply: boolean | null   # æŒ‰æ˜¯å¦è‡ªåŠ¨åº”ç”¨ç­›é€‰

output:
  total: number
  skills:
    - skill_id: string
      name: string
      type: string
      trigger: string
      state: string              # pending/verified/approved/trial/stable/deprecated
      times_applied: number      # åº”ç”¨æ¬¡æ•°
      last_applied: datetime
      effectiveness: number      # æœ‰æ•ˆæ€§è¯„åˆ† 0-1
```

---

### æ¥å£ 40: apply_learned_pattern

**ç”¨é€”**: åº”ç”¨å·²å­¦ä¹ çš„æ¨¡å¼

```yaml
interface: apply_learned_pattern

input:
  skill_id: string
  current_context: string        # å½“å‰ä¸Šä¸‹æ–‡
  auto_applied: boolean          # æ˜¯å¦è‡ªåŠ¨è§¦å‘

output:
  applied: boolean
  suggestion: string             # å»ºè®®å†…å®¹
  confidence: number
  requires_confirmation: boolean

actions:
  - éªŒè¯æŠ€èƒ½çŠ¶æ€ä¸º approved/trial/stable
  - è®°å½•åº”ç”¨äº‹ä»¶
  - æ›´æ–° times_applied è®¡æ•°
  - å¦‚æœ requires_confirmation=trueï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
  - å¦‚æœæ˜¯ trial çŠ¶æ€ï¼Œæ ‡è®°ä¸ºè¯•ç”¨æœŸåº”ç”¨
```

---

### æ¥å£ 41: feedback_on_pattern

**ç”¨é€”**: è®°å½•æ¨¡å¼åº”ç”¨æ•ˆæœï¼ˆç”¨äºæ”¹è¿›ï¼‰

```yaml
interface: feedback_on_pattern

input:
  skill_id: string
  feedback:
    helpful: boolean             # æ˜¯å¦æœ‰å¸®åŠ©
    user_action: "accepted" | "modified" | "rejected"
    modification: string | null  # å¦‚æœä¿®æ”¹ï¼Œè®°å½•ä¿®æ”¹å†…å®¹

output:
  feedback_id: string
  effectiveness_updated: number  # æ›´æ–°åçš„æœ‰æ•ˆæ€§è¯„åˆ†
  state_changed: boolean         # çŠ¶æ€æ˜¯å¦å˜æ›´
  new_state: string | null       # æ–°çŠ¶æ€

actions:
  - è®°å½•åé¦ˆ
  - é‡æ–°è®¡ç®— effectiveness è¯„åˆ†
  - å¦‚æœ trial çŠ¶æ€æ”¶åˆ°è´Ÿé¢åé¦ˆï¼Œé™çº§ä¸º deprecated
  - å¦‚æœ trial çŠ¶æ€ 3 æ¬¡æ­£é¢åé¦ˆï¼Œå‡çº§ä¸º stable
  - å¦‚æœ stable çŠ¶æ€ç´¯è®¡ 3 æ¬¡è´Ÿé¢åé¦ˆï¼Œé™çº§ä¸º deprecated
```

---

### æ¥å£ 42: generate_learning_report

**ç”¨é€”**: ç”Ÿæˆå­¦ä¹ æŠ¥å‘Šå¹¶å†³å®šé€šçŸ¥çº§åˆ«

```yaml
interface: generate_learning_report

input:
  session_id: string

output:
  report:
    session_summary:
      duration: string
      messages: number
      corrections: number
      errors_resolved: number

    patterns_extracted:
      total: number
      by_type:
        error_resolution: number
        user_corrections: number
        decision_patterns: number

    agent_optimization_suggestions:
      - agent: string              # å“ªä¸ª Agent
        issue_type: string         # é—®é¢˜ç±»å‹
        frequency: number          # å‡ºç°é¢‘ç‡
        suggestion: string         # å»ºè®®
        impact: "high" | "medium" | "low"
        evidence: array            # è¯æ®ï¼ˆå¯¹è¯ç‰‡æ®µï¼‰

    new_skills_pending_approval:
      - skill_id: string
        name: string
        trigger: string
        solution: string
        confidence: number
        validation_result: object

    notification_level: "info" | "attention" | "urgent"

  report_path: string
  status: "report_generated"
```

#### é€šçŸ¥çº§åˆ«è§„åˆ™

```yaml
notification_rules:

  urgent:                              # ç´§æ€¥ï¼šç«‹å³é€šçŸ¥
    conditions:
      - "å‘ç° Agent é‡å¤çŠ¯åŒä¸€é”™è¯¯ >= 3 æ¬¡"
      - "ç”¨æˆ·çº æ­£åŒä¸€ç±»é—®é¢˜ >= 2 æ¬¡"
      - "å‘ç°æ½œåœ¨é“å¾‹è¿è§„"
    action: "ä¼šè¯ç»“æŸæ—¶ç«‹å³æ˜¾ç¤ºæŠ¥å‘Š"

  attention:                           # æ³¨æ„ï¼šä¸‹æ¬¡ä¼šè¯æé†’
    conditions:
      - "æå–åˆ°é«˜ç½®ä¿¡åº¦æ¨¡å¼ >= 2 ä¸ª"
      - "å‘ç° Agent å¯ä¼˜åŒ–ç‚¹"
    action: "ä¸‹æ¬¡ä¼šè¯å¼€å§‹æ—¶æ˜¾ç¤ºæ‘˜è¦"

  info:                                # ä¿¡æ¯ï¼šé™é»˜è®°å½•
    conditions:
      - "æ­£å¸¸å­¦ä¹ ï¼Œæ— æ˜¾è‘—å‘ç°"
    action: "ä»…å­˜æ¡£ï¼Œä¸ä¸»åŠ¨é€šçŸ¥"
```

---

### æ¥å£ 43: validate_skill

**ç”¨é€”**: éªŒè¯æŠ€èƒ½æœ‰æ•ˆæ€§

```yaml
interface: validate_skill

input:
  skill_id: string
  validation_type: "sandbox" | "historical" | "manual"

output:
  validation_result:
    passed: boolean
    method: string
    details:
      tests_run: number
      tests_passed: number
      pass_rate: number
      consistency_rate: number   # å†å²ä¸€è‡´ç‡

    issues_found: array
    confidence_adjusted: number  # éªŒè¯åè°ƒæ•´çš„ç½®ä¿¡åº¦

  recommendation: "approve" | "modify" | "reject"
  status: "validation_complete"
```

#### éªŒè¯æ–¹æ³•

```yaml
validation_methods:

  sandbox:
    description: "åœ¨éš”ç¦»ç¯å¢ƒä¸­æ¨¡æ‹Ÿåº”ç”¨"
    steps:
      1: "æ„é€ è§¦å‘åœºæ™¯"
      2: "åº”ç”¨æŠ€èƒ½æ–¹æ¡ˆ"
      3: "æ£€æŸ¥ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ"
    é€‚ç”¨: "error_resolution, workarounds"
    pass_criteria: "æ¨¡æ‹Ÿç»“æœç¬¦åˆé¢„æœŸ"

  historical:
    description: "æ£€æŸ¥è¯¥æ¨¡å¼åœ¨å†å²å¯¹è¯ä¸­çš„æ•ˆæœ"
    steps:
      1: "æ‰¾åˆ°å†å²ä¸Šç±»ä¼¼çš„è§¦å‘åœºæ™¯"
      2: "æ£€æŸ¥å½“æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯å¦ä¸è¯¥æŠ€èƒ½ä¸€è‡´"
      3: "ç»Ÿè®¡ä¸€è‡´æ€§æ¯”ä¾‹"
    é€‚ç”¨: "user_corrections, decision_patterns"
    pass_criteria: "å†å²ä¸€è‡´ç‡ >= 80%"

  manual:
    description: "çš‡ä¸Šäº²è‡ªå®¡æ‰¹"
    é€‚ç”¨: "æ‰€æœ‰ auto_apply=true çš„æŠ€èƒ½"
    æµç¨‹:
      1: "å±•ç¤ºæŠ€èƒ½è¯¦æƒ…"
      2: "å±•ç¤ºè¯æ®æ¥æº"
      3: "å±•ç¤ºè‡ªåŠ¨éªŒè¯ç»“æœ"
      4: "çš‡ä¸Šå†³å®šï¼šæ‰¹å‡†/ä¿®æ”¹/æ‹’ç»"
```

#### éªŒè¯æŒ‡æ ‡

```yaml
validation_metrics:

  pass@1:
    description: "é¦–æ¬¡åº”ç”¨æˆåŠŸç‡"
    target: ">= 70%"

  pass@3:
    description: "3æ¬¡å†…è‡³å°‘1æ¬¡æˆåŠŸ"
    target: ">= 90%"

  consistency:
    description: "ä¸å†å²è¡Œä¸ºä¸€è‡´æ€§"
    target: ">= 80%"

  user_acceptance:
    description: "ç”¨æˆ·æ¥å—ç‡"
    target: ">= 80%"
    formula: "(accepted + modified) / total"
```

---

### æŠ€èƒ½ç”Ÿå‘½å‘¨æœŸ

```yaml
skill_lifecycle:

  states:
    pending:
      description: "åˆšæå–ï¼Œç­‰å¾…éªŒè¯"
      can_apply: false

    validating:
      description: "æ­£åœ¨è‡ªåŠ¨éªŒè¯"
      can_apply: false

    verified:
      description: "è‡ªåŠ¨éªŒè¯é€šè¿‡ï¼Œç­‰å¾…äººå·¥å®¡æ‰¹"
      can_apply: false

    failed:
      description: "è‡ªåŠ¨éªŒè¯å¤±è´¥"
      can_apply: false
      next: "human_review æˆ– discard"

    approved:
      description: "çš‡ä¸Šæ‰¹å‡†ï¼Œå¯ä»¥åº”ç”¨"
      can_apply: true

    trial:
      description: "æ‰¹å‡†åå‰3æ¬¡åº”ç”¨ä¸ºè¯•ç”¨æœŸ"
      can_apply: true
      monitoring: true

    stable:
      description: "è¯•ç”¨æœŸé€šè¿‡ï¼ˆ3æ¬¡åº”ç”¨æ— è´Ÿé¢åé¦ˆï¼‰"
      can_apply: true
      auto_apply_eligible: true

    deprecated:
      description: "å·²åºŸå¼ƒï¼ˆå¤šæ¬¡è´Ÿé¢åé¦ˆï¼‰"
      can_apply: false

  transitions:
    pending â†’ validating: "è‡ªåŠ¨è§¦å‘"
    validating â†’ verified: "è‡ªåŠ¨éªŒè¯é€šè¿‡"
    validating â†’ failed: "è‡ªåŠ¨éªŒè¯å¤±è´¥"
    verified â†’ approved: "çš‡ä¸Šæ‰¹å‡†"
    approved â†’ trial: "é¦–æ¬¡åº”ç”¨"
    trial â†’ stable: "3æ¬¡åº”ç”¨æ— è´Ÿé¢åé¦ˆ"
    trial â†’ deprecated: "è¯•ç”¨æœŸæ”¶åˆ°è´Ÿé¢åé¦ˆ"
    stable â†’ deprecated: "ç´¯è®¡è´Ÿé¢åé¦ˆ >= 3"
```

---

## ğŸ“– Layer 6: çŠ¶æ€åŒæ­¥æ¥å£è¯¦ç»†å®šä¹‰ ğŸ†• v1.9

> è§£å†³å¤š Agent åä½œæ—¶çš„çŠ¶æ€ä¸€è‡´æ€§é—®é¢˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  çŠ¶æ€æ¡æ‰‹æœºåˆ¶                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚                                                                             â”‚
â”‚  é—®é¢˜ï¼šå¤š Agent æµè½¬æ—¶ï¼ŒçŠ¶æ€å¯èƒ½ä¸ä¸€è‡´                                      â”‚
â”‚  - Agent è¯»å–çš„çŠ¶æ€å¯èƒ½æ˜¯è¿‡æ—¶çš„                                            â”‚
â”‚  - Agent å¯¹çŠ¶æ€çš„ç†è§£å¯èƒ½æœ‰è¯¯                                              â”‚
â”‚  - .orchestra/ ç›®å½•å¯èƒ½è¢«æ„å¤–ä¿®æ”¹                                          â”‚
â”‚                                                                             â”‚
â”‚  è§£å†³æ–¹æ¡ˆï¼šçŠ¶æ€æ¡æ‰‹                                                         â”‚
â”‚                                                                             â”‚
â”‚   Agent å¯åŠ¨                                                                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚  handshake()    â”‚  â† å‘ŠçŸ¥å²å®˜"æˆ‘æ¥äº†ï¼Œæˆ‘æ˜¯è°"                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚            â”‚                                                                â”‚
â”‚            â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚ å²å®˜è¿”å›å½“å‰çŠ¶æ€ â”‚  â† é¡¹ç›®çŠ¶æ€ + ä¸Šä¸€é˜¶æ®µäº§å‡º + å¾…åŠäº‹é¡¹               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚            â”‚                                                                â”‚
â”‚            â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚ verify_state_   â”‚  â† Agent ç¡®è®¤ç†è§£æ˜¯å¦æ­£ç¡®                            â”‚
â”‚   â”‚ understanding() â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚            â”‚                                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚     â–¼             â–¼                                                         â”‚
â”‚  ä¸€è‡´ âœ…      ä¸ä¸€è‡´ âŒ                                                      â”‚
â”‚     â”‚             â”‚                                                         â”‚
â”‚     â–¼             â–¼                                                         â”‚
â”‚  å¼€å§‹å·¥ä½œ    report_state_mismatch()                                        â”‚
â”‚                  â”‚                                                          â”‚
â”‚                  â–¼                                                          â”‚
â”‚             sync_state() ä¿®å¤                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¥å£ 44: handshake

**ç”¨é€”**: Agent å¯åŠ¨æ—¶è¿›è¡ŒçŠ¶æ€æ¡æ‰‹

```yaml
interface: handshake

input:
  agent_id: string              # Agent æ ‡è¯†
  agent_type: "plan" | "spec" | "code" | "test" | "review"
  project_id: string | null     # é¡¹ç›® IDï¼ˆä¸ºç©ºåˆ™æŸ¥æ‰¾æœ€è¿‘é¡¹ç›®ï¼‰
  session_context:
    is_new_session: boolean     # æ˜¯å¦æ–°ä¼šè¯
    resume_from: string | null  # æ¢å¤ç‚¹ï¼ˆå¦‚æœ‰ï¼‰

output:
  handshake_id: string          # æ¡æ‰‹ IDï¼ˆç”¨äºåç»­éªŒè¯ï¼‰
  project_state:
    project_id: string
    project_name: string
    current_stage: string
    stage_status: string
    last_activity: datetime
  previous_stage_outputs:       # ä¸Šä¸€é˜¶æ®µäº§å‡ºæ‘˜è¦
    stage: string
    key_outputs: array
    decisions_made: array
  pending_items:                # å¾…å¤„ç†äº‹é¡¹
    - item: string
      priority: string
      from_stage: string
  state_hash: string            # çŠ¶æ€å“ˆå¸Œï¼ˆç”¨äºéªŒè¯ï¼‰
  status: "handshake_complete"

actions:
  - è®°å½• Agent å¯åŠ¨äº‹ä»¶
  - è®¡ç®—å½“å‰çŠ¶æ€å“ˆå¸Œ
  - è¿”å›çŠ¶æ€æ‘˜è¦
  - æ ‡è®°æ¡æ‰‹æ—¶é—´
```

### æ¥å£ 45: verify_state_understanding

**ç”¨é€”**: Agent ç¡®è®¤å¯¹çŠ¶æ€çš„ç†è§£æ˜¯å¦æ­£ç¡®

```yaml
interface: verify_state_understanding

input:
  handshake_id: string          # æ¡æ‰‹ ID
  agent_understanding:
    current_stage: string       # Agent ç†è§£çš„å½“å‰é˜¶æ®µ
    previous_outputs: array     # Agent ç†è§£çš„ä¸Šé˜¶æ®µäº§å‡º
    pending_work: array         # Agent ç†è§£çš„å¾…åŠäº‹é¡¹
    key_decisions: array        # Agent ç†è§£çš„å…³é”®å†³ç­–

output:
  verified: boolean             # æ˜¯å¦ä¸€è‡´
  mismatches:                   # ä¸ä¸€è‡´é¡¹
    - field: string             # å­—æ®µå
      expected: any             # æœŸæœ›å€¼ï¼ˆå²å®˜è®°å½•çš„ï¼‰
      actual: any               # å®é™…å€¼ï¼ˆAgent ç†è§£çš„ï¼‰
      severity: "critical" | "warning" | "info"
  recommendation: string        # å»ºè®®åŠ¨ä½œ
  status: "verified" | "mismatch_detected"

actions:
  - å¯¹æ¯” Agent ç†è§£ä¸å²å®˜è®°å½•
  - æ ‡è®°ä¸ä¸€è‡´é¡¹
  - ç»™å‡ºä¿®å¤å»ºè®®
```

### æ¥å£ 46: report_state_mismatch

**ç”¨é€”**: Agent æŠ¥å‘Šå‘ç°çš„çŠ¶æ€ä¸ä¸€è‡´

```yaml
interface: report_state_mismatch

input:
  handshake_id: string
  mismatch_details:
    - field: string
      expected: any
      actual: any
      discovered_by: string     # å‘ç°è€…ï¼ˆAgent IDï¼‰
      impact: string            # å½±å“è¯´æ˜

output:
  mismatch_id: string           # ä¸ä¸€è‡´è®°å½• ID
  logged: boolean
  auto_fix_possible: boolean    # æ˜¯å¦å¯è‡ªåŠ¨ä¿®å¤
  manual_intervention_needed: boolean
  status: "mismatch_reported"

actions:
  - è®°å½•ä¸ä¸€è‡´äº‹ä»¶
  - åˆ†æå½±å“èŒƒå›´
  - åˆ¤æ–­æ˜¯å¦å¯è‡ªåŠ¨ä¿®å¤
  - å¦‚éœ€äººå·¥ä»‹å…¥ï¼Œé€šçŸ¥çš‡ä¸Š
```

### æ¥å£ 47: sync_state

**ç”¨é€”**: å¼ºåˆ¶åŒæ­¥çŠ¶æ€ï¼ˆä¿®å¤ä¸ä¸€è‡´ï¼‰

```yaml
interface: sync_state

input:
  mismatch_id: string           # ä¸ä¸€è‡´è®°å½• ID
  sync_strategy: "use_archive" | "use_agent" | "merge" | "ask_user"
  confirmation: boolean         # æ˜¯å¦å·²ç¡®è®¤

output:
  synced: boolean
  sync_result:
    strategy_used: string
    fields_updated: array
    backup_created: boolean
    backup_id: string | null
  new_state_hash: string
  status: "state_synced" | "sync_failed" | "awaiting_confirmation"

actions:
  - å¦‚æœªç¡®è®¤ï¼Œå…ˆè¯·æ±‚ç¡®è®¤
  - å¤‡ä»½å½“å‰çŠ¶æ€
  - æ‰§è¡ŒåŒæ­¥ç­–ç•¥
  - æ›´æ–°çŠ¶æ€å“ˆå¸Œ
  - è®°å½•åŒæ­¥äº‹ä»¶
```

### æ¡æ‰‹æµç¨‹ç¤ºä¾‹

```yaml
handshake_example:

  step_1_agent_starts:
    agent: "Spec Agent å¯åŠ¨"
    action: "è°ƒç”¨ handshake()"
    params:
      agent_id: "spec-agent"
      agent_type: "spec"
      project_id: "blog-20260125"

  step_2_archivist_response:
    archivist: "å²å®˜è¿”å›çŠ¶æ€"
    response:
      handshake_id: "hs_20260125_140000"
      project_state:
        current_stage: "spec"
        stage_status: "in_progress"
      previous_stage_outputs:
        stage: "plan"
        key_outputs: ["plan-report.md"]
        decisions_made:
          - "ç”¨æˆ·è§’è‰²ï¼šæ™®é€šç”¨æˆ· + ç®¡ç†å‘˜"
          - "æŠ€æœ¯æ ˆï¼šReact + NestJS"
      pending_items:
        - item: "è®¾è®¡ API å¥‘çº¦"
        - item: "è®¾è®¡æ•°æ®æ¨¡å‹"
      state_hash: "sha256:abc123..."

  step_3_agent_verify:
    agent: "Spec Agent ç¡®è®¤ç†è§£"
    action: "è°ƒç”¨ verify_state_understanding()"
    params:
      handshake_id: "hs_20260125_140000"
      agent_understanding:
        current_stage: "spec"
        previous_outputs: ["plan-report.md"]
        pending_work: ["è®¾è®¡ API", "è®¾è®¡æ•°æ®æ¨¡å‹"]
        key_decisions: ["React + NestJS", "ç”¨æˆ·è§’è‰²ä¸¤ç§"]

  step_4_verification_result:
    archivist: "éªŒè¯é€šè¿‡"
    response:
      verified: true
      mismatches: []
      status: "verified"

  step_5_agent_proceed:
    agent: "Spec Agent å¼€å§‹å·¥ä½œ"
    note: "çŠ¶æ€å·²ç¡®è®¤ï¼Œå¯ä»¥å®‰å…¨åœ°åŸºäºè¿™äº›ä¿¡æ¯å·¥ä½œ"
```

### æ–°å¢é“å¾‹

```yaml
  DA-13:
    name: "Agent å¯åŠ¨å¿…æ¡æ‰‹"
    rule: "æ¯ä¸ª Agent å¯åŠ¨æ—¶å¿…é¡»è°ƒç”¨ handshake() ç¡®è®¤çŠ¶æ€"
    è¿å: "è·³è¿‡æ¡æ‰‹ç›´æ¥å·¥ä½œ"
    consequence: "å¯èƒ½åŸºäºè¿‡æ—¶æˆ–é”™è¯¯çš„çŠ¶æ€å·¥ä½œ"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥ Agent å¯åŠ¨æ—¥å¿—"
        2: "éªŒè¯æ˜¯å¦æœ‰å¯¹åº”çš„ handshake è®°å½•"
        3: "æ— æ¡æ‰‹è®°å½• = è¿è§„"
      è¯æ®: "handshake_id"
```

---

### æŒç»­å­¦ä¹ è§¦å‘æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  æŒç»­å­¦ä¹ è§¦å‘æµç¨‹                                                           â”‚
â”‚                                                                             â”‚
â”‚   ä¼šè¯è¿›è¡Œä¸­                        ä¼šè¯ç»“æŸæ—¶                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚             â”‚                   â”‚                         â”‚            â”‚
â”‚   â”‚  è®°å½•å¯¹è¯   â”‚   â”€SessionEndâ”€â†’   â”‚  evaluate_session()     â”‚            â”‚
â”‚   â”‚  è®°å½•çº æ­£   â”‚                   â”‚  ã€Œè¯„ä¼°æ˜¯å¦å€¼å¾—æå–ã€    â”‚            â”‚
â”‚   â”‚  è®°å½•å†³ç­–   â”‚                   â”‚                         â”‚            â”‚
â”‚   â”‚             â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚                            â”‚
â”‚                                                â–¼                            â”‚
â”‚                                      worth_extracting?                      â”‚
â”‚                                                â”‚                            â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                               â”‚ YES                        NO   â”‚          â”‚
â”‚                               â–¼                             â–¼   â”‚          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                    â”‚ extract_patterns â”‚           â”‚  ç»“æŸ       â”‚          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                             â”‚                                              â”‚
â”‚                             â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ validate_skill() â”‚                                    â”‚
â”‚                    â”‚ (è‡ªåŠ¨éªŒè¯)       â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                             â”‚                                              â”‚
â”‚                             â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ save_learned_    â”‚                                    â”‚
â”‚                    â”‚ skill()          â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                             â”‚                                              â”‚
â”‚                             â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ generate_        â”‚                                    â”‚
â”‚                    â”‚ learning_report()â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                             â”‚                                              â”‚
â”‚                             â–¼                                              â”‚
â”‚                    æ ¹æ® notification_level é€šçŸ¥çš‡ä¸Š                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æŒç»­å­¦ä¹ å­˜æ¡£ç»“æ„

```
.orchestra/
â”œâ”€â”€ ... (åŸæœ‰ç»“æ„)
â””â”€â”€ learned/                         # æŒç»­å­¦ä¹ ç›®å½•
    â”œâ”€â”€ config.json                  # å­¦ä¹ é…ç½®
    â”œâ”€â”€ skills-index.json            # æŠ€èƒ½ç´¢å¼•
    â”œâ”€â”€ patterns-log.md              # æ¨¡å¼æå–æ—¥å¿—ï¼ˆäººç±»å¯è¯»ï¼‰
    â”œâ”€â”€ skills/
    â”‚   â”œâ”€â”€ {skill_id_1}.json        # æŠ€èƒ½è¯¦æƒ…
    â”‚   â”œâ”€â”€ {skill_id_2}.json
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ validations/
    â”‚   â””â”€â”€ {skill_id}_validation.json # éªŒè¯è®°å½•
    â”œâ”€â”€ feedback/
    â”‚   â””â”€â”€ {skill_id}_feedback.json # åé¦ˆå†å²
    â”œâ”€â”€ reports/
    â”‚   â””â”€â”€ {session_id}_report.md   # å­¦ä¹ æŠ¥å‘Š
    â””â”€â”€ statistics.json              # å­¦ä¹ ç»Ÿè®¡
```

### é…ç½®æ–‡ä»¶

```json
// .orchestra/learned/config.json
{
  "min_session_length": 10,
  "extraction_threshold": "medium",
  "auto_approve": false,
  "patterns_to_detect": [
    "error_resolution",
    "user_corrections",
    "workarounds",
    "debugging_techniques",
    "project_specific",
    "decision_patterns"
  ],
  "ignore_patterns": [
    "simple_typos",
    "one_time_fixes",
    "external_api_issues"
  ],
  "max_skills_per_type": 20,
  "auto_apply_threshold": 0.8,
  "trial_applications_required": 3
}
```

---

### é¢„ç½®æŠ€èƒ½åŒ…ï¼ˆå†·å¯åŠ¨æ–¹æ¡ˆï¼‰ğŸ†• v1.9

```yaml
preset_skills:

  description: |
    æ–°ç”¨æˆ·æ²¡æœ‰å†å²æ•°æ®ï¼Œæ— æ³•ä»ä¼šè¯ä¸­å­¦ä¹ ã€‚
    é¢„ç½®æŠ€èƒ½åŒ…æä¾›å¼€ç®±å³ç”¨çš„é€šç”¨æŠ€èƒ½ï¼Œè§£å†³å†·å¯åŠ¨é—®é¢˜ã€‚

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  é¢„ç½®æŠ€èƒ½åŒ…æ¶æ„
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #
  #  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  #  â”‚                                                             â”‚
  #  â”‚   å…¨å±€é¢„ç½®                    é¡¹ç›®çº§å­¦ä¹                     â”‚
  #  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
  #  â”‚   â”‚               â”‚          â”‚               â”‚             â”‚
  #  â”‚   â”‚  é€šç”¨æŠ€èƒ½åŒ…   â”‚   â”€â”€â”€â–¶   â”‚  é¡¹ç›®ç‰¹å®šæŠ€èƒ½ â”‚             â”‚
  #  â”‚   â”‚  (åªè¯»)       â”‚          â”‚  (å¯ä¿®æ”¹)     â”‚             â”‚
  #  â”‚   â”‚               â”‚          â”‚               â”‚             â”‚
  #  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  #  â”‚                                                             â”‚
  #  â”‚   æ¥æºï¼šæ°¸ä¹å¤§å…¸å†…ç½®         æ¥æºï¼šä¼šè¯å­¦ä¹                 â”‚
  #  â”‚   æ›´æ–°ï¼šéšç‰ˆæœ¬æ›´æ–°           æ›´æ–°ï¼šæ¯æ¬¡ä¼šè¯                â”‚
  #  â”‚   çŠ¶æ€ï¼šstable               çŠ¶æ€ï¼šéœ€éªŒè¯                  â”‚
  #  â”‚                                                             â”‚
  #  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  #
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # é¢„ç½®æŠ€èƒ½åŒ…ç±»åˆ«
  categories:

    error_resolution:
      name: "å¸¸è§é”™è¯¯è§£å†³æ–¹æ¡ˆ"
      description: "å¼€å‘ä¸­å¸¸è§é”™è¯¯çš„è§£å†³æ–¹æ¡ˆ"
      count: 20
      examples:
        - skill_id: "preset_err_001"
          name: "TypeScript ç±»å‹é”™è¯¯ï¼šProperty does not exist"
          trigger: "Property 'xxx' does not exist on type"
          solution: |
            1. æ£€æŸ¥ç±»å‹å®šä¹‰æ˜¯å¦æ­£ç¡®
            2. ä½¿ç”¨ç±»å‹æ–­è¨€ (as Type)
            3. ä½¿ç”¨å¯é€‰é“¾ (?.)
            4. æ‰©å±•æ¥å£å®šä¹‰
          tags: ["typescript", "type-error"]

        - skill_id: "preset_err_002"
          name: "React Hooks è§„åˆ™è¿å"
          trigger: "React Hook .* is called conditionally"
          solution: |
            Hooks å¿…é¡»åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼š
            âŒ if (condition) { useState(...) }
            âœ… const [state, setState] = useState(...)
               if (condition) { /* use state */ }
          tags: ["react", "hooks"]

        - skill_id: "preset_err_003"
          name: "Prisma å…³ç³»æŸ¥è¯¢é”™è¯¯"
          trigger: "Unknown arg .* in .*.include"
          solution: |
            æ£€æŸ¥ Prisma Schema ä¸­çš„å…³ç³»å®šä¹‰ï¼š
            1. ç¡®è®¤ relation åç§°æ­£ç¡®
            2. è¿è¡Œ npx prisma generate é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯
            3. æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨
          tags: ["prisma", "database"]

    debugging_techniques:
      name: "è°ƒè¯•æŠ€å·§"
      description: "æœ‰æ•ˆçš„è°ƒè¯•æ–¹æ³•"
      count: 10
      examples:
        - skill_id: "preset_debug_001"
          name: "API 500 é”™è¯¯æ’æŸ¥"
          trigger: "API è¿”å› 500 Internal Server Error"
          solution: |
            æ’æŸ¥é¡ºåºï¼š
            1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆå…·ä½“é”™è¯¯ä¿¡æ¯ï¼‰
            2. æ£€æŸ¥è¯·æ±‚ payload æ ¼å¼
            3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
            4. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
            5. æœ¬åœ°å¤ç°éªŒè¯
          tags: ["api", "debug", "500"]

        - skill_id: "preset_debug_002"
          name: "å‰ç«¯ç™½å±æ’æŸ¥"
          trigger: "é¡µé¢ç™½å±|blank page|nothing renders"
          solution: |
            æ’æŸ¥é¡ºåºï¼š
            1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°çœ‹ JS é”™è¯¯
            2. æ£€æŸ¥ Network æ˜¯å¦æœ‰è¯·æ±‚å¤±è´¥
            3. æ£€æŸ¥ React/Vue ç»„ä»¶æ˜¯å¦æœ‰æœªæ•è·å¼‚å¸¸
            4. æ£€æŸ¥è·¯ç”±é…ç½®
            5. æ£€æŸ¥æ„å»ºäº§ç‰©æ˜¯å¦æ­£ç¡®
          tags: ["frontend", "debug", "blank"]

    best_practices:
      name: "æœ€ä½³å®è·µ"
      description: "ä»£ç è´¨é‡å’Œæ¶æ„çš„æœ€ä½³å®è·µ"
      count: 15
      examples:
        - skill_id: "preset_bp_001"
          name: "API å“åº”æ ¼å¼æ ‡å‡†åŒ–"
          trigger: "è®¾è®¡ API å“åº”æ ¼å¼"
          solution: |
            æ¨èæ ¼å¼ï¼š
            æˆåŠŸï¼š{ code: 0, data: {...}, message: "success" }
            å¤±è´¥ï¼š{ code: 40001, data: null, message: "é”™è¯¯æè¿°" }
            åˆ†é¡µï¼š{ code: 0, data: { list: [], total, page, pageSize } }
          tags: ["api", "design"]

        - skill_id: "preset_bp_002"
          name: "ç¯å¢ƒå˜é‡ç®¡ç†"
          trigger: "ç®¡ç†ç¯å¢ƒå˜é‡|é…ç½®ç®¡ç†"
          solution: |
            æ¨èåšæ³•ï¼š
            1. .env.example æäº¤åˆ°ä»“åº“ï¼ˆæ¨¡æ¿ï¼‰
            2. .env.local æœ¬åœ°ä½¿ç”¨ï¼ˆä¸æäº¤ï¼‰
            3. æ•æ„Ÿä¿¡æ¯ç»ä¸ç¡¬ç¼–ç 
            4. ä½¿ç”¨ ConfigModule ç»Ÿä¸€ç®¡ç†
          tags: ["config", "security"]

    workarounds:
      name: "å˜é€šæ–¹æ¡ˆ"
      description: "æ¡†æ¶/åº“é™åˆ¶çš„å˜é€šæ–¹æ¡ˆ"
      count: 10
      examples:
        - skill_id: "preset_wa_001"
          name: "Next.js App Router ä¸æ”¯æŒçš„åŠŸèƒ½"
          trigger: "Next.js App Router ä¸æ”¯æŒ|App Router limitation"
          solution: |
            å¸¸è§å˜é€šï¼š
            1. éœ€è¦ getServerSideProps â†’ ä½¿ç”¨ Server Components + fetch
            2. éœ€è¦ä¸­é—´ä»¶ä¿®æ”¹å“åº” â†’ ä½¿ç”¨ Route Handlers
            3. éœ€è¦å…¨å±€çŠ¶æ€ â†’ ä½¿ç”¨ Context + Server Actions
          tags: ["nextjs", "workaround"]

  # åŠ è½½æœºåˆ¶
  loading:
    timing: "é¡¹ç›®åˆå§‹åŒ–æ—¶"
    source: "dialogue-archivist/presets/"
    merge_strategy:
      conflict: "é¡¹ç›®ç‰¹å®šæŠ€èƒ½ä¼˜å…ˆ"
      duplicate: "ä¿ç•™é¡¹ç›®ç‰¹å®šç‰ˆæœ¬"

  # é¢„ç½®æŠ€èƒ½çŠ¶æ€
  preset_skill_state:
    initial: "stable"  # é¢„ç½®æŠ€èƒ½ç›´æ¥æ˜¯ stable çŠ¶æ€
    can_modify: false  # ç”¨æˆ·ä¸èƒ½ä¿®æ”¹é¢„ç½®æŠ€èƒ½
    can_disable: true  # ç”¨æˆ·å¯ä»¥ç¦ç”¨æŸä¸ªé¢„ç½®æŠ€èƒ½
    can_override: true # ç”¨æˆ·å¯ä»¥åˆ›å»ºåŒåæŠ€èƒ½è¦†ç›–

  # æ›´æ–°æœºåˆ¶
  update:
    source: "éšæ°¸ä¹å¤§å…¸ç‰ˆæœ¬æ›´æ–°"
    strategy: "åªå¢ä¸åˆ "
    user_notification: true
    changelog: true

  # å­˜æ¡£ç»“æ„
  storage:
    path: ".orchestra/learned/presets/"
    files:
      - "error_resolution.json"
      - "debugging_techniques.json"
      - "best_practices.json"
      - "workarounds.json"
    index: "presets-index.json"

  # æ¥å£æ‰©å±•
  new_interfaces:

    load_preset_skills:
      description: "åŠ è½½é¢„ç½®æŠ€èƒ½åŒ…"
      input:
        categories: array | null  # ä¸ºç©ºåˆ™åŠ è½½å…¨éƒ¨
      output:
        loaded_count: number
        skills_by_category: object
        status: "presets_loaded"

    disable_preset_skill:
      description: "ç¦ç”¨æŸä¸ªé¢„ç½®æŠ€èƒ½"
      input:
        skill_id: string
        reason: string | null
      output:
        disabled: boolean
        status: "preset_disabled"

    get_preset_skills:
      description: "è·å–é¢„ç½®æŠ€èƒ½åˆ—è¡¨"
      input:
        category: string | null
        enabled_only: boolean
      output:
        total: number
        skills: array
```

### ğŸ”— ä¸ Hooks ç³»ç»Ÿå¯¹æ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  æŒç»­å­¦ä¹ ä¸ Hooks ç³»ç»Ÿåä½œ                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                 â”‚
â”‚                                                                             â”‚
â”‚   Hooks ç³»ç»Ÿ                           å²å®˜ Layer 5                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â”‚   â”‚  SessionEnd     â”‚ â”€â”€è§¦å‘â”€â”€â”€â”€â”€â”€â†’   â”‚  æŒç»­å­¦ä¹ æµç¨‹   â”‚                  â”‚
â”‚   â”‚  Hook           â”‚                 â”‚                 â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚  1. evaluate    â”‚                  â”‚
â”‚   â”‚  SessionStart   â”‚ â†â”€â”€åŠ è½½æŠ€èƒ½â”€â”€   â”‚  2. extract     â”‚                  â”‚
â”‚   â”‚  Hook           â”‚                 â”‚  3. validate    â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚  4. save        â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚  5. report      â”‚                  â”‚
â”‚   â”‚                 â”‚                 â”‚                 â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Hook é…ç½®ç¤ºä¾‹

```yaml
hooks_integration:

  # SessionEnd è§¦å‘æŒç»­å­¦ä¹ 
  session_end_hook:
    event: "SessionEnd"
    matcher: "*"
    actions:
      - interface: "evaluate_session"
        params:
          session_id: "{current_session_id}"
        on_success:
          - interface: "extract_patterns"
          - interface: "validate_skill"
          - interface: "save_learned_skill"
          - interface: "generate_learning_report"

  # SessionStart åŠ è½½å·²å­¦ä¹ æŠ€èƒ½
  session_start_hook:
    event: "SessionStart"
    matcher: "*"
    actions:
      - interface: "get_learned_skills"
        params:
          state: "stable"
          auto_apply: true
        result: "åŠ è½½å¯è‡ªåŠ¨åº”ç”¨çš„æŠ€èƒ½åˆ°å½“å‰ä¼šè¯"

  # æ£€æµ‹è§¦å‘æ¡ä»¶å¹¶åº”ç”¨æŠ€èƒ½
  pattern_detection:
    event: "PreToolUse"
    matcher: "tool == 'Edit' || tool == 'Write'"
    actions:
      - check: "å½“å‰ä¸Šä¸‹æ–‡æ˜¯å¦åŒ¹é…å·²å­¦ä¹ æŠ€èƒ½çš„è§¦å‘æ¡ä»¶"
        on_match:
          - interface: "apply_learned_pattern"
          - notify: "å»ºè®®åº”ç”¨å­¦ä¹ æŠ€èƒ½: {skill_name}"
```

#### é€šçŸ¥æ—¶æœº

```yaml
notification_timing:

  session_end:
    level: "urgent"
    action: "ç«‹å³æ˜¾ç¤ºå­¦ä¹ æŠ¥å‘Š"
    example: "å‘ç° Agent é‡å¤é”™è¯¯ï¼Œå»ºè®®ä¼˜åŒ–"

  session_start:
    level: "attention"
    action: "æ˜¾ç¤ºä¸Šæ¬¡å­¦ä¹ æ‘˜è¦"
    example: "ä¸Šæ¬¡ä¼šè¯å­¦åˆ° 2 ä¸ªæ–°æŠ€èƒ½ï¼Œå¾…æ‰¹å‡†"

  during_session:
    level: "info"
    action: "æ£€æµ‹åˆ°åŒ¹é…çš„å­¦ä¹ æŠ€èƒ½æ—¶æç¤º"
    example: "æ£€æµ‹åˆ°ç±»ä¼¼é—®é¢˜ï¼Œæ˜¯å¦åº”ç”¨ä¹‹å‰å­¦åˆ°çš„è§£å†³æ–¹æ¡ˆï¼Ÿ"
```

---

## ğŸ” æ•°æ®å®Œæ•´æ€§ä¿éšœï¼ˆç»­ï¼‰

```yaml
integrity:

  # ========== æŒç»­å­¦ä¹ é“å¾‹ï¼ˆDA-07 ~ DA-12ï¼‰==========

  DA-07:
    name: "æ¨¡å¼æå–å¿…é¡»æœ‰æ¥æº"
    rule: "æ¯ä¸ªæå–çš„æ¨¡å¼å¿…é¡»å…³è”åˆ°å…·ä½“çš„å¯¹è¯è®°å½•"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "extract_patterns è¿”å›æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ extracted_patterns æ¯é¡¹æ˜¯å¦æœ‰ source_messages"
        2: "éªŒè¯ source_messages ä¸­çš„å¯¹è¯ ID å­˜åœ¨"
        3: "æ— æ¥æº = æ¨¡å¼æ— æ•ˆ"
      è¯æ®: "source_messages æ•°ç»„ + å¯¹è¯è®°å½•å­˜åœ¨"
    consequence: "æ— æ¥æºçš„æ¨¡å¼ä¸èƒ½ä¿å­˜"

  DA-08:
    name: "å­¦ä¹ æŠ€èƒ½å¿…é¡»å¯è¿½æº¯"
    rule: "æ¯ä¸ªå­¦ä¹ æŠ€èƒ½å¿…é¡»èƒ½è¿½æº¯åˆ°åŸå§‹æ¨¡å¼å’Œä¼šè¯"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "get_learned_skills + åå‘æŸ¥è¯¢"
      æ­¥éª¤:
        1: "è·å–æŠ€èƒ½çš„ pattern_id"
        2: "é€šè¿‡ pattern_id æ‰¾åˆ°åŸå§‹ä¼šè¯"
        3: "æ— æ³•è¿½æº¯ = æŠ€èƒ½æ— æ•ˆ"
      è¯æ®: "å®Œæ•´çš„è¿½æº¯é“¾"
    consequence: "æ— æ³•è¿½æº¯çš„æŠ€èƒ½ä¸èƒ½åº”ç”¨"

  DA-09:
    name: "ç”¨æˆ·åé¦ˆä¼˜å…ˆäºè‡ªåŠ¨å­¦ä¹ "
    rule: "ç”¨æˆ·æ˜ç¡®æ‹’ç»çš„æ¨¡å¼ä¸èƒ½è‡ªåŠ¨åº”ç”¨"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "feedback_on_pattern å†å²æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥æŠ€èƒ½çš„ user_action å†å²"
        2: "å¦‚æœ rejected >= 2 æ¬¡ï¼Œauto_apply å¿…é¡»ä¸º false"
        3: "å¼ºåˆ¶è‡ªåŠ¨åº”ç”¨è¢«æ‹’æ¨¡å¼ = è¿è§„"
      è¯æ®: "åé¦ˆå†å²è®°å½•"
    consequence: "è¢«å¤šæ¬¡æ‹’ç»çš„æ¨¡å¼é™çº§ä¸ºä»…å»ºè®®"

  DA-10:
    name: "æŠ€èƒ½å¿…é¡»ç»è¿‡éªŒè¯"
    rule: "ä»»ä½•æŠ€èƒ½å¿…é¡»é€šè¿‡è‡ªåŠ¨éªŒè¯æ‰èƒ½è¿›å…¥äººå·¥å®¡æ‰¹"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "skill çŠ¶æ€æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥æŠ€èƒ½çŠ¶æ€æ˜¯å¦ç»è¿‡ validating é˜¶æ®µ"
        2: "æ£€æŸ¥æ˜¯å¦æœ‰ validation_result"
        3: "è·³è¿‡éªŒè¯ç›´æ¥ approved = è¿è§„"
      è¯æ®: "validation_result è®°å½•"
    consequence: "æœªéªŒè¯çš„æŠ€èƒ½æ— æ•ˆ"

  DA-11:
    name: "è‡ªåŠ¨åº”ç”¨å¿…é¡»çš‡ä¸Šæ‰¹å‡†"
    rule: "auto_apply=true çš„æŠ€èƒ½å¿…é¡»ç»çš‡ä¸Šæ˜ç¡®æ‰¹å‡†"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "skill approved_by æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ auto_apply=true çš„æŠ€èƒ½"
        2: "æ£€æŸ¥ approved_by æ˜¯å¦ä¸º user"
        3: "éç”¨æˆ·æ‰¹å‡†çš„è‡ªåŠ¨åº”ç”¨ = è¿è§„"
      è¯æ®: "approved_by å­—æ®µ"
    consequence: "å¼ºåˆ¶æ”¹ä¸ºæ‰‹åŠ¨è§¦å‘"

  DA-12:
    name: "ä¼˜åŒ–å»ºè®®å¿…é¡»é€šçŸ¥"
    rule: "å‘ç° Agent å¯ä¼˜åŒ–ç‚¹å¿…é¡»é€šçŸ¥çš‡ä¸Š"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "learning_report æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ agent_optimization_suggestions æ˜¯å¦ä¸ºç©º"
        2: "éç©ºæ—¶æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†é€šçŸ¥"
        3: "æœ‰å»ºè®®ä½†æ— é€šçŸ¥ = è¿è§„"
      è¯æ®: "notification è®°å½•"
    consequence: "é‡æ–°ç”Ÿæˆå¹¶å‘é€é€šçŸ¥"
```

---

## ğŸ“‹ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v1.9 | 2026-01-25 | æ–°å¢é¢„ç½®æŠ€èƒ½åŒ…ï¼ˆå†·å¯åŠ¨æ–¹æ¡ˆï¼‰ï¼šé€šç”¨é”™è¯¯è§£å†³ã€è°ƒè¯•æŠ€å·§ã€æœ€ä½³å®è·µã€å˜é€šæ–¹æ¡ˆï¼Œå…± 55+ ä¸ªé¢„ç½®æŠ€èƒ½ |
| v1.8 | 2026-01-24 | æ–°å¢ï¼šLayer 5 æŒç»­å­¦ä¹ æ¥å£ï¼ˆ8ä¸ªï¼‰ã€é“å¾‹ DA-07~DA-12ï¼ˆ6æ¡ï¼‰ã€æŠ€èƒ½ç”Ÿå‘½å‘¨æœŸã€éªŒè¯æœºåˆ¶ã€é€šçŸ¥æœºåˆ¶ |
| v1.7 | 2026-01-23 | é˜²è™šæŠ¥å®¡æŸ¥ä¿®å¤ï¼š6æ¡è§„åˆ™æ”¹ä¸ºé“å¾‹æ ¼å¼ï¼ˆDA-01~DA-06ï¼‰ã€æ·»åŠ æ£€æµ‹æ–¹æ³•ã€è¿è§„åæœã€è°ƒç”¨è¯æ®è¦æ±‚ |
| v1.6 | 2026-01-23 | æ–°å¢ï¼šæ¥å£ 33-35 å¥‘çº¦å›æ»šè®°å½•ã€å®¡è®¡æ—¥å¿—æ¥å£ |
| v1.5 | 2026-01-23 | æ–°å¢ï¼šæ¥å£ 30-32 å¥‘çº¦å˜æ›´è¯·æ±‚å­˜æ¡£æ¥å£ |
| v1.4 | 2026-01-23 | æ–°å¢ï¼šLayer 4 å¥‘çº¦å¿«ç…§æ¥å£ï¼ˆ5ä¸ªï¼‰ã€ä¸å¥‘çº¦å®ˆå«å¯¹æ¥ |
| v1.3 | 2026-01-22 | æ–°å¢ï¼šLayer 3 è¿ç§»ä¸“ç”¨æ¥å£ï¼ˆ7ä¸ªï¼‰ã€æ”¯æŒé‡å¡‘é¡¹ç›®è®°å½• |
| v1.2 | 2026-01-22 | æ–°å¢ project_scan äº‹ä»¶ç±»å‹ã€ä¸é’¦å¤©ç›‘å¯¹æ¥ã€scans/ ç›®å½• |
| v1.1 | 2026-01-22 | å¢åŠ å¿«é€Ÿæ¨¡å¼æ”¯æŒã€åä½œç”Ÿæˆè®°å½• |
| v1.0 | 2026-01-22 | åˆå§‹ç‰ˆæœ¬ï¼š17ä¸ªæ¥å£ã€ä¸¤å±‚æ¶æ„ |

---

**ğŸ“ å¯¹è¯æ¡£æ¡ˆå®˜ï¼ˆå²å®˜ï¼‰Â· å®Œ**