---
name: hooks-system
description: |
  é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰- æ°¸ä¹å¤§å…¸äº‹ä»¶è§¦å‘ä¸è‡ªåŠ¨åŒ–æœºåˆ¶ã€‚
  è´Ÿè´£ç›‘å¬ Claude Code ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè§¦å‘ç›¸åº”çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚
  æ ¸å¿ƒèŒè´£ï¼šä¼šè¯ç®¡ç†ã€å·¥å…·æ‹¦æˆªã€è´¨é‡æ£€æŸ¥ã€æŒç»­å­¦ä¹ è§¦å‘ã€‚
  Use when (1) é…ç½®è‡ªåŠ¨åŒ–æµç¨‹, (2) è®¾ç½®å·¥å…·æ‹¦æˆªè§„åˆ™, (3) ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ, (4) è§¦å‘æŒç»­å­¦ä¹ ã€‚
---

# ğŸ”” é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰

> æ°¸ä¹å¤§å…¸ Â· äº‹ä»¶è§¦å‘ä¸è‡ªåŠ¨åŒ–æœºåˆ¶
> ç‰ˆæœ¬ï¼šv1.0

---

## ğŸ¯ æ ¸å¿ƒå®šä½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” é’©å­ç³»ç»Ÿ = å†…ä¾çœ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ã€è§’è‰²ã€‘å†…ä¾çœ Â· ä¼ æ—¨å¤ªç›‘ Â· äº‹ä»¶ä¸­æ¢                                       â”‚
â”‚                                                                             â”‚
â”‚  ã€Œå‡¡äº‹å¿…æœ‰è§¦å‘ï¼Œå‡¡è§¦å‘å¿…æœ‰å“åº”ã€                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                    Claude Code äº‹ä»¶æµ                               â”‚   â”‚
â”‚  â”‚                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   SessionStart â”€â”€â†’ PreToolUse â”€â”€â†’ PostToolUse â”€â”€â†’ Stop â”€â”€â†’ SessionEnd â”‚
â”‚  â”‚        â”‚               â”‚               â”‚            â”‚           â”‚     â”‚
â”‚  â”‚        â–¼               â–¼               â–¼            â–¼           â–¼     â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   â”‚åŠ è½½ä¸Šä¸‹æ–‡â”‚    â”‚å‚æ•°æ ¡éªŒ â”‚    â”‚æ ¼å¼åŒ–   â”‚  â”‚è´¨é‡æ£€æŸ¥â”‚ â”‚æŒç»­å­¦ä¹ â”‚ â”‚
â”‚  â”‚   â”‚åŠ è½½æŠ€èƒ½ â”‚    â”‚æƒé™æ‹¦æˆª â”‚    â”‚ç±»å‹æ£€æŸ¥ â”‚  â”‚å®¡è®¡    â”‚ â”‚çŠ¶æ€ä¿å­˜â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                         PreCompact                                  â”‚   â”‚
â”‚  â”‚                             â”‚                                       â”‚   â”‚
â”‚  â”‚                             â–¼                                       â”‚   â”‚
â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚                      â”‚ å‹ç¼©å‰ä¿å­˜  â”‚                                â”‚   â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ã€æ ¸å¿ƒåŸåˆ™ã€‘                                                               â”‚
â”‚  ã€Œäº‹ä»¶å¿…æ•è·ï¼Œå“åº”å¿…æ‰§è¡Œï¼Œå¤±è´¥å¿…é€šçŸ¥ï¼Œæ—¥å¿—å¿…è®°å½•ã€                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Hook ç±»å‹å®šä¹‰

### å…­ç§ Hook ç±»å‹

| # | ç±»å‹ | è§¦å‘æ—¶æœº | å…¸å‹ç”¨é€” |
|---|------|----------|----------|
| 1 | SessionStart | ä¼šè¯å¼€å§‹æ—¶ | åŠ è½½ä¸Šä¸‹æ–‡ã€åŠ è½½å·²å­¦ä¹ æŠ€èƒ½ |
| 2 | PreToolUse | å·¥å…·æ‰§è¡Œå‰ | å‚æ•°æ ¡éªŒã€æƒé™æ‹¦æˆªã€æé†’ |
| 3 | PostToolUse | å·¥å…·æ‰§è¡Œå | æ ¼å¼åŒ–ã€ç±»å‹æ£€æŸ¥ã€è­¦å‘Š |
| 4 | PreCompact | ä¸Šä¸‹æ–‡å‹ç¼©å‰ | ä¿å­˜é‡è¦çŠ¶æ€ |
| 5 | Stop | æ¯æ¬¡å“åº”ç»“æŸ | è´¨é‡æ£€æŸ¥ã€å®¡è®¡ |
| 6 | SessionEnd | ä¼šè¯ç»“æŸæ—¶ | æŒç»­å­¦ä¹ ã€çŠ¶æ€ä¿å­˜ |

---

### ç±»å‹ 1: SessionStart

**è§¦å‘æ—¶æœº**ï¼šæ–°ä¼šè¯å¼€å§‹æ—¶

```yaml
hook_type: SessionStart

purpose: |
  ä¼šè¯åˆå§‹åŒ–ï¼ŒåŠ è½½å¿…è¦çš„ä¸Šä¸‹æ–‡å’Œé…ç½®

typical_actions:
  - åŠ è½½ä¸Šæ¬¡ä¼šè¯çš„ä¸Šä¸‹æ–‡æ‘˜è¦
  - åŠ è½½å·²å­¦ä¹ çš„æŠ€èƒ½ï¼ˆstable çŠ¶æ€ï¼‰
  - æ£€æµ‹é¡¹ç›®ç¯å¢ƒï¼ˆåŒ…ç®¡ç†å™¨ç­‰ï¼‰
  - æ˜¾ç¤ºå¾…å¤„ç†çš„å­¦ä¹ æŠ¥å‘Š

matcher: "*"  # æ‰€æœ‰ä¼šè¯

integration:
  å²å®˜_Layer5:
    action: "get_learned_skills(state='stable', auto_apply=true)"
    result: "åŠ è½½å¯è‡ªåŠ¨åº”ç”¨çš„æŠ€èƒ½"
```

---

### ç±»å‹ 2: PreToolUse

**è§¦å‘æ—¶æœº**ï¼šå·¥å…·æ‰§è¡Œå‰

```yaml
hook_type: PreToolUse

purpose: |
  åœ¨å·¥å…·æ‰§è¡Œå‰è¿›è¡Œæ ¡éªŒã€æ‹¦æˆªæˆ–æé†’

capabilities:
  - å‚æ•°æ ¡éªŒå’Œä¿®æ”¹
  - é˜»æ­¢å±é™©æ“ä½œ
  - æ·»åŠ æé†’ä¿¡æ¯
  - è§¦å‘å®¡æ‰¹æµç¨‹

matcher_examples:
  # åŒ¹é…ç‰¹å®šå·¥å…·
  - 'tool == "Bash"'
  - 'tool == "Edit"'
  - 'tool == "Write"'

  # åŒ¹é…å·¥å…· + å‚æ•°
  - 'tool == "Bash" && tool_input.command matches "git push"'
  - 'tool == "Write" && tool_input.file_path matches "\\.md$"'

actions:
  block:
    description: "é˜»æ­¢æ‰§è¡Œ"
    method: "process.exit(1)"

  warn:
    description: "è­¦å‘Šä½†ç»§ç»­"
    method: "console.error('[Hook] WARNING: ...')"

  modify:
    description: "ä¿®æ”¹å‚æ•°"
    method: "ä¿®æ”¹ tool_input å¹¶è¿”å›"
```

---

### ç±»å‹ 3: PostToolUse

**è§¦å‘æ—¶æœº**ï¼šå·¥å…·æ‰§è¡Œå

```yaml
hook_type: PostToolUse

purpose: |
  åœ¨å·¥å…·æ‰§è¡Œåè¿›è¡Œæ£€æŸ¥ã€æ ¼å¼åŒ–æˆ–åå¤„ç†

capabilities:
  - ä»£ç æ ¼å¼åŒ–ï¼ˆPrettierï¼‰
  - ç±»å‹æ£€æŸ¥ï¼ˆTypeScriptï¼‰
  - è´¨é‡è­¦å‘Šï¼ˆconsole.logï¼‰
  - æ‰§è¡Œç»“æœåˆ†æ

typical_actions:
  edit_ts_file:
    trigger: 'tool == "Edit" && tool_input.file_path matches "\\.tsx?$"'
    actions:
      - "è¿è¡Œ Prettier æ ¼å¼åŒ–"
      - "è¿è¡Œ tsc --noEmit ç±»å‹æ£€æŸ¥"
      - "æ£€æŸ¥ console.log"

  bash_command:
    trigger: 'tool == "Bash"'
    actions:
      - "åˆ†æå‘½ä»¤è¾“å‡º"
      - "æå–æœ‰ç”¨ä¿¡æ¯ï¼ˆå¦‚ PR URLï¼‰"
```

---

### ç±»å‹ 4: PreCompact

**è§¦å‘æ—¶æœº**ï¼šä¸Šä¸‹æ–‡å‹ç¼©å‰

```yaml
hook_type: PreCompact

purpose: |
  åœ¨ Claude è¿›è¡Œä¸Šä¸‹æ–‡å‹ç¼©å‰ä¿å­˜é‡è¦çŠ¶æ€

critical: true  # å…³é”® Hookï¼Œå¿…é¡»æ‰§è¡Œ

actions:
  - ä¿å­˜å½“å‰ä¼šè¯çŠ¶æ€åˆ° .orchestra/
  - ä¿å­˜æœªå®Œæˆçš„ä»»åŠ¡åˆ—è¡¨
  - ä¿å­˜é‡è¦çš„å†³ç­–ä¸Šä¸‹æ–‡
  - è®°å½•å‹ç¼©æ—¶é—´ç‚¹

integration:
  å²å®˜:
    action: "create_snapshot(trigger='pre_compact')"
    result: "åˆ›å»ºå‹ç¼©å‰å¿«ç…§"
```

---

### ç±»å‹ 5: Stop

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡ Agent å“åº”ç»“æŸ

```yaml
hook_type: Stop

purpose: |
  æ¯æ¬¡å“åº”ç»“æŸæ—¶è¿›è¡Œæ£€æŸ¥å’Œå®¡è®¡

typical_actions:
  - æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶æ˜¯å¦æœ‰ console.log
  - æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ•æ„Ÿä¿¡æ¯
  - æ›´æ–°ä»»åŠ¡è¿›åº¦
  - è§¦å‘å¢é‡éªŒè¯

frequency: "æ¯æ¬¡å“åº”"  # é«˜é¢‘ Hookï¼Œä¿æŒè½»é‡
```

---

### ç±»å‹ 6: SessionEnd

**è§¦å‘æ—¶æœº**ï¼šä¼šè¯ç»“æŸæ—¶

```yaml
hook_type: SessionEnd

purpose: |
  ä¼šè¯ç»“æŸæ—¶è¿›è¡Œæ”¶å°¾å·¥ä½œ

critical: true  # å…³é”® Hookï¼Œå¿…é¡»æ‰§è¡Œ

actions:
  - æŒä¹…åŒ–ä¼šè¯çŠ¶æ€
  - è§¦å‘æŒç»­å­¦ä¹ æµç¨‹
  - ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
  - æ¸…ç†ä¸´æ—¶æ–‡ä»¶

integration:
  å²å®˜_Layer5:
    sequence:
      1: "evaluate_session()"
      2: "extract_patterns()"
      3: "validate_skill()"
      4: "save_learned_skill()"
      5: "generate_learning_report()"
```

---

## ğŸ”§ æ°¸ä¹å¤§å…¸é¢„ç½® Hooks

### é…ç½®æ–‡ä»¶ä½ç½®

```
~/.claude/settings.json          # ç”¨æˆ·çº§é…ç½®
.claude/settings.json            # é¡¹ç›®çº§é…ç½®
.orchestra/hooks/                # æ°¸ä¹å¤§å…¸ä¸“ç”¨ hooks
```

### é¢„ç½® Hook æ¸…å•

```yaml
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  æ°¸ä¹å¤§å…¸é¢„ç½® Hooks
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

preset_hooks:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # SessionStart Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  session_start_load_context:
    type: SessionStart
    matcher: "*"
    description: "åŠ è½½ä¸Šæ¬¡ä¼šè¯ä¸Šä¸‹æ–‡å’Œå·²å­¦ä¹ æŠ€èƒ½"
    actions:
      - "è¯»å– .orchestra/session-state.json"
      - "è°ƒç”¨å²å®˜ get_learned_skills()"
      - "æ˜¾ç¤ºå¾…å®¡æ‰¹çš„å­¦ä¹ æŠ¥å‘Š"
    priority: 1

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PreToolUse Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  pre_tool_block_random_md:
    type: PreToolUse
    matcher: |
      tool == "Write" &&
      tool_input.file_path matches "\\.md$" &&
      !(tool_input.file_path matches "README|CLAUDE|AGENT|SKILL")
    description: "é˜»æ­¢åˆ›å»ºéšæ„çš„ md æ–‡ä»¶"
    action: "block"
    message: "è¯·ä½¿ç”¨ README.md æˆ–æŒ‡å®šçš„æ–‡æ¡£æ–‡ä»¶"
    priority: 1

  pre_tool_git_push_review:
    type: PreToolUse
    matcher: 'tool == "Bash" && tool_input.command matches "git push"'
    description: "git push å‰æé†’æ£€æŸ¥"
    action: "warn"
    message: "å³å°†æ¨é€ï¼Œè¯·ç¡®è®¤å·²å®Œæˆä»£ç å®¡æŸ¥"
    priority: 2

  pre_tool_dangerous_command:
    type: PreToolUse
    matcher: |
      tool == "Bash" &&
      tool_input.command matches "(rm -rf|drop table|truncate|--force)"
    description: "å±é™©å‘½ä»¤è­¦å‘Š"
    action: "warn"
    message: "æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼Œè¯·ç¡®è®¤"
    priority: 1

  pre_tool_apply_learned_pattern:
    type: PreToolUse
    matcher: 'tool == "Edit" || tool == "Write"'
    description: "æ£€æµ‹æ˜¯å¦å¯åº”ç”¨å·²å­¦ä¹ çš„æ¨¡å¼"
    action: "check_and_suggest"
    integration: "å²å®˜ apply_learned_pattern()"
    priority: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PostToolUse Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  post_tool_prettier:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx|js|jsx)$"'
    description: "è‡ªåŠ¨æ ¼å¼åŒ– JS/TS æ–‡ä»¶"
    action: "npx prettier --write {file_path}"
    priority: 1

  post_tool_typescript_check:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'
    description: "TypeScript ç±»å‹æ£€æŸ¥"
    action: "npx tsc --noEmit"
    report: "åªæ˜¾ç¤ºä¸å½“å‰æ–‡ä»¶ç›¸å…³çš„é”™è¯¯"
    priority: 2

  post_tool_console_log_warning:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx|js|jsx)$"'
    description: "æ£€æµ‹ console.log"
    action: "grep console.log"
    level: "warning"
    message: "å‘ç° console.logï¼Œè¯·åœ¨æäº¤å‰ç§»é™¤"
    priority: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PreCompact Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  pre_compact_save_state:
    type: PreCompact
    matcher: "*"
    description: "å‹ç¼©å‰ä¿å­˜ä¼šè¯çŠ¶æ€"
    actions:
      - "è°ƒç”¨å²å®˜ create_snapshot(trigger='pre_compact')"
      - "ä¿å­˜å½“å‰ä»»åŠ¡åˆ—è¡¨"
      - "ä¿å­˜é‡è¦å†³ç­–ä¸Šä¸‹æ–‡"
    priority: 1
    critical: true

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Stop Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  stop_console_log_audit:
    type: Stop
    matcher: "*"
    description: "æ£€æŸ¥æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶çš„ console.log"
    action: "git diff --name-only | xargs grep console.log"
    level: "warning"
    priority: 1

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # SessionEnd Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  session_end_persist_state:
    type: SessionEnd
    matcher: "*"
    description: "æŒä¹…åŒ–ä¼šè¯çŠ¶æ€"
    action: "ä¿å­˜åˆ° .orchestra/session-state.json"
    priority: 1
    critical: true

  session_end_continuous_learning:
    type: SessionEnd
    matcher: "*"
    description: "è§¦å‘æŒç»­å­¦ä¹ æµç¨‹"
    integration: "å²å®˜ Layer 5"
    sequence:
      1: "evaluate_session()"
      2: "if worth_extracting: extract_patterns()"
      3: "validate_skill()"
      4: "save_learned_skill()"
      5: "generate_learning_report()"
    priority: 2
    critical: true
```

---

## ğŸ“ é…ç½®æ ¼å¼

### hooks.json ç»“æ„

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "node scripts/session-start.js"
          }
        ],
        "description": "ä¼šè¯å¼€å§‹æ—¶åŠ è½½ä¸Šä¸‹æ–‡"
      }
    ],
    "PreToolUse": [
      {
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\.md$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node scripts/check-md-file.js"
          }
        ],
        "description": "æ£€æŸ¥ md æ–‡ä»¶åˆ›å»º"
      }
    ],
    "PostToolUse": [...],
    "PreCompact": [...],
    "Stop": [...],
    "SessionEnd": [...]
  }
}
```

### Matcher è¯­æ³•

```yaml
matcher_syntax:

  # åŒ¹é…æ‰€æœ‰
  all: "*"

  # åŒ¹é…ç‰¹å®šå·¥å…·
  tool_only: 'tool == "Bash"'

  # åŒ¹é…å·¥å…· + å‚æ•°ï¼ˆå­—ç¬¦ä¸²åŒ…å«ï¼‰
  tool_with_param: 'tool == "Bash" && tool_input.command matches "git"'

  # åŒ¹é…å·¥å…· + å‚æ•°ï¼ˆæ­£åˆ™ï¼‰
  tool_with_regex: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'

  # å¤åˆæ¡ä»¶
  compound: |
    tool == "Write" &&
    tool_input.file_path matches "\\.md$" &&
    !(tool_input.file_path matches "README")

  # æ’é™¤æ¡ä»¶
  exclude: '!(tool == "Read")'
```

### Hook æ‰§è¡Œè„šæœ¬

```yaml
hook_scripts:

  # å†…è”è„šæœ¬ï¼ˆç®€å•é€»è¾‘ï¼‰
  inline:
    type: "command"
    command: 'node -e "console.error(\"[Hook] Message\"); process.exit(0)"'

  # å¤–éƒ¨è„šæœ¬ï¼ˆå¤æ‚é€»è¾‘ï¼‰
  external:
    type: "command"
    command: "node ${CLAUDE_PLUGIN_ROOT}/scripts/hooks/my-hook.js"

  # è„šæœ¬æ¥æ”¶çš„è¾“å…¥ï¼ˆstdinï¼‰
  input_format:
    tool: "å·¥å…·åç§°"
    tool_input: "å·¥å…·è¾“å…¥å‚æ•°"
    tool_output: "å·¥å…·è¾“å‡ºï¼ˆä»… PostToolUseï¼‰"

  # è„šæœ¬è¿”å›
  return:
    stdout: "ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†"
    stderr: "æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯"
    exit_code:
      0: "ç»§ç»­æ‰§è¡Œ"
      1: "é˜»æ­¢æ‰§è¡Œï¼ˆä»… PreToolUseï¼‰"
```

---

## ğŸ”— ä¸å…¶ä»–ç»„ä»¶å¯¹æ¥

### ä¸å²å®˜å¯¹æ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Hook ç³»ç»Ÿ â†â†’ å²å®˜                                                          â”‚
â”‚                                                                             â”‚
â”‚   SessionStart                              å²å®˜ Layer 5                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ åŠ è½½æŠ€èƒ½    â”‚ â”€â”€get_learned_skills()â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  æŒç»­å­¦ä¹    â”‚                 â”‚
â”‚                                            â”‚             â”‚                 â”‚
â”‚   SessionEnd                               â”‚             â”‚                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚             â”‚                 â”‚
â”‚   â”‚ è§¦å‘å­¦ä¹     â”‚ â”€â”€evaluate_session()â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€extract_patterns()â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€validate_skill()â”€â”€â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€save_learned_skill()â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€generate_report()â”€â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â”‚   PreCompact                               å²å®˜ Layer 1                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ ä¿å­˜çŠ¶æ€    â”‚ â”€â”€create_snapshot()â”€â”€â”€â”€â”€â†’â”‚  é¡¹ç›®æ¡£æ¡ˆé¦† â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â”‚   PreToolUse                               å²å®˜ Layer 5                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ åº”ç”¨æ¨¡å¼    â”‚ â”€â”€apply_learned_pattern()â†’â”‚  æŠ€èƒ½åº”ç”¨   â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸æ ¡å‹˜é¦†å¯¹æ¥ï¼ˆå¾…å®ç°ï¼‰

```yaml
test_agent_integration:

  post_tool_use:
    trigger: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'
    action: "è§¦å‘å¢é‡æµ‹è¯•"

  stop:
    trigger: "*"
    action: "è¿è¡Œ verification loopï¼ˆå¦‚å·²é…ç½®ï¼‰"
```

### ä¸ç›‘ä¿®é¦†å¯¹æ¥ï¼ˆå¾…å®ç°ï¼‰

```yaml
review_agent_integration:

  post_tool_use:
    trigger: 'tool == "Edit"'
    action: "è§¦å‘å®‰å…¨æ£€æŸ¥"

  pre_tool_use:
    trigger: 'tool == "Bash" && tool_input.command matches "git commit"'
    action: "è§¦å‘ä»£ç å®¡æŸ¥æé†’"
```

---

## ğŸ” é“å¾‹

```yaml
integrity:

  # ========== Hook ç³»ç»Ÿé“å¾‹ï¼ˆHK-01 ~ HK-04ï¼‰==========

  HK-01:
    name: "å…³é”® Hook å¿…é¡»æ‰§è¡Œ"
    rule: "PreCompactã€SessionEnd æ ‡è®°ä¸º critical çš„ Hook å¿…é¡»æˆåŠŸæ‰§è¡Œ"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "Hook æ‰§è¡Œæ—¥å¿—æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ critical Hook æ˜¯å¦æœ‰æ‰§è¡Œè®°å½•"
        2: "æ£€æŸ¥æ‰§è¡Œç»“æœæ˜¯å¦æˆåŠŸ"
        3: "æ— è®°å½•æˆ–å¤±è´¥ = è¿è§„"
      è¯æ®: "Hook æ‰§è¡Œæ—¥å¿—"
    consequence: "å…³é”®çŠ¶æ€å¯èƒ½ä¸¢å¤±ï¼Œéœ€è¦äººå·¥æ¢å¤"

  HK-02:
    name: "Hook å¤±è´¥å¿…é¡»é€šçŸ¥"
    rule: "Hook æ‰§è¡Œå¤±è´¥æ—¶å¿…é¡»é€šçŸ¥ç”¨æˆ·"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "stderr è¾“å‡ºæ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ Hook æ˜¯å¦æœ‰ stderr è¾“å‡º"
        2: "exit_code != 0 æ—¶å¿…é¡»æœ‰é”™è¯¯æ¶ˆæ¯"
        3: "é™é»˜å¤±è´¥ = è¿è§„"
      è¯æ®: "stderr è¾“å‡ºå†…å®¹"
    consequence: "ç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œé‡æ–°æ‰§è¡Œå¹¶é€šçŸ¥"

  HK-03:
    name: "PreToolUse é˜»æ­¢å¿…é¡»è¯´æ˜åŸå› "
    rule: "PreToolUse Hook é˜»æ­¢æ‰§è¡Œæ—¶å¿…é¡»è¯´æ˜åŸå› "
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "é˜»æ­¢æ¶ˆæ¯æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ exit_code == 1 æ—¶æ˜¯å¦æœ‰ stderr æ¶ˆæ¯"
        2: "æ¶ˆæ¯æ˜¯å¦è¯´æ˜äº†é˜»æ­¢åŸå› "
        3: "æ— åŸå› çš„é˜»æ­¢ = è¿è§„"
      è¯æ®: "stderr é˜»æ­¢æ¶ˆæ¯"
    consequence: "ç”¨æˆ·å›°æƒ‘ï¼Œé‡æ–°æ‰§è¡Œå¹¶æä¾›åŸå› "

  HK-04:
    name: "Hook æ‰§è¡Œå¿…é¡»è®°å½•æ—¥å¿—"
    rule: "æ‰€æœ‰ Hook æ‰§è¡Œå¿…é¡»è®°å½•åˆ°æ—¥å¿—"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "æ—¥å¿—æ–‡ä»¶æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ .orchestra/hooks/hook-log.json æ˜¯å¦å­˜åœ¨"
        2: "æ£€æŸ¥æ¯æ¬¡ Hook æ‰§è¡Œæ˜¯å¦æœ‰è®°å½•"
        3: "æ— è®°å½• = è¿è§„"
      è¯æ®: "hook-log.json å†…å®¹"
    consequence: "æ— æ³•è¿½æº¯é—®é¢˜ï¼Œè¡¥å……æ—¥å¿—è®°å½•"
```

---

## ğŸ“‚ å­˜æ¡£ç»“æ„

```
.orchestra/
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ config.json              # Hook é…ç½®ï¼ˆé¡¹ç›®çº§è¦†ç›–ï¼‰
â”‚   â”œâ”€â”€ hook-log.json            # Hook æ‰§è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ scripts/                 # è‡ªå®šä¹‰ Hook è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ session-start.js
â”‚   â”‚   â”œâ”€â”€ session-end.js
â”‚   â”‚   â”œâ”€â”€ pre-compact.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ state/
â”‚       â”œâ”€â”€ session-state.json   # ä¼šè¯çŠ¶æ€ï¼ˆè·¨ä¼šè¯æŒä¹…åŒ–ï¼‰
â”‚       â””â”€â”€ pending-reports.json # å¾…å¤„ç†çš„å­¦ä¹ æŠ¥å‘Š
â””â”€â”€ ...
```

---

## ğŸ“‹ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v1.0 | 2026-01-24 | åˆå§‹ç‰ˆæœ¬ï¼š6 ç§ Hook ç±»å‹ã€é¢„ç½® Hooksã€ä¸å²å®˜å¯¹æ¥ã€4 æ¡é“å¾‹ |

---

**ğŸ”” é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰Â· å®Œ**
