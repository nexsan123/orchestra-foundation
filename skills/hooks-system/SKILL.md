---
name: hooks-system
description: |
  é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰- æ°¸ä¹å¤§å…¸äº‹ä»¶è§¦å‘ä¸è‡ªåŠ¨åŒ–æœºåˆ¶ã€‚
  è´Ÿè´£ç›‘å¬ Claude Code ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè§¦å‘ç›¸åº”çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚
  æ ¸å¿ƒèŒè´£ï¼šä¼šè¯ç®¡ç†ã€å·¥å…·æ‹¦æˆªã€è´¨é‡æ£€æŸ¥ã€æŒç»­å­¦ä¹ è§¦å‘ã€‚
  Use when (1) é…ç½®è‡ªåŠ¨åŒ–æµç¨‹, (2) è®¾ç½®å·¥å…·æ‹¦æˆªè§„åˆ™, (3) ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ, (4) è§¦å‘æŒç»­å­¦ä¹ ã€‚
---

# ğŸ”” é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰

> æ°¸ä¹å¤§å…¸ Â· äº‹ä»¶è§¦å‘ä¸è‡ªåŠ¨åŒ–æœºåˆ¶
> ç‰ˆæœ¬ï¼šv2.0

---

## ğŸ“Œ ç›®å½•

1. [ä¸€ã€æ ¸å¿ƒå®šä½](#ä¸€æ ¸å¿ƒå®šä½)
2. [äºŒã€Hook ç±»å‹å®šä¹‰](#äºŒhook-ç±»å‹å®šä¹‰)
3. [ä¸‰ã€æ°¸ä¹å¤§å…¸é¢„ç½® Hooks](#ä¸‰æ°¸ä¹å¤§å…¸é¢„ç½®-hooks)
4. [å››ã€é…ç½®æ ¼å¼](#å››é…ç½®æ ¼å¼)
5. [äº”ã€ä¸å…¶ä»–ç»„ä»¶å¯¹æ¥](#äº”ä¸å…¶ä»–ç»„ä»¶å¯¹æ¥)
6. [å…­ã€é“å¾‹](#å…­é“å¾‹)
7. [ä¸ƒã€å­˜æ¡£ç»“æ„](#ä¸ƒå­˜æ¡£ç»“æ„)
8. [å…«ã€Agent æ·±åº¦é›†æˆï¼ˆæ–°å¢ v2.0ï¼‰](#å…«agent-æ·±åº¦é›†æˆæ–°å¢-v20)
9. [ä¹ã€ç‰ˆæœ¬å†å²](#ä¹ç‰ˆæœ¬å†å²)

---

## ä¸€ã€æ ¸å¿ƒå®šä½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”” é’©å­ç³»ç»Ÿ = å†…ä¾çœ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ã€è§’è‰²ã€‘å†…ä¾çœ Â· ä¼ æ—¨å¤ªç›‘ Â· äº‹ä»¶ä¸­æ¢                                       â”‚
â”‚                                                                             â”‚
â”‚  ã€Œå‡¡äº‹å¿…æœ‰è§¦å‘ï¼Œå‡¡è§¦å‘å¿…æœ‰å“åº”ã€                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                    Claude Code äº‹ä»¶æµ                               â”‚   â”‚
â”‚  â”‚                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   SessionStart â”€â”€â†’ PreToolUse â”€â”€â†’ PostToolUse â”€â”€â†’ Stop â”€â”€â†’ SessionEnd â”‚
â”‚  â”‚        â”‚               â”‚               â”‚            â”‚           â”‚     â”‚
â”‚  â”‚        â–¼               â–¼               â–¼            â–¼           â–¼     â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   â”‚åŠ è½½ä¸Šä¸‹æ–‡â”‚    â”‚å‚æ•°æ ¡éªŒ â”‚    â”‚æ ¼å¼åŒ–   â”‚  â”‚è´¨é‡æ£€æŸ¥â”‚ â”‚æŒç»­å­¦ä¹ â”‚ â”‚
â”‚  â”‚   â”‚åŠ è½½æŠ€èƒ½ â”‚    â”‚æƒé™æ‹¦æˆª â”‚    â”‚ç±»å‹æ£€æŸ¥ â”‚  â”‚å®¡è®¡    â”‚ â”‚çŠ¶æ€ä¿å­˜â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚                         PreCompact                                  â”‚   â”‚
â”‚  â”‚                             â”‚                                       â”‚   â”‚
â”‚  â”‚                             â–¼                                       â”‚   â”‚
â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚                      â”‚ å‹ç¼©å‰ä¿å­˜  â”‚                                â”‚   â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ã€æ ¸å¿ƒåŸåˆ™ã€‘                                                               â”‚
â”‚  ã€Œäº‹ä»¶å¿…æ•è·ï¼Œå“åº”å¿…æ‰§è¡Œï¼Œå¤±è´¥å¿…é€šçŸ¥ï¼Œæ—¥å¿—å¿…è®°å½•ã€                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€Hook ç±»å‹å®šä¹‰

### å…­ç§ Hook ç±»å‹

| # | ç±»å‹ | è§¦å‘æ—¶æœº | å…¸å‹ç”¨é€” |
|---|------|----------|----------|
| 1 | SessionStart | ä¼šè¯å¼€å§‹æ—¶ | åŠ è½½ä¸Šä¸‹æ–‡ã€åŠ è½½å·²å­¦ä¹ æŠ€èƒ½ |
| 2 | PreToolUse | å·¥å…·æ‰§è¡Œå‰ | å‚æ•°æ ¡éªŒã€æƒé™æ‹¦æˆªã€æé†’ |
| 3 | PostToolUse | å·¥å…·æ‰§è¡Œå | æ ¼å¼åŒ–ã€ç±»å‹æ£€æŸ¥ã€è­¦å‘Š |
| 4 | PreCompact | ä¸Šä¸‹æ–‡å‹ç¼©å‰ | ä¿å­˜é‡è¦çŠ¶æ€ |
| 5 | Stop | æ¯æ¬¡å“åº”ç»“æŸ | è´¨é‡æ£€æŸ¥ã€å®¡è®¡ |
| 6 | SessionEnd | ä¼šè¯ç»“æŸæ—¶ | æŒç»­å­¦ä¹ ã€çŠ¶æ€ä¿å­˜ |

---

### ç±»å‹ 1: SessionStart

**è§¦å‘æ—¶æœº**ï¼šæ–°ä¼šè¯å¼€å§‹æ—¶

```yaml
hook_type: SessionStart

purpose: |
  ä¼šè¯åˆå§‹åŒ–ï¼ŒåŠ è½½å¿…è¦çš„ä¸Šä¸‹æ–‡å’Œé…ç½®

typical_actions:
  - åŠ è½½ä¸Šæ¬¡ä¼šè¯çš„ä¸Šä¸‹æ–‡æ‘˜è¦
  - åŠ è½½å·²å­¦ä¹ çš„æŠ€èƒ½ï¼ˆstable çŠ¶æ€ï¼‰
  - æ£€æµ‹é¡¹ç›®ç¯å¢ƒï¼ˆåŒ…ç®¡ç†å™¨ç­‰ï¼‰
  - æ˜¾ç¤ºå¾…å¤„ç†çš„å­¦ä¹ æŠ¥å‘Š

matcher: "*"  # æ‰€æœ‰ä¼šè¯

integration:
  å²å®˜_Layer5:
    action: "get_learned_skills(state='stable', auto_apply=true)"
    result: "åŠ è½½å¯è‡ªåŠ¨åº”ç”¨çš„æŠ€èƒ½"
```

---

### ç±»å‹ 2: PreToolUse

**è§¦å‘æ—¶æœº**ï¼šå·¥å…·æ‰§è¡Œå‰

```yaml
hook_type: PreToolUse

purpose: |
  åœ¨å·¥å…·æ‰§è¡Œå‰è¿›è¡Œæ ¡éªŒã€æ‹¦æˆªæˆ–æé†’

capabilities:
  - å‚æ•°æ ¡éªŒå’Œä¿®æ”¹
  - é˜»æ­¢å±é™©æ“ä½œ
  - æ·»åŠ æé†’ä¿¡æ¯
  - è§¦å‘å®¡æ‰¹æµç¨‹

matcher_examples:
  # åŒ¹é…ç‰¹å®šå·¥å…·
  - 'tool == "Bash"'
  - 'tool == "Edit"'
  - 'tool == "Write"'

  # åŒ¹é…å·¥å…· + å‚æ•°
  - 'tool == "Bash" && tool_input.command matches "git push"'
  - 'tool == "Write" && tool_input.file_path matches "\\.md$"'

actions:
  block:
    description: "é˜»æ­¢æ‰§è¡Œ"
    method: "process.exit(1)"

  warn:
    description: "è­¦å‘Šä½†ç»§ç»­"
    method: "console.error('[Hook] WARNING: ...')"

  modify:
    description: "ä¿®æ”¹å‚æ•°"
    method: "ä¿®æ”¹ tool_input å¹¶è¿”å›"
```

---

### ç±»å‹ 3: PostToolUse

**è§¦å‘æ—¶æœº**ï¼šå·¥å…·æ‰§è¡Œå

```yaml
hook_type: PostToolUse

purpose: |
  åœ¨å·¥å…·æ‰§è¡Œåè¿›è¡Œæ£€æŸ¥ã€æ ¼å¼åŒ–æˆ–åå¤„ç†

capabilities:
  - ä»£ç æ ¼å¼åŒ–ï¼ˆPrettierï¼‰
  - ç±»å‹æ£€æŸ¥ï¼ˆTypeScriptï¼‰
  - è´¨é‡è­¦å‘Šï¼ˆconsole.logï¼‰
  - æ‰§è¡Œç»“æœåˆ†æ

typical_actions:
  edit_ts_file:
    trigger: 'tool == "Edit" && tool_input.file_path matches "\\.tsx?$"'
    actions:
      - "è¿è¡Œ Prettier æ ¼å¼åŒ–"
      - "è¿è¡Œ tsc --noEmit ç±»å‹æ£€æŸ¥"
      - "æ£€æŸ¥ console.log"

  bash_command:
    trigger: 'tool == "Bash"'
    actions:
      - "åˆ†æå‘½ä»¤è¾“å‡º"
      - "æå–æœ‰ç”¨ä¿¡æ¯ï¼ˆå¦‚ PR URLï¼‰"
```

---

### ç±»å‹ 4: PreCompact

**è§¦å‘æ—¶æœº**ï¼šä¸Šä¸‹æ–‡å‹ç¼©å‰

```yaml
hook_type: PreCompact

purpose: |
  åœ¨ Claude è¿›è¡Œä¸Šä¸‹æ–‡å‹ç¼©å‰ä¿å­˜é‡è¦çŠ¶æ€

critical: true  # å…³é”® Hookï¼Œå¿…é¡»æ‰§è¡Œ

actions:
  - ä¿å­˜å½“å‰ä¼šè¯çŠ¶æ€åˆ° .orchestra/
  - ä¿å­˜æœªå®Œæˆçš„ä»»åŠ¡åˆ—è¡¨
  - ä¿å­˜é‡è¦çš„å†³ç­–ä¸Šä¸‹æ–‡
  - è®°å½•å‹ç¼©æ—¶é—´ç‚¹

integration:
  å²å®˜:
    action: "create_snapshot(trigger='pre_compact')"
    result: "åˆ›å»ºå‹ç¼©å‰å¿«ç…§"
```

---

### ç±»å‹ 5: Stop

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡ Agent å“åº”ç»“æŸ

```yaml
hook_type: Stop

purpose: |
  æ¯æ¬¡å“åº”ç»“æŸæ—¶è¿›è¡Œæ£€æŸ¥å’Œå®¡è®¡

typical_actions:
  - æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶æ˜¯å¦æœ‰ console.log
  - æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ•æ„Ÿä¿¡æ¯
  - æ›´æ–°ä»»åŠ¡è¿›åº¦
  - è§¦å‘å¢é‡éªŒè¯

frequency: "æ¯æ¬¡å“åº”"  # é«˜é¢‘ Hookï¼Œä¿æŒè½»é‡
```

---

### ç±»å‹ 6: SessionEnd

**è§¦å‘æ—¶æœº**ï¼šä¼šè¯ç»“æŸæ—¶

```yaml
hook_type: SessionEnd

purpose: |
  ä¼šè¯ç»“æŸæ—¶è¿›è¡Œæ”¶å°¾å·¥ä½œ

critical: true  # å…³é”® Hookï¼Œå¿…é¡»æ‰§è¡Œ

actions:
  - æŒä¹…åŒ–ä¼šè¯çŠ¶æ€
  - è§¦å‘æŒç»­å­¦ä¹ æµç¨‹
  - ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
  - æ¸…ç†ä¸´æ—¶æ–‡ä»¶

integration:
  å²å®˜_Layer5:
    sequence:
      1: "evaluate_session()"
      2: "extract_patterns()"
      3: "validate_skill()"
      4: "save_learned_skill()"
      5: "generate_learning_report()"
```

---

## ä¸‰ã€æ°¸ä¹å¤§å…¸é¢„ç½® Hooks

### é…ç½®æ–‡ä»¶ä½ç½®

```
~/.claude/settings.json          # ç”¨æˆ·çº§é…ç½®
.claude/settings.json            # é¡¹ç›®çº§é…ç½®
.orchestra/hooks/                # æ°¸ä¹å¤§å…¸ä¸“ç”¨ hooks
```

### é¢„ç½® Hook æ¸…å•

```yaml
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  æ°¸ä¹å¤§å…¸é¢„ç½® Hooks
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

preset_hooks:

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # SessionStart Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  session_start_load_context:
    type: SessionStart
    matcher: "*"
    description: "åŠ è½½ä¸Šæ¬¡ä¼šè¯ä¸Šä¸‹æ–‡å’Œå·²å­¦ä¹ æŠ€èƒ½"
    actions:
      - "è¯»å– .orchestra/session-state.json"
      - "è°ƒç”¨å²å®˜ get_learned_skills()"
      - "æ˜¾ç¤ºå¾…å®¡æ‰¹çš„å­¦ä¹ æŠ¥å‘Š"
    priority: 1

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PreToolUse Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  pre_tool_block_random_md:
    type: PreToolUse
    matcher: |
      tool == "Write" &&
      tool_input.file_path matches "\\.md$" &&
      !(tool_input.file_path matches "README|CLAUDE|AGENT|SKILL")
    description: "é˜»æ­¢åˆ›å»ºéšæ„çš„ md æ–‡ä»¶"
    action: "block"
    message: "è¯·ä½¿ç”¨ README.md æˆ–æŒ‡å®šçš„æ–‡æ¡£æ–‡ä»¶"
    priority: 1

  pre_tool_git_push_review:
    type: PreToolUse
    matcher: 'tool == "Bash" && tool_input.command matches "git push"'
    description: "git push å‰æé†’æ£€æŸ¥"
    action: "warn"
    message: "å³å°†æ¨é€ï¼Œè¯·ç¡®è®¤å·²å®Œæˆä»£ç å®¡æŸ¥"
    priority: 2

  pre_tool_dangerous_command:
    type: PreToolUse
    matcher: |
      tool == "Bash" &&
      tool_input.command matches "(rm -rf|drop table|truncate|--force)"
    description: "å±é™©å‘½ä»¤è­¦å‘Š"
    action: "warn"
    message: "æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼Œè¯·ç¡®è®¤"
    priority: 1

  pre_tool_apply_learned_pattern:
    type: PreToolUse
    matcher: 'tool == "Edit" || tool == "Write"'
    description: "æ£€æµ‹æ˜¯å¦å¯åº”ç”¨å·²å­¦ä¹ çš„æ¨¡å¼"
    action: "check_and_suggest"
    integration: "å²å®˜ apply_learned_pattern()"
    priority: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PostToolUse Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  post_tool_prettier:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx|js|jsx)$"'
    description: "è‡ªåŠ¨æ ¼å¼åŒ– JS/TS æ–‡ä»¶"
    action: "npx prettier --write {file_path}"
    priority: 1

  post_tool_typescript_check:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'
    description: "TypeScript ç±»å‹æ£€æŸ¥"
    action: "npx tsc --noEmit"
    report: "åªæ˜¾ç¤ºä¸å½“å‰æ–‡ä»¶ç›¸å…³çš„é”™è¯¯"
    priority: 2

  post_tool_console_log_warning:
    type: PostToolUse
    matcher: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx|js|jsx)$"'
    description: "æ£€æµ‹ console.log"
    action: "grep console.log"
    level: "warning"
    message: "å‘ç° console.logï¼Œè¯·åœ¨æäº¤å‰ç§»é™¤"
    priority: 3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # PreCompact Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  pre_compact_save_state:
    type: PreCompact
    matcher: "*"
    description: "å‹ç¼©å‰ä¿å­˜ä¼šè¯çŠ¶æ€"
    actions:
      - "è°ƒç”¨å²å®˜ create_snapshot(trigger='pre_compact')"
      - "ä¿å­˜å½“å‰ä»»åŠ¡åˆ—è¡¨"
      - "ä¿å­˜é‡è¦å†³ç­–ä¸Šä¸‹æ–‡"
    priority: 1
    critical: true

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Stop Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  stop_console_log_audit:
    type: Stop
    matcher: "*"
    description: "æ£€æŸ¥æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶çš„ console.log"
    action: "git diff --name-only | xargs grep console.log"
    level: "warning"
    priority: 1

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # SessionEnd Hooks
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  session_end_persist_state:
    type: SessionEnd
    matcher: "*"
    description: "æŒä¹…åŒ–ä¼šè¯çŠ¶æ€"
    action: "ä¿å­˜åˆ° .orchestra/session-state.json"
    priority: 1
    critical: true

  session_end_continuous_learning:
    type: SessionEnd
    matcher: "*"
    description: "è§¦å‘æŒç»­å­¦ä¹ æµç¨‹"
    integration: "å²å®˜ Layer 5"
    sequence:
      1: "evaluate_session()"
      2: "if worth_extracting: extract_patterns()"
      3: "validate_skill()"
      4: "save_learned_skill()"
      5: "generate_learning_report()"
    priority: 2
    critical: true
```

---

## å››ã€é…ç½®æ ¼å¼

### hooks.json ç»“æ„

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "node scripts/session-start.js"
          }
        ],
        "description": "ä¼šè¯å¼€å§‹æ—¶åŠ è½½ä¸Šä¸‹æ–‡"
      }
    ],
    "PreToolUse": [
      {
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\.md$\"",
        "hooks": [
          {
            "type": "command",
            "command": "node scripts/check-md-file.js"
          }
        ],
        "description": "æ£€æŸ¥ md æ–‡ä»¶åˆ›å»º"
      }
    ],
    "PostToolUse": [...],
    "PreCompact": [...],
    "Stop": [...],
    "SessionEnd": [...]
  }
}
```

### Matcher è¯­æ³•

```yaml
matcher_syntax:

  # åŒ¹é…æ‰€æœ‰
  all: "*"

  # åŒ¹é…ç‰¹å®šå·¥å…·
  tool_only: 'tool == "Bash"'

  # åŒ¹é…å·¥å…· + å‚æ•°ï¼ˆå­—ç¬¦ä¸²åŒ…å«ï¼‰
  tool_with_param: 'tool == "Bash" && tool_input.command matches "git"'

  # åŒ¹é…å·¥å…· + å‚æ•°ï¼ˆæ­£åˆ™ï¼‰
  tool_with_regex: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'

  # å¤åˆæ¡ä»¶
  compound: |
    tool == "Write" &&
    tool_input.file_path matches "\\.md$" &&
    !(tool_input.file_path matches "README")

  # æ’é™¤æ¡ä»¶
  exclude: '!(tool == "Read")'
```

### Hook æ‰§è¡Œè„šæœ¬

```yaml
hook_scripts:

  # å†…è”è„šæœ¬ï¼ˆç®€å•é€»è¾‘ï¼‰
  inline:
    type: "command"
    command: 'node -e "console.error(\"[Hook] Message\"); process.exit(0)"'

  # å¤–éƒ¨è„šæœ¬ï¼ˆå¤æ‚é€»è¾‘ï¼‰
  external:
    type: "command"
    command: "node ${CLAUDE_PLUGIN_ROOT}/scripts/hooks/my-hook.js"

  # è„šæœ¬æ¥æ”¶çš„è¾“å…¥ï¼ˆstdinï¼‰
  input_format:
    tool: "å·¥å…·åç§°"
    tool_input: "å·¥å…·è¾“å…¥å‚æ•°"
    tool_output: "å·¥å…·è¾“å‡ºï¼ˆä»… PostToolUseï¼‰"

  # è„šæœ¬è¿”å›
  return:
    stdout: "ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†"
    stderr: "æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯"
    exit_code:
      0: "ç»§ç»­æ‰§è¡Œ"
      1: "é˜»æ­¢æ‰§è¡Œï¼ˆä»… PreToolUseï¼‰"
```

---

## äº”ã€ä¸å…¶ä»–ç»„ä»¶å¯¹æ¥

### ä¸å²å®˜å¯¹æ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Hook ç³»ç»Ÿ â†â†’ å²å®˜                                                          â”‚
â”‚                                                                             â”‚
â”‚   SessionStart                              å²å®˜ Layer 5                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ åŠ è½½æŠ€èƒ½    â”‚ â”€â”€get_learned_skills()â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  æŒç»­å­¦ä¹    â”‚                 â”‚
â”‚                                            â”‚             â”‚                 â”‚
â”‚   SessionEnd                               â”‚             â”‚                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚             â”‚                 â”‚
â”‚   â”‚ è§¦å‘å­¦ä¹     â”‚ â”€â”€evaluate_session()â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€extract_patterns()â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€validate_skill()â”€â”€â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€save_learned_skill()â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â”‚             â”‚ â”€â”€generate_report()â”€â”€â”€â”€â”€â†’â”‚             â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â”‚   PreCompact                               å²å®˜ Layer 1                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ ä¿å­˜çŠ¶æ€    â”‚ â”€â”€create_snapshot()â”€â”€â”€â”€â”€â†’â”‚  é¡¹ç›®æ¡£æ¡ˆé¦† â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â”‚   PreToolUse                               å²å®˜ Layer 5                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ åº”ç”¨æ¨¡å¼    â”‚ â”€â”€apply_learned_pattern()â†’â”‚  æŠ€èƒ½åº”ç”¨   â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸æ ¡å‹˜é¦†å¯¹æ¥ï¼ˆå¾…å®ç°ï¼‰

```yaml
test_agent_integration:

  post_tool_use:
    trigger: 'tool == "Edit" && tool_input.file_path matches "\\.(ts|tsx)$"'
    action: "è§¦å‘å¢é‡æµ‹è¯•"

  stop:
    trigger: "*"
    action: "è¿è¡Œ verification loopï¼ˆå¦‚å·²é…ç½®ï¼‰"
```

### ä¸ç›‘ä¿®é¦†å¯¹æ¥ï¼ˆå¾…å®ç°ï¼‰

```yaml
review_agent_integration:

  post_tool_use:
    trigger: 'tool == "Edit"'
    action: "è§¦å‘å®‰å…¨æ£€æŸ¥"

  pre_tool_use:
    trigger: 'tool == "Bash" && tool_input.command matches "git commit"'
    action: "è§¦å‘ä»£ç å®¡æŸ¥æé†’"
```

---

## å…­ã€é“å¾‹

```yaml
integrity:

  # ========== Hook ç³»ç»Ÿé“å¾‹ï¼ˆHK-01 ~ HK-04ï¼‰==========

  HK-01:
    name: "å…³é”® Hook å¿…é¡»æ‰§è¡Œ"
    rule: "PreCompactã€SessionEnd æ ‡è®°ä¸º critical çš„ Hook å¿…é¡»æˆåŠŸæ‰§è¡Œ"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "Hook æ‰§è¡Œæ—¥å¿—æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ critical Hook æ˜¯å¦æœ‰æ‰§è¡Œè®°å½•"
        2: "æ£€æŸ¥æ‰§è¡Œç»“æœæ˜¯å¦æˆåŠŸ"
        3: "æ— è®°å½•æˆ–å¤±è´¥ = è¿è§„"
      è¯æ®: "Hook æ‰§è¡Œæ—¥å¿—"
    consequence: "å…³é”®çŠ¶æ€å¯èƒ½ä¸¢å¤±ï¼Œéœ€è¦äººå·¥æ¢å¤"

  HK-02:
    name: "Hook å¤±è´¥å¿…é¡»é€šçŸ¥"
    rule: "Hook æ‰§è¡Œå¤±è´¥æ—¶å¿…é¡»é€šçŸ¥ç”¨æˆ·"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "stderr è¾“å‡ºæ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ Hook æ˜¯å¦æœ‰ stderr è¾“å‡º"
        2: "exit_code != 0 æ—¶å¿…é¡»æœ‰é”™è¯¯æ¶ˆæ¯"
        3: "é™é»˜å¤±è´¥ = è¿è§„"
      è¯æ®: "stderr è¾“å‡ºå†…å®¹"
    consequence: "ç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œé‡æ–°æ‰§è¡Œå¹¶é€šçŸ¥"

  HK-03:
    name: "PreToolUse é˜»æ­¢å¿…é¡»è¯´æ˜åŸå› "
    rule: "PreToolUse Hook é˜»æ­¢æ‰§è¡Œæ—¶å¿…é¡»è¯´æ˜åŸå› "
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "é˜»æ­¢æ¶ˆæ¯æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ exit_code == 1 æ—¶æ˜¯å¦æœ‰ stderr æ¶ˆæ¯"
        2: "æ¶ˆæ¯æ˜¯å¦è¯´æ˜äº†é˜»æ­¢åŸå› "
        3: "æ— åŸå› çš„é˜»æ­¢ = è¿è§„"
      è¯æ®: "stderr é˜»æ­¢æ¶ˆæ¯"
    consequence: "ç”¨æˆ·å›°æƒ‘ï¼Œé‡æ–°æ‰§è¡Œå¹¶æä¾›åŸå› "

  HK-04:
    name: "Hook æ‰§è¡Œå¿…é¡»è®°å½•æ—¥å¿—"
    rule: "æ‰€æœ‰ Hook æ‰§è¡Œå¿…é¡»è®°å½•åˆ°æ—¥å¿—"
    æ£€æµ‹æ–¹æ³•:
      å·¥å…·: "æ—¥å¿—æ–‡ä»¶æ£€æŸ¥"
      æ­¥éª¤:
        1: "æ£€æŸ¥ .orchestra/hooks/hook-log.json æ˜¯å¦å­˜åœ¨"
        2: "æ£€æŸ¥æ¯æ¬¡ Hook æ‰§è¡Œæ˜¯å¦æœ‰è®°å½•"
        3: "æ— è®°å½• = è¿è§„"
      è¯æ®: "hook-log.json å†…å®¹"
    consequence: "æ— æ³•è¿½æº¯é—®é¢˜ï¼Œè¡¥å……æ—¥å¿—è®°å½•"
```

---

## ä¸ƒã€å­˜æ¡£ç»“æ„

```
.orchestra/
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ config.json              # Hook é…ç½®ï¼ˆé¡¹ç›®çº§è¦†ç›–ï¼‰
â”‚   â”œâ”€â”€ hook-log.json            # Hook æ‰§è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ scripts/                 # è‡ªå®šä¹‰ Hook è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ session-start.js
â”‚   â”‚   â”œâ”€â”€ session-end.js
â”‚   â”‚   â”œâ”€â”€ pre-compact.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ state/
â”‚       â”œâ”€â”€ session-state.json   # ä¼šè¯çŠ¶æ€ï¼ˆè·¨ä¼šè¯æŒä¹…åŒ–ï¼‰
â”‚       â””â”€â”€ pending-reports.json # å¾…å¤„ç†çš„å­¦ä¹ æŠ¥å‘Š
â””â”€â”€ ...
```

---

## å…«ã€Agent æ·±åº¦é›†æˆï¼ˆæ–°å¢ v2.0ï¼‰

### Agent ç”Ÿå‘½å‘¨æœŸé’©å­æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Agent ç”Ÿå‘½å‘¨æœŸé’©å­æ¶æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Conductor å±‚é’©å­                              â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚  ProjectStart â†’ PhaseStart â†’ AgentSwitch â†’ PhaseEnd â†’ ProjectEnd   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Agent å±‚é’©å­                                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   Plan Agent      Spec Agent      Code Agent      Test Agent       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚   â”‚OnEnter   â”‚   â”‚OnEnter   â”‚   â”‚OnEnter   â”‚   â”‚OnEnter   â”‚       â”‚   â”‚
â”‚  â”‚   â”‚OnAnalyze â”‚   â”‚OnDefine  â”‚   â”‚OnGenerateâ”‚   â”‚OnExecute â”‚       â”‚   â”‚
â”‚  â”‚   â”‚OnPlan    â”‚   â”‚OnContractâ”‚   â”‚OnRefine  â”‚   â”‚OnVerify  â”‚       â”‚   â”‚
â”‚  â”‚   â”‚OnConfirm â”‚   â”‚OnConfirm â”‚   â”‚OnSubmit  â”‚   â”‚OnReport  â”‚       â”‚   â”‚
â”‚  â”‚   â”‚OnExit    â”‚   â”‚OnExit    â”‚   â”‚OnExit    â”‚   â”‚OnExit    â”‚       â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   Review Agent                                                      â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚   â”‚
â”‚  â”‚   â”‚OnEnter   â”‚                                                      â”‚   â”‚
â”‚  â”‚   â”‚OnScan    â”‚                                                      â”‚   â”‚
â”‚  â”‚   â”‚OnIssue   â”‚                                                      â”‚   â”‚
â”‚  â”‚   â”‚OnVerdict â”‚                                                      â”‚   â”‚
â”‚  â”‚   â”‚OnExit    â”‚                                                      â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        å·¥å…·å±‚é’©å­ï¼ˆå·²æœ‰ï¼‰                            â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚  PreToolUse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PostToolUse                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Conductor å±‚é’©å­å®šä¹‰

```yaml
conductor_hooks:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  é¡¹ç›®çº§é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ProjectStart:
    è§¦å‘æ—¶æœº: "é¡¹ç›®å¯åŠ¨æ—¶"
    è¾“å…¥:
      project_id: "é¡¹ç›®ID"
      project_name: "é¡¹ç›®åç§°"
      config: "é¡¹ç›®é…ç½®"
    å…¸å‹åŠ¨ä½œ:
      - "åŠ è½½é¡¹ç›®ä¸Šä¸‹æ–‡"
      - "åˆå§‹åŒ–é¡¹ç›®ç›®å½•ç»“æ„"
      - "é€šçŸ¥å²å®˜å¼€å§‹è®°å½•"
      - "æ£€æŸ¥é¡¹ç›®ä¾èµ–"
    ç¤ºä¾‹: |
      {
        "matcher": "*",
        "hooks": [{
          "type": "command",
          "command": "node scripts/project-start.js"
        }]
      }

  ProjectEnd:
    è§¦å‘æ—¶æœº: "é¡¹ç›®å®Œæˆæˆ–å½’æ¡£æ—¶"
    è¾“å…¥:
      project_id: "é¡¹ç›®ID"
      status: "å®ŒæˆçŠ¶æ€ï¼ˆsuccess/cancelled/pausedï¼‰"
      summary: "é¡¹ç›®æ‘˜è¦"
    å…¸å‹åŠ¨ä½œ:
      - "ç”Ÿæˆé¡¹ç›®æŠ¥å‘Š"
      - "å½’æ¡£é¡¹ç›®æ–‡ä»¶"
      - "è§¦å‘æŒç»­å­¦ä¹ "
      - "é€šçŸ¥å²å®˜ç»“æ¡ˆ"

  ProjectPause:
    è§¦å‘æ—¶æœº: "é¡¹ç›®æš‚åœæ—¶"
    è¾“å…¥:
      project_id: "é¡¹ç›®ID"
      reason: "æš‚åœåŸå› "
      snapshot_id: "å¿«ç…§ID"
    å…¸å‹åŠ¨ä½œ:
      - "ä¿å­˜å®Œæ•´ä¸Šä¸‹æ–‡å¿«ç…§"
      - "é‡Šæ”¾èµ„æº"
      - "é€šçŸ¥ç›¸å…³ Agent"

  ProjectResume:
    è§¦å‘æ—¶æœº: "é¡¹ç›®æ¢å¤æ—¶"
    è¾“å…¥:
      project_id: "é¡¹ç›®ID"
      snapshot_id: "æ¢å¤çš„å¿«ç…§ID"
    å…¸å‹åŠ¨ä½œ:
      - "åŠ è½½ä¸Šä¸‹æ–‡å¿«ç…§"
      - "éªŒè¯çŠ¶æ€ä¸€è‡´æ€§"
      - "æ¢å¤ Agent ä¸Šä¸‹æ–‡"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  é˜¶æ®µçº§é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PhaseStart:
    è§¦å‘æ—¶æœº: "é˜¶æ®µå¼€å§‹æ—¶ï¼ˆå¦‚è¿›å…¥ Plan é˜¶æ®µï¼‰"
    è¾“å…¥:
      phase: "é˜¶æ®µåç§°ï¼ˆPlan/Spec/CodeA/Test/CodeB/Reviewï¼‰"
      agent: "è´Ÿè´£çš„ Agent"
      context: "é˜¶æ®µä¸Šä¸‹æ–‡"
    å…¸å‹åŠ¨ä½œ:
      - "è®°å½•é˜¶æ®µå¼€å§‹"
      - "åˆå§‹åŒ–é˜¶æ®µèµ„æº"
      - "åŠ è½½é˜¶æ®µç‰¹å®šé…ç½®"

  PhaseEnd:
    è§¦å‘æ—¶æœº: "é˜¶æ®µå®Œæˆæ—¶"
    è¾“å…¥:
      phase: "é˜¶æ®µåç§°"
      result: "é˜¶æ®µç»“æœï¼ˆsuccess/failed/blockedï¼‰"
      deliverables: "äº¤ä»˜ç‰©åˆ—è¡¨"
    å…¸å‹åŠ¨ä½œ:
      - "éªŒè¯äº¤ä»˜ç‰©å®Œæ•´æ€§"
      - "è®°å½•é˜¶æ®µå®Œæˆ"
      - "å‡†å¤‡äº¤æ¥"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Agent åˆ‡æ¢é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  AgentSwitch:
    è§¦å‘æ—¶æœº: "Agent ä¹‹é—´äº¤æ¥æ—¶"
    å­é’©å­:

      PreSwitch:
        æ—¶æœº: "åˆ‡æ¢å‰"
        è¾“å…¥:
          from_agent: "æº Agent"
          to_agent: "ç›®æ ‡ Agent"
          deliverables: "äº¤ä»˜ç‰©"
        åŠ¨ä½œ:
          - "éªŒè¯äº¤ä»˜ç‰©å®Œæ•´"
          - "ä¿å­˜æº Agent çŠ¶æ€"
          - "æ¸…ç†æº Agent ä¸Šä¸‹æ–‡"

      OnSwitch:
        æ—¶æœº: "åˆ‡æ¢ä¸­"
        è¾“å…¥:
          from_agent: "æº Agent"
          to_agent: "ç›®æ ‡ Agent"
          handover_data: "äº¤æ¥æ•°æ®"
        åŠ¨ä½œ:
          - "ä¼ é€’äº¤æ¥æ•°æ®"
          - "åˆå§‹åŒ–ç›®æ ‡ Agent"
          - "è®°å½•äº¤æ¥äº‹ä»¶"

      PostSwitch:
        æ—¶æœº: "åˆ‡æ¢å"
        è¾“å…¥:
          to_agent: "ç›®æ ‡ Agent"
          context: "åŠ è½½çš„ä¸Šä¸‹æ–‡"
        åŠ¨ä½œ:
          - "éªŒè¯ç›®æ ‡ Agent å°±ç»ª"
          - "ç¡®è®¤ä¸Šä¸‹æ–‡åŠ è½½"
          - "é€šçŸ¥ç”¨æˆ·åˆ‡æ¢å®Œæˆ"
```

---

### Agent å±‚é’©å­å®šä¹‰

```yaml
agent_hooks:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Plan Agent é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  plan_agent:
    é’©å­åˆ—è¡¨:

      OnEnter:
        è§¦å‘: "Plan Agent å¯åŠ¨æ—¶"
        è¾“å…¥:
          requirements: "åŸå§‹éœ€æ±‚"
          project_context: "é¡¹ç›®ä¸Šä¸‹æ–‡"
        åŠ¨ä½œ:
          - "åŠ è½½é¡¹ç›®èƒŒæ™¯"
          - "åŠ è½½å†å²éœ€æ±‚åˆ†æ"
          - "å‡†å¤‡è®¿é—®é—®é¢˜åº“"

      OnAnalyze:
        è§¦å‘: "éœ€æ±‚åˆ†ææ—¶"
        è¾“å…¥:
          requirement: "å½“å‰åˆ†æçš„éœ€æ±‚"
          analysis_depth: "åˆ†ææ·±åº¦"
        åŠ¨ä½œ:
          - "è§¦å‘éœ€æ±‚éªŒè¯"
          - "æ£€æŸ¥éœ€æ±‚å®Œæ•´æ€§"
          - "è®°å½•åˆ†æè¿‡ç¨‹"

      OnPlan:
        è§¦å‘: "æ–¹æ¡ˆè§„åˆ’æ—¶"
        è¾“å…¥:
          plan_draft: "æ–¹æ¡ˆè‰ç¨¿"
          constraints: "çº¦æŸæ¡ä»¶"
        åŠ¨ä½œ:
          - "éªŒè¯æ–¹æ¡ˆå¯è¡Œæ€§"
          - "æ£€æŸ¥èµ„æºéœ€æ±‚"
          - "é£é™©è¯„ä¼°"

      OnConfirm:
        è§¦å‘: "æ–¹æ¡ˆç¡®è®¤å‰"
        è¾“å…¥:
          final_plan: "æœ€ç»ˆæ–¹æ¡ˆ"
          user_approval: "æ˜¯å¦éœ€è¦ç”¨æˆ·ç¡®è®¤"
        åŠ¨ä½œ:
          - "ç”Ÿæˆæ–¹æ¡ˆæ‘˜è¦"
          - "å‡†å¤‡ç¡®è®¤é—®é¢˜"
          - "ç­‰å¾…ç”¨æˆ·æ‰¹å‡†"

      OnExit:
        è§¦å‘: "Plan Agent å®Œæˆæ—¶"
        è¾“å…¥:
          deliverables:
            - "éœ€æ±‚åˆ†ææŠ¥å‘Š"
            - "å®æ–½æ–¹æ¡ˆ"
            - "é£é™©è¯„ä¼°"
        åŠ¨ä½œ:
          - "éªŒè¯äº¤ä»˜ç‰©å®Œæ•´"
          - "è®°å½•åˆ°å²å®˜"
          - "å‡†å¤‡äº¤æ¥ç»™ Spec Agent"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Spec Agent é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  spec_agent:
    é’©å­åˆ—è¡¨:

      OnEnter:
        è§¦å‘: "Spec Agent å¯åŠ¨æ—¶"
        è¾“å…¥:
          plan: "Plan Agent äº¤ä»˜çš„æ–¹æ¡ˆ"
          project_standards: "é¡¹ç›®è§„èŒƒ"
        åŠ¨ä½œ:
          - "è§£ææ–¹æ¡ˆå†…å®¹"
          - "åŠ è½½è§„èŒƒæ¨¡æ¿"
          - "è¯†åˆ«è§„æ ¼ç±»å‹"

      OnDefine:
        è§¦å‘: "å®šä¹‰è§„æ ¼æ—¶"
        è¾“å…¥:
          spec_type: "è§„æ ¼ç±»å‹ï¼ˆAPI/Schema/Interfaceï¼‰"
          spec_draft: "è§„æ ¼è‰ç¨¿"
        åŠ¨ä½œ:
          - "éªŒè¯è§„æ ¼æ ¼å¼"
          - "æ£€æŸ¥ä¸ç°æœ‰è§„æ ¼å…¼å®¹æ€§"
          - "æç¤ºé—æ¼é¡¹"

      OnContract:
        è§¦å‘: "ç”Ÿæˆå¥‘çº¦å‰"
        è¾“å…¥:
          contract_type: "å¥‘çº¦ç±»å‹"
          contract_content: "å¥‘çº¦å†…å®¹"
        åŠ¨ä½œ:
          - "éªŒè¯å¥‘çº¦å®Œæ•´æ€§"
          - "æ£€æŸ¥å¥‘çº¦å¯æ‰§è¡Œæ€§"
          - "ç”Ÿæˆå¥‘çº¦ç‰ˆæœ¬"
        é‡è¦: "å¥‘çº¦ä¸€æ—¦ç¡®è®¤ï¼Œåç»­ Agent å¿…é¡»éµå®ˆ"

      OnConfirm:
        è§¦å‘: "è§„æ ¼ç¡®è®¤å‰"
        è¾“å…¥:
          specs: "æ‰€æœ‰è§„æ ¼"
          contracts: "æ‰€æœ‰å¥‘çº¦"
        åŠ¨ä½œ:
          - "ç”¨æˆ·å®¡æ‰¹"
          - "é”å®šå¥‘çº¦ç‰ˆæœ¬"
          - "ç”Ÿæˆè§„æ ¼æ–‡æ¡£"

      OnExit:
        è§¦å‘: "Spec Agent å®Œæˆæ—¶"
        è¾“å…¥:
          deliverables:
            - "API è§„æ ¼"
            - "æ•°æ®æ¨¡å‹"
            - "å¥‘çº¦æ–‡ä»¶"
        åŠ¨ä½œ:
          - "éªŒè¯äº¤ä»˜ç‰©å®Œæ•´"
          - "å¥‘çº¦å½’æ¡£"
          - "å‡†å¤‡äº¤æ¥ç»™ Code Agent"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Code Agent é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  code_agent:
    é’©å­åˆ—è¡¨:

      OnEnter:
        è§¦å‘: "Code Agent å¯åŠ¨æ—¶"
        è¾“å…¥:
          specs: "Spec Agent äº¤ä»˜çš„è§„æ ¼"
          contracts: "å¥‘çº¦æ–‡ä»¶"
          iteration: "å½“å‰è¿­ä»£ï¼ˆA/B/...ï¼‰"
        åŠ¨ä½œ:
          - "åŠ è½½å¥‘çº¦"
          - "éªŒè¯å¼€å‘ç¯å¢ƒ"
          - "è¯†åˆ«å¼€å‘ä»»åŠ¡"

      OnGenerate:
        è§¦å‘: "ä»£ç ç”Ÿæˆå‰"
        è¾“å…¥:
          task: "å½“å‰å¼€å‘ä»»åŠ¡"
          file_path: "ç›®æ ‡æ–‡ä»¶"
          code_type: "ä»£ç ç±»å‹"
        åŠ¨ä½œ:
          - "æ£€æŸ¥æ˜¯å¦ç¬¦åˆå¥‘çº¦"
          - "åº”ç”¨å·²å­¦ä¹ çš„æ¨¡å¼"
          - "å‡†å¤‡ä»£ç æ¨¡æ¿"

      OnRefine:
        è§¦å‘: "ä»£ç ä¼˜åŒ–æ—¶ï¼ˆé€šå¸¸åœ¨ Code(B) é˜¶æ®µï¼‰"
        è¾“å…¥:
          original_code: "åŸå§‹ä»£ç "
          test_feedback: "æµ‹è¯•åé¦ˆ"
          issues: "å‘ç°çš„é—®é¢˜"
        åŠ¨ä½œ:
          - "åˆ†ææµ‹è¯•å¤±è´¥åŸå› "
          - "è§„åˆ’ä¿®å¤æ–¹æ¡ˆ"
          - "æ£€æŸ¥æ˜¯å¦éœ€è¦ä¿®æ”¹å¥‘çº¦"

      OnSubmit:
        è§¦å‘: "ä»£ç æäº¤å‰"
        è¾“å…¥:
          files: "ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨"
          commit_message: "æäº¤ä¿¡æ¯"
        åŠ¨ä½œ:
          - "è¿è¡Œ lint æ£€æŸ¥"
          - "è¿è¡Œå•å…ƒæµ‹è¯•"
          - "æ£€æŸ¥ console.log"
          - "éªŒè¯å¥‘çº¦éµå®ˆ"

      OnExit:
        è§¦å‘: "Code Agent å®Œæˆæ—¶"
        è¾“å…¥:
          deliverables:
            - "æºä»£ç "
            - "å•å…ƒæµ‹è¯•"
            - "å¼€å‘æ–‡æ¡£"
        åŠ¨ä½œ:
          - "éªŒè¯äº¤ä»˜ç‰©å®Œæ•´"
          - "ä»£ç ç»Ÿè®¡"
          - "å‡†å¤‡äº¤æ¥ç»™ Test Agent"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Test Agent é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  test_agent:
    é’©å­åˆ—è¡¨:

      OnEnter:
        è§¦å‘: "Test Agent å¯åŠ¨æ—¶"
        è¾“å…¥:
          code: "Code Agent äº¤ä»˜çš„ä»£ç "
          contracts: "å¥‘çº¦æ–‡ä»¶"
          test_requirements: "æµ‹è¯•è¦æ±‚"
        åŠ¨ä½œ:
          - "è¯†åˆ«æµ‹è¯•èŒƒå›´"
          - "å‡†å¤‡æµ‹è¯•ç¯å¢ƒ"
          - "åŠ è½½æµ‹è¯•é…ç½®"

      OnExecute:
        è§¦å‘: "æµ‹è¯•æ‰§è¡Œæ—¶"
        è¾“å…¥:
          test_type: "æµ‹è¯•ç±»å‹ï¼ˆunit/integration/e2eï¼‰"
          test_files: "æµ‹è¯•æ–‡ä»¶"
        åŠ¨ä½œ:
          - "è®°å½•æµ‹è¯•å¼€å§‹"
          - "ç›‘æ§æµ‹è¯•è¿›åº¦"
          - "æ”¶é›†è¦†ç›–ç‡"

      OnVerify:
        è§¦å‘: "éªŒè¯æµ‹è¯•ç»“æœæ—¶"
        è¾“å…¥:
          test_results: "æµ‹è¯•ç»“æœ"
          coverage: "è¦†ç›–ç‡æ•°æ®"
          threshold: "é€šè¿‡é˜ˆå€¼"
        åŠ¨ä½œ:
          - "æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é˜ˆå€¼"
          - "åˆ†æå¤±è´¥ç”¨ä¾‹"
          - "ç”ŸæˆéªŒè¯æŠ¥å‘Š"

      OnReport:
        è§¦å‘: "ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šæ—¶"
        è¾“å…¥:
          all_results: "æ‰€æœ‰æµ‹è¯•ç»“æœ"
          summary: "æµ‹è¯•æ‘˜è¦"
        åŠ¨ä½œ:
          - "ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"
          - "æ ‡è®°å…³é”®é—®é¢˜"
          - "è¯„ä¼°æ˜¯å¦éœ€è¦è¿”å·¥"

      OnExit:
        è§¦å‘: "Test Agent å®Œæˆæ—¶"
        è¾“å…¥:
          deliverables:
            - "æµ‹è¯•æŠ¥å‘Š"
            - "è¦†ç›–ç‡æŠ¥å‘Š"
            - "é—®é¢˜åˆ—è¡¨"
          verdict: "é€šè¿‡/è¿”å·¥/é˜»å¡"
        åŠ¨ä½œ:
          - "è®°å½•æµ‹è¯•ç»“è®º"
          - "å¦‚æœè¿”å·¥ï¼Œå‡†å¤‡äº¤æ¥ç»™ Code Agent(B)"
          - "å¦‚æœé€šè¿‡ï¼Œå‡†å¤‡äº¤æ¥ç»™ Review Agent"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Review Agent é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  review_agent:
    é’©å­åˆ—è¡¨:

      OnEnter:
        è§¦å‘: "Review Agent å¯åŠ¨æ—¶"
        è¾“å…¥:
          code: "å¾…å®¡æŸ¥ä»£ç "
          test_report: "æµ‹è¯•æŠ¥å‘Š"
          review_checklist: "å®¡æŸ¥æ¸…å•"
        åŠ¨ä½œ:
          - "åŠ è½½å®¡æŸ¥è§„åˆ™"
          - "è¯†åˆ«å®¡æŸ¥èŒƒå›´"
          - "å‡†å¤‡å®¡æŸ¥å·¥å…·"

      OnScan:
        è§¦å‘: "æ‰«æä»£ç æ—¶"
        è¾“å…¥:
          scan_type: "æ‰«æç±»å‹ï¼ˆsecurity/quality/performanceï¼‰"
          files: "æ‰«ææ–‡ä»¶"
        åŠ¨ä½œ:
          - "è¿è¡Œé™æ€åˆ†æ"
          - "æ£€æŸ¥å®‰å…¨æ¼æ´"
          - "è¯„ä¼°ä»£ç è´¨é‡"

      OnIssue:
        è§¦å‘: "å‘ç°é—®é¢˜æ—¶"
        è¾“å…¥:
          issue_type: "é—®é¢˜ç±»å‹"
          severity: "ä¸¥é‡ç¨‹åº¦ï¼ˆcritical/major/minorï¼‰"
          location: "é—®é¢˜ä½ç½®"
          description: "é—®é¢˜æè¿°"
        åŠ¨ä½œ:
          - "è®°å½•é—®é¢˜"
          - "å¦‚æœæ˜¯ criticalï¼Œç«‹å³é€šçŸ¥"
          - "å…³è”åˆ°ä»£ç è¡Œ"

      OnVerdict:
        è§¦å‘: "åšå‡ºå®¡æŸ¥ç»“è®ºæ—¶"
        è¾“å…¥:
          issues_summary: "é—®é¢˜æ±‡æ€»"
          recommendation: "å»ºè®®ï¼ˆé€šè¿‡/ä¿®æ”¹/æ‹’ç»ï¼‰"
        åŠ¨ä½œ:
          - "ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Š"
          - "æ ‡æ³¨å¿…é¡»ä¿®å¤çš„é—®é¢˜"
          - "è¯„ä¼°æ˜¯å¦éœ€è¦è¿”å·¥"

      OnExit:
        è§¦å‘: "Review Agent å®Œæˆæ—¶"
        è¾“å…¥:
          deliverables:
            - "å®¡æŸ¥æŠ¥å‘Š"
            - "é—®é¢˜æ¸…å•"
            - "ä¿®æ”¹å»ºè®®"
          verdict: "é€šè¿‡/è¿”å·¥"
        åŠ¨ä½œ:
          - "è®°å½•å®¡æŸ¥ç»“è®º"
          - "å¦‚æœè¿”å·¥ï¼Œé€šçŸ¥ Code Agent"
          - "å¦‚æœé€šè¿‡ï¼Œé€šçŸ¥ Conductor é˜¶æ®µå®Œæˆ"
```

---

### Agent é’©å­é…ç½®æ ¼å¼

```yaml
agent_hook_config:

  # é…ç½®æ–‡ä»¶ä½ç½®
  location: ".orchestra/hooks/agent-hooks.yaml"

  # é…ç½®ç»“æ„
  format: |
    hooks:
      conductor:
        ProjectStart:
          - matcher: "*"
            command: "node scripts/project-init.js"
            priority: 1
        PhaseStart:
          - matcher: "phase == 'Plan'"
            command: "node scripts/phase-plan-start.js"
            priority: 1
        AgentSwitch:
          PreSwitch:
            - matcher: "*"
              command: "node scripts/agent-handover.js"

      agents:
        plan_agent:
          OnEnter:
            - command: "node scripts/plan-enter.js"
          OnConfirm:
            - command: "node scripts/plan-confirm.js"
              require_approval: true

        code_agent:
          OnGenerate:
            - command: "node scripts/apply-patterns.js"
              integration: "å²å®˜"
          OnSubmit:
            - command: "npx prettier --write ${files}"
            - command: "npx eslint ${files}"
            - command: "npm test -- --related ${files}"

        test_agent:
          OnVerify:
            - command: "node scripts/check-coverage.js"
              threshold: 80
              fail_on_low: true

        review_agent:
          OnIssue:
            - matcher: "severity == 'critical'"
              command: "node scripts/notify-critical.js"
              block: true

  # é’©å­è¾“å…¥æ ¼å¼
  input_format: |
    {
      "hook_type": "OnGenerate",
      "agent": "code_agent",
      "context": {
        "task": "...",
        "file_path": "...",
        ...
      }
    }

  # é’©å­è¾“å‡ºæ ¼å¼
  output_format: |
    stdout: "ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé’©å­æˆ– Agent"
    stderr: "æ˜¾ç¤ºç»™ç”¨æˆ·"
    exit_code:
      0: "ç»§ç»­"
      1: "é˜»æ­¢å½“å‰æ“ä½œ"
      2: "éœ€è¦ç”¨æˆ·ç¡®è®¤"
```

---

### é’©å­æ‰§è¡Œåè®®

```yaml
hook_execution_protocol:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  æ‰§è¡Œæ¨¡å¼
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  execution_modes:

    sync:
      æè¿°: "åŒæ­¥æ‰§è¡Œï¼Œç­‰å¾…å®Œæˆåç»§ç»­"
      é€‚ç”¨: "å…³é”®é’©å­ï¼ˆOnConfirm, OnContract, OnSubmitï¼‰"
      è¶…æ—¶: "30ç§’"
      è¶…æ—¶å¤„ç†: "æç¤ºç”¨æˆ·ï¼Œå¯é€‰æ‹©è·³è¿‡æˆ–é‡è¯•"

    async:
      æè¿°: "å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹"
      é€‚ç”¨: "æ—¥å¿—è®°å½•ã€é€šçŸ¥ç±»é’©å­"
      å›è°ƒ: "æ‰§è¡Œå®Œæˆåé€šè¿‡äº‹ä»¶é€šçŸ¥"

    parallel:
      æè¿°: "å¹¶è¡Œæ‰§è¡Œå¤šä¸ªé’©å­"
      é€‚ç”¨: "åŒä¸€è§¦å‘ç‚¹çš„å¤šä¸ªç‹¬ç«‹é’©å­"
      èšåˆ: "ç­‰å¾…æ‰€æœ‰å®Œæˆï¼Œä»»ä¸€å¤±è´¥åˆ™å¤±è´¥"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  æ‰§è¡Œé¡ºåº
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  execution_order:

    ä¼˜å…ˆçº§è§„åˆ™:
      - "priority æ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ"
      - "ç›¸åŒä¼˜å…ˆçº§æŒ‰é…ç½®é¡ºåºæ‰§è¡Œ"
      - "critical é’©å­ä¼˜å…ˆäºé critical"

    é“¾å¼æ‰§è¡Œ:
      æè¿°: "å‰ä¸€ä¸ªé’©å­çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªçš„è¾“å…¥"
      ç¤ºä¾‹: |
        Hook1 (æ ¼å¼åŒ–) â†’ Hook2 (ç±»å‹æ£€æŸ¥) â†’ Hook3 (lint)
        æ¯ä¸ªé’©å­å¯ä»¥ä¿®æ”¹å†…å®¹ä¼ é€’ç»™ä¸‹ä¸€ä¸ª

    çŸ­è·¯è§„åˆ™:
      - "exit_code == 1ï¼šåœæ­¢æ‰§è¡Œåç»­é’©å­ï¼Œé˜»æ­¢æ“ä½œ"
      - "exit_code == 2ï¼šæš‚åœï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤åç»§ç»­"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  å†²çªå¤„ç†
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  conflict_handling:

    åŒè§¦å‘ç‚¹å†²çª:
      åœºæ™¯: "ä¸¤ä¸ªé’©å­éƒ½è¦ä¿®æ”¹åŒä¸€å†…å®¹"
      å¤„ç†: "æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œï¼Œåæ‰§è¡Œçš„è¦†ç›–å…ˆæ‰§è¡Œçš„"
      è®°å½•: "åœ¨æ—¥å¿—ä¸­æ ‡è®°è¦†ç›–æƒ…å†µ"

    é˜»æ­¢å†²çª:
      åœºæ™¯: "ä¸€ä¸ªé’©å­é˜»æ­¢ï¼Œå¦ä¸€ä¸ªå…è®¸"
      å¤„ç†: "é˜»æ­¢ä¼˜å…ˆï¼ˆæ›´å®‰å…¨ï¼‰"
      è®°å½•: "è®°å½•å†²çªå†³ç­–"

    è¶…æ—¶å†²çª:
      åœºæ™¯: "é’©å­æ‰§è¡Œè¶…æ—¶"
      å¤„ç†:
        criticalé’©å­: "é‡è¯•ä¸€æ¬¡ï¼Œä»å¤±è´¥åˆ™é€šçŸ¥ç”¨æˆ·"
        écriticalé’©å­: "è®°å½•è­¦å‘Šï¼Œè·³è¿‡ç»§ç»­"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  é”™è¯¯å¤„ç†
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  error_handling:

    é’©å­æ‰§è¡Œå¤±è´¥:
      åŠ¨ä½œ:
        1: "è®°å½•é”™è¯¯åˆ°æ—¥å¿—"
        2: "æ ¹æ®é’©å­ç±»å‹å†³å®šåç»­"
        3: "critical é’©å­å¤±è´¥é˜»æ­¢æ“ä½œ"
        4: "é critical é’©å­å¤±è´¥å‘å‡ºè­¦å‘Š"

    é’©å­è„šæœ¬ä¸å­˜åœ¨:
      åŠ¨ä½œ:
        1: "è®°å½•è­¦å‘Š"
        2: "è·³è¿‡è¯¥é’©å­"
        3: "ä¸é˜»æ­¢ä¸»æµç¨‹"

    é’©å­è¾“å‡ºæ ¼å¼é”™è¯¯:
      åŠ¨ä½œ:
        1: "è®°å½•è­¦å‘Š"
        2: "ä½¿ç”¨åŸå§‹è¾“å…¥ç»§ç»­"
        3: "å»ºè®®æ£€æŸ¥é’©å­è„šæœ¬"
```

---

### ä¸ Agent é“å¾‹ç»‘å®š

```yaml
hook_law_binding:

  æè¿°: |
    é’©å­ä¸é“å¾‹ç»“åˆï¼Œé€šè¿‡é’©å­è‡ªåŠ¨æ£€æµ‹é“å¾‹è¿å

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Plan Agent é“å¾‹æ£€æµ‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  plan_agent_bindings:

    PA-01_æ£€æµ‹:
      é“å¾‹: "éœ€æ±‚å¿…è®¿é—®"
      é’©å­: "OnPlan"
      æ£€æµ‹: "æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®è®°å½•"
      è¿ååŠ¨ä½œ: "é˜»æ­¢è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæç¤ºéœ€è¦è®¿é—®"

    PA-02_æ£€æµ‹:
      é“å¾‹: "å‡è®¾å¿…ç¡®è®¤"
      é’©å­: "OnConfirm"
      æ£€æµ‹: "æ£€æŸ¥å‡è®¾åˆ—è¡¨æ˜¯å¦å·²æ ‡è®°ç¡®è®¤"
      è¿ååŠ¨ä½œ: "åˆ—å‡ºæœªç¡®è®¤å‡è®¾ï¼Œè¦æ±‚ç¡®è®¤"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Spec Agent é“å¾‹æ£€æµ‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  spec_agent_bindings:

    SA-01_æ£€æµ‹:
      é“å¾‹: "è§„æ ¼å¿…å®Œæ•´"
      é’©å­: "OnContract"
      æ£€æµ‹: "éªŒè¯è§„æ ¼å¿…å¡«å­—æ®µ"
      è¿ååŠ¨ä½œ: "åˆ—å‡ºç¼ºå¤±å­—æ®µï¼Œé˜»æ­¢ç”Ÿæˆå¥‘çº¦"

    SA-02_æ£€æµ‹:
      é“å¾‹: "å¥‘çº¦å¿…é”å®š"
      é’©å­: "OnExit"
      æ£€æµ‹: "æ£€æŸ¥å¥‘çº¦æ˜¯å¦å·²ç‰ˆæœ¬åŒ–"
      è¿ååŠ¨ä½œ: "å¼ºåˆ¶ç”Ÿæˆå¥‘çº¦ç‰ˆæœ¬"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Code Agent é“å¾‹æ£€æµ‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  code_agent_bindings:

    CA-11_æ£€æµ‹:
      é“å¾‹: "ç¦æ­¢è™šæŠ¥"
      é’©å­: "OnSubmit"
      æ£€æµ‹: "è¿è¡Œæµ‹è¯•éªŒè¯ä»£ç å¯ç”¨"
      è¿ååŠ¨ä½œ: "æµ‹è¯•å¤±è´¥åˆ™é˜»æ­¢æäº¤"

    CA-12_æ£€æµ‹:
      é“å¾‹: "ä»£ç å¿…æ‰§è¡Œ"
      é’©å­: "OnSubmit"
      æ£€æµ‹: "æ£€æŸ¥æ˜¯å¦æœ‰è¿è¡Œè¯æ®"
      è¿ååŠ¨ä½œ: "è¦æ±‚æä¾›è¿è¡Œè¯æ®"

    CA-17_æ£€æµ‹:
      é“å¾‹: "å¥‘çº¦é”å®šåä¸å¯æ”¹"
      é’©å­: "OnGenerate"
      æ£€æµ‹: "å¯¹æ¯”å¥‘çº¦ç‰ˆæœ¬"
      è¿ååŠ¨ä½œ: "æ£€æµ‹åˆ°å¥‘çº¦å˜æ›´ï¼Œè§¦å‘å˜æ›´æµç¨‹"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Test Agent é“å¾‹æ£€æµ‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  test_agent_bindings:

    TA-01_æ£€æµ‹:
      é“å¾‹: "æµ‹è¯•å¿…ç‹¬ç«‹"
      é’©å­: "OnExecute"
      æ£€æµ‹: "æ£€æŸ¥æµ‹è¯•é—´ä¾èµ–"
      è¿ååŠ¨ä½œ: "è­¦å‘Šå­˜åœ¨æµ‹è¯•ä¾èµ–"

    TA-02_æ£€æµ‹:
      é“å¾‹: "ç»“æœå¿…çœŸå®"
      é’©å­: "OnReport"
      æ£€æµ‹: "éªŒè¯æµ‹è¯•è¾“å‡ºä¸æŠ¥å‘Šä¸€è‡´"
      è¿ååŠ¨ä½œ: "æŠ¥å‘Šä¸å®é™…ä¸ç¬¦åˆ™é˜»æ­¢"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Review Agent é“å¾‹æ£€æµ‹
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  review_agent_bindings:

    RA-01_æ£€æµ‹:
      é“å¾‹: "Critical å¿…ä¿®å¤"
      é’©å­: "OnVerdict"
      æ£€æµ‹: "æ£€æŸ¥æ˜¯å¦æœ‰æœªå¤„ç†çš„ critical issue"
      è¿ååŠ¨ä½œ: "æœ‰ critical åˆ™é˜»æ­¢é€šè¿‡"

    RA-02_æ£€æµ‹:
      é“å¾‹: "å®¡æŸ¥å¿…å…¨é¢"
      é’©å­: "OnScan"
      æ£€æµ‹: "æ£€æŸ¥å®¡æŸ¥æ¸…å•å®Œæˆåº¦"
      è¿ååŠ¨ä½œ: "æœªå®Œæˆæ¸…å•åˆ™æç¤º"
```

---

### Agent é’©å­é“å¾‹è¡¥å……

```yaml
agent_hook_laws:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Agent é’©å­é“å¾‹ HK-05 ~ HK-12
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  HK-05:
    name: "Agent å…¥å£å¿…åˆå§‹åŒ–"
    rule: "OnEnter é’©å­å¿…é¡»æˆåŠŸæ‰§è¡Œï¼ŒAgent æ‰èƒ½å¼€å§‹å·¥ä½œ"
    violation: "è·³è¿‡ OnEnter ç›´æ¥å¼€å§‹å·¥ä½œ"
    consequence: "ä¸Šä¸‹æ–‡ç¼ºå¤±ï¼Œå¯èƒ½äº§ç”Ÿé”™è¯¯è¾“å‡º"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥ Agent å¯åŠ¨æ—¥å¿—"
        2: "æ˜¯å¦æœ‰ OnEnter æ‰§è¡Œè®°å½•"
        3: "æ— è®°å½• = è¿è§„"
      è¯æ®: "OnEnter æ‰§è¡Œæ—¥å¿—"

  HK-06:
    name: "Agent å‡ºå£å¿…äº¤æ¥"
    rule: "OnExit é’©å­å¿…é¡»éªŒè¯äº¤ä»˜ç‰©å®Œæ•´åæ‰èƒ½åˆ‡æ¢ Agent"
    violation: "æœªéªŒè¯äº¤ä»˜ç‰©å°±åˆ‡æ¢"
    consequence: "äº¤ä»˜ç‰©ä¸å®Œæ•´ï¼Œä¸‹æ¸¸ Agent æ— æ³•å·¥ä½œ"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥ Agent åˆ‡æ¢æ—¥å¿—"
        2: "æ˜¯å¦æœ‰ OnExit å®Œæˆè®°å½•"
        3: "æ˜¯å¦æœ‰äº¤ä»˜ç‰©éªŒè¯è®°å½•"
        4: "æ— è®°å½• = è¿è§„"
      è¯æ®: "OnExit å’Œäº¤ä»˜ç‰©éªŒè¯æ—¥å¿—"

  HK-07:
    name: "ç¡®è®¤é’©å­å¿…ç­‰å¾…"
    rule: "OnConfirm é’©å­å¿…é¡»ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼Œä¸å¯è‡ªåŠ¨è·³è¿‡"
    violation: "è‡ªåŠ¨ç¡®è®¤ç”¨æˆ·åº”è¯¥å®¡æ‰¹çš„å†…å®¹"
    consequence: "ç”¨æˆ·ä¸çŸ¥æƒ…ï¼Œå¯èƒ½åšå‡ºé”™è¯¯å†³ç­–"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥ç¡®è®¤æµç¨‹æ—¥å¿—"
        2: "OnConfirm æ˜¯å¦æœ‰ç”¨æˆ·äº¤äº’è®°å½•"
        3: "æ— äº¤äº’ = è¿è§„"
      è¯æ®: "ç”¨æˆ·ç¡®è®¤è®°å½•"

  HK-08:
    name: "å¥‘çº¦é’©å­å¿…é”å®š"
    rule: "OnContract é’©å­æ‰§è¡Œåï¼Œå¥‘çº¦å¿…é¡»ç”Ÿæˆç‰ˆæœ¬å¹¶é”å®š"
    violation: "å¥‘çº¦ç”Ÿæˆåæœªç‰ˆæœ¬åŒ–"
    consequence: "å¥‘çº¦å¯èƒ½è¢«ç¯¡æ”¹"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥å¥‘çº¦ç›®å½•"
        2: "æ˜¯å¦æœ‰ç‰ˆæœ¬åŒ–çš„å¥‘çº¦æ–‡ä»¶"
        3: "æ— ç‰ˆæœ¬ = è¿è§„"
      è¯æ®: "å¥‘çº¦ç‰ˆæœ¬æ–‡ä»¶"

  HK-09:
    name: "æäº¤é’©å­å¿…éªŒè¯"
    rule: "OnSubmit é’©å­å¿…é¡»è¿è¡ŒéªŒè¯ï¼ˆlintã€testï¼‰ï¼ŒéªŒè¯é€šè¿‡æ‰èƒ½æäº¤"
    violation: "è·³è¿‡éªŒè¯ç›´æ¥æäº¤"
    consequence: "æäº¤ä½è´¨é‡ä»£ç "
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥æäº¤å‰æ—¥å¿—"
        2: "æ˜¯å¦æœ‰ lint å’Œ test æ‰§è¡Œè®°å½•"
        3: "æ˜¯å¦éƒ½é€šè¿‡"
        4: "æ— è®°å½•æˆ–æœªé€šè¿‡ = è¿è§„"
      è¯æ®: "éªŒè¯æ‰§è¡Œç»“æœ"

  HK-10:
    name: "é—®é¢˜é’©å­å¿…è®°å½•"
    rule: "OnIssue é’©å­è§¦å‘æ—¶å¿…é¡»è®°å½•é—®é¢˜è¯¦æƒ…"
    violation: "å‘ç°é—®é¢˜ä½†æœªè®°å½•"
    consequence: "é—®é¢˜å¯èƒ½è¢«é—å¿˜"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥å®¡æŸ¥æ—¥å¿—"
        2: "æ¯ä¸ª OnIssue æ˜¯å¦æœ‰å¯¹åº”çš„é—®é¢˜è®°å½•"
        3: "æ— è®°å½• = è¿è§„"
      è¯æ®: "é—®é¢˜è®°å½•"

  HK-11:
    name: "åˆ‡æ¢é’©å­å¿…å®Œæ•´"
    rule: "AgentSwitch çš„ Pre/On/Post ä¸‰é˜¶æ®µå¿…é¡»å®Œæ•´æ‰§è¡Œ"
    violation: "åªæ‰§è¡Œéƒ¨åˆ†åˆ‡æ¢é’©å­"
    consequence: "çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ•°æ®ä¸¢å¤±"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥ Agent åˆ‡æ¢æ—¥å¿—"
        2: "Pre/On/Post æ˜¯å¦éƒ½æœ‰è®°å½•"
        3: "ç¼ºå°‘ä»»ä¸€ = è¿è§„"
      è¯æ®: "åˆ‡æ¢ä¸‰é˜¶æ®µæ—¥å¿—"

  HK-12:
    name: "é˜¶æ®µé’©å­å¿…é…å¯¹"
    rule: "PhaseStart å¿…é¡»æœ‰å¯¹åº”çš„ PhaseEndï¼Œä¸å¯åªå¼€å§‹ä¸ç»“æŸ"
    violation: "é˜¶æ®µå¼€å§‹åæœªæ­£å¸¸ç»“æŸ"
    consequence: "é˜¶æ®µçŠ¶æ€æ··ä¹±"
    æ£€æµ‹æ–¹æ³•:
      æ­¥éª¤:
        1: "æ£€æŸ¥é˜¶æ®µæ—¥å¿—"
        2: "æ¯ä¸ª PhaseStart æ˜¯å¦æœ‰å¯¹åº” PhaseEnd"
        3: "æ— é…å¯¹ = è¿è§„"
      è¯æ®: "é˜¶æ®µé…å¯¹è®°å½•"
```

---

### Agent é’©å­é¢„ç½®é…ç½®

```yaml
preset_agent_hooks:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Conductor å±‚é¢„ç½®é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  conductor_presets:

    project_start_init:
      hook: ProjectStart
      command: "node .orchestra/scripts/project-init.js"
      description: "åˆå§‹åŒ–é¡¹ç›®ç›®å½•å’Œé…ç½®"
      priority: 1

    phase_start_log:
      hook: PhaseStart
      command: "node .orchestra/scripts/phase-log.js"
      description: "è®°å½•é˜¶æ®µå¼€å§‹åˆ°å²å®˜"
      priority: 1

    agent_switch_handover:
      hook: AgentSwitch.PreSwitch
      command: "node .orchestra/scripts/agent-handover.js"
      description: "Agent åˆ‡æ¢å‰ä¿å­˜çŠ¶æ€å’ŒéªŒè¯äº¤ä»˜ç‰©"
      priority: 1

    agent_switch_verify:
      hook: AgentSwitch.PostSwitch
      command: "node .orchestra/scripts/verify-switch.js"
      description: "Agent åˆ‡æ¢åéªŒè¯çŠ¶æ€"
      priority: 1

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  #  Agent å±‚é¢„ç½®é’©å­
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  agent_presets:

    # Plan Agent
    plan_enter_load:
      agent: plan_agent
      hook: OnEnter
      command: "node .orchestra/scripts/plan/load-context.js"
      description: "åŠ è½½é¡¹ç›®ä¸Šä¸‹æ–‡å’Œå†å²éœ€æ±‚"

    plan_confirm_approval:
      agent: plan_agent
      hook: OnConfirm
      command: "node .orchestra/scripts/plan/request-approval.js"
      description: "è¯·æ±‚ç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ"
      require_approval: true

    # Spec Agent
    spec_contract_version:
      agent: spec_agent
      hook: OnContract
      command: "node .orchestra/scripts/spec/version-contract.js"
      description: "å¥‘çº¦ç‰ˆæœ¬åŒ–å’Œé”å®š"
      critical: true

    # Code Agent
    code_generate_patterns:
      agent: code_agent
      hook: OnGenerate
      command: "node .orchestra/scripts/code/apply-patterns.js"
      description: "åº”ç”¨å·²å­¦ä¹ çš„ä»£ç æ¨¡å¼"
      integration: "å²å®˜"

    code_submit_validate:
      agent: code_agent
      hook: OnSubmit
      commands:
        - "npx prettier --write ${files}"
        - "npx eslint ${files} --fix"
        - "npm test -- --related ${files}"
      description: "æäº¤å‰æ ¼å¼åŒ–ã€lintã€æµ‹è¯•"
      critical: true

    # Test Agent
    test_verify_coverage:
      agent: test_agent
      hook: OnVerify
      command: "node .orchestra/scripts/test/check-coverage.js"
      description: "æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡"
      config:
        threshold: 80
        fail_on_low: true

    # Review Agent
    review_issue_critical:
      agent: review_agent
      hook: OnIssue
      matcher: "severity == 'critical'"
      command: "node .orchestra/scripts/review/notify-critical.js"
      description: "Critical é—®é¢˜ç«‹å³é€šçŸ¥"
      block: true
```

---

### é’©å­ç³»ç»Ÿé“å¾‹æ±‡æ€»è¡¨ï¼ˆæ›´æ–°ï¼‰

| ç¼–å· | åç§° | æ ¸å¿ƒè¦æ±‚ | ç±»åˆ« |
|------|------|----------|------|
| HK-01 | å…³é”® Hook å¿…é¡»æ‰§è¡Œ | critical Hook å¿…é¡»æˆåŠŸ | åŸºç¡€ |
| HK-02 | Hook å¤±è´¥å¿…é¡»é€šçŸ¥ | å¤±è´¥æ—¶é€šçŸ¥ç”¨æˆ· | åŸºç¡€ |
| HK-03 | PreToolUse é˜»æ­¢å¿…é¡»è¯´æ˜åŸå›  | é˜»æ­¢éœ€æœ‰ç†ç”± | å·¥å…·å±‚ |
| HK-04 | Hook æ‰§è¡Œå¿…é¡»è®°å½•æ—¥å¿— | æ‰€æœ‰æ‰§è¡Œè®°å½•æ—¥å¿— | åŸºç¡€ |
| HK-05 | Agent å…¥å£å¿…åˆå§‹åŒ– | OnEnter å¿…é¡»æˆåŠŸ | Agentå±‚ |
| HK-06 | Agent å‡ºå£å¿…äº¤æ¥ | OnExit å¿…é¡»éªŒè¯äº¤ä»˜ç‰© | Agentå±‚ |
| HK-07 | ç¡®è®¤é’©å­å¿…ç­‰å¾… | OnConfirm å¿…é¡»ç”¨æˆ·äº¤äº’ | Agentå±‚ |
| HK-08 | å¥‘çº¦é’©å­å¿…é”å®š | OnContract å¿…é¡»ç‰ˆæœ¬åŒ– | Agentå±‚ |
| HK-09 | æäº¤é’©å­å¿…éªŒè¯ | OnSubmit å¿…é¡»è¿è¡ŒéªŒè¯ | Agentå±‚ |
| HK-10 | é—®é¢˜é’©å­å¿…è®°å½• | OnIssue å¿…é¡»è®°å½•é—®é¢˜ | Agentå±‚ |
| HK-11 | åˆ‡æ¢é’©å­å¿…å®Œæ•´ | Pre/On/Post ä¸‰é˜¶æ®µå®Œæ•´ | åˆ‡æ¢ |
| HK-12 | é˜¶æ®µé’©å­å¿…é…å¯¹ | Start/End å¿…é¡»é…å¯¹ | é˜¶æ®µ |

---

## ä¹ã€ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v2.0 | 2026-01-28 | æ–°å¢ï¼šAgent æ·±åº¦é›†æˆï¼ˆConductorå±‚é’©å­ã€Agentå±‚é’©å­ã€æ‰§è¡Œåè®®ã€é“å¾‹ç»‘å®šï¼‰ã€é“å¾‹ HK-05~HK-12 |
| v1.0 | 2026-01-24 | åˆå§‹ç‰ˆæœ¬ï¼š6 ç§ Hook ç±»å‹ã€é¢„ç½® Hooksã€ä¸å²å®˜å¯¹æ¥ã€4 æ¡é“å¾‹ |

---

**ğŸ”” é’©å­ç³»ç»Ÿï¼ˆå†…ä¾çœï¼‰Â· å®Œ**
