# 📖 永乐大典 · 用户操作手册

> 版本：v1.0
> 更新：2026-01-25
> 适用人群：使用永乐大典（Orchestra）体系的用户

---

## 📌 目录

1. [快速入门](#一快速入门)
2. [场景指南](#二场景指南)
3. [用户操作清单](#三用户操作清单)
4. [常见问题](#四常见问题)
5. [进阶指南](#五进阶指南)

---

## 一、快速入门

### 1.1 什么是永乐大典？

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  永乐大典（Orchestra）是一个 AI 多智能体协作框架                            │
│                                                                             │
│  你（皇上）只需要：                                                          │
│  1. 说出你的需求                                                            │
│  2. 回答 Agent 的问题                                                       │
│  3. 确认关键决策                                                            │
│  4. 最终验收产出                                                            │
│                                                                             │
│  Agent 团队会帮你：                                                         │
│  ✅ 梳理需求（Plan Agent）                                                  │
│  ✅ 设计规格（Spec Agent）                                                  │
│  ✅ 编写代码（Code Agent）                                                  │
│  ✅ 测试验收（Test Agent）                                                  │
│  ✅ 审查质量（Review Agent）                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 启动方式

#### 方式一：直接说需求

```
你："我想做一个博客系统"

→ 系统自动识别为新项目
→ 自动进入 Plan Agent 采访流程
```

#### 方式二：指定场景

```
你："帮我优化现有的博客项目，在 /path/to/blog"

→ 系统识别为已有项目
→ 先扫描项目再采访
```

#### 方式三：极简模式（小任务）

```
你："帮我写一个函数，判断字符串是否是回文"

→ 系统识别为简单任务
→ 直接执行，无需完整流程
```

### 1.3 核心原则

```yaml
你需要做的：
  - 回答问题（清晰表达你的需求）
  - 做决策（Agent 会问你选哪个方案）
  - 确认产出（每个阶段结束前确认）

你不需要做的：
  - 不需要懂技术细节（Agent 会帮你处理）
  - 不需要记住流程（Agent 会引导你）
  - 不需要写代码（除非你想）

你的权利：
  - 随时可以说"我不确定"（Agent 会给推荐）
  - 随时可以说"回到上一步"（支持回滚）
  - 随时可以说"改一下需求"（走变更流程）
```

---

## 二、场景指南

### 2.1 场景一：新项目开发

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  新项目开发流程                                                             │
│  ════════════════                                                           │
│                                                                             │
│  第1步：说出需求                                                            │
│  ─────────────────                                                          │
│  你："我想做一个博客系统"                                                   │
│                                                                             │
│  第2步：回答采访问题（Plan Agent）                                          │
│  ─────────────────────────────────                                          │
│  Agent 会问：                                                               │
│  • 主要功能有哪些？                                                         │
│  • 用户角色有几种？                                                         │
│  • 技术栈有偏好吗？                                                         │
│  • 有什么特殊要求？                                                         │
│                                                                             │
│  💡 如果你不确定，可以说："你推荐吧"                                        │
│                                                                             │
│  第3步：确认需求报告                                                        │
│  ─────────────────────                                                      │
│  Agent："以下是整理的需求，请皇上确认..."                                   │
│  你："确认" 或 "这里改一下..."                                              │
│                                                                             │
│  第4步：确认技术规格（Spec Agent）                                          │
│  ─────────────────────────────────                                          │
│  Agent："以下是 API 设计和数据模型，请皇上确认..."                          │
│  你："确认"                                                                 │
│                                                                             │
│  第5步：等待开发（Code Agent）                                              │
│  ─────────────────────────────                                              │
│  Agent 会分阶段开发，每个阶段完成后通知你                                   │
│  你可以查看进度，但一般不需要操作                                           │
│                                                                             │
│  第6步：验收产出                                                            │
│  ─────────────────                                                          │
│  Agent："代码已完成，测试通过，请皇上验收..."                               │
│  你：验收并提出修改意见（如有）                                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 场景二：已有项目迭代

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  已有项目迭代流程                                                           │
│  ════════════════════                                                       │
│                                                                             │
│  第1步：说明需求和项目位置                                                  │
│  ─────────────────────────────                                              │
│  你："帮我给博客系统加一个收藏功能，项目在 /path/to/blog"                   │
│                                                                             │
│  第2步：确认项目扫描结果                                                    │
│  ─────────────────────────                                                  │
│  Agent："扫描完成，发现以下现有功能..."                                     │
│  你："是的，理解正确" 或 "还有一些你没发现..."                              │
│                                                                             │
│  💡 注意：扫描结果会有置信度评分                                            │
│     如果看到 ⚠️ 标记，表示那项需要你确认                                    │
│                                                                             │
│  第3步：描述变更需求                                                        │
│  ─────────────────────                                                      │
│  Agent："请详细说明收藏功能的需求..."                                       │
│  你：描述功能细节                                                           │
│                                                                             │
│  第4步：确认变更方案                                                        │
│  ─────────────────────                                                      │
│  Agent："增量修改方案如下..."                                               │
│  你："确认"                                                                 │
│                                                                             │
│  第5步：等待实现 + 验收                                                     │
│  ─────────────────────────                                                  │
│  （与新项目类似）                                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 场景三：小任务（极简模式）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  什么算小任务？                                                             │
│  • 写一个函数                                                               │
│  • 修一个 bug                                                               │
│  • 改一行配置                                                               │
│  • 问一个技术问题                                                           │
│                                                                             │
│  小任务不需要走完整流程：                                                   │
│  你："帮我写一个判断回文的函数"                                             │
│  Agent：直接给出代码                                                        │
│                                                                             │
│  💡 如果 Agent 问太多问题，你可以说：                                       │
│     "这是个小任务，直接做就行"                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、用户操作清单

### 3.1 你需要说的话

| 场景 | 你可以说 | 效果 |
|------|----------|------|
| 开始新项目 | "我想做一个..." | 进入采访流程 |
| 迭代项目 | "帮我给 X 项目加..." | 先扫描再采访 |
| 不确定时 | "我不确定，你推荐吧" | Agent 给推荐方案 |
| 确认时 | "确认" / "可以" / "好的" | 进入下一步 |
| 需要修改时 | "这里改一下..." | Agent 记录修改 |
| 需要回滚时 | "回到上一步" / "重来" | 恢复到之前状态 |
| 催进度时 | "现在什么进度？" | Agent 汇报进度 |
| 小任务时 | "这是个小任务，直接做" | 跳过复杂流程 |

### 3.2 你需要做的决策

```yaml
采访阶段（Plan Agent）：
  - 功能范围（做什么/不做什么）
  - 用户角色（有哪些用户类型）
  - 技术偏好（如有）
  - 优先级排序

规格阶段（Spec Agent）：
  - API 设计确认
  - 数据模型确认
  - 架构方案选择（如有多个）

开发阶段（Code Agent）：
  - 一般不需要决策
  - 契约变更时需要确认

验收阶段（Test/Review Agent）：
  - 验收是否通过
  - 提出修改意见（如有）
```

### 3.3 你需要确认的东西

| 阶段 | 确认内容 | 确认方式 |
|------|----------|----------|
| Plan | 需求报告（Plan Report） | 说"确认"或提修改意见 |
| Spec | 技术规格（Tech Spec） | 说"确认"或提修改意见 |
| Spec | 契约锁定 | 说"确认锁定" |
| Code | Phase 完成 | 一般自动，有问题会通知 |
| Code | 契约变更（如有） | 批准/拒绝 |
| Test | 测试结果 | 查看报告 |
| Review | 审查结果 | 查看报告，决定是否修改 |

---

## 四、常见问题

### 4.1 "我只是想写个小脚本，需要这么复杂吗？"

不需要。你可以说：
- "这是个小任务，直接做"
- "简单点，不用走完整流程"
- "帮我写一个函数就行"

Agent 会识别并简化流程。

### 4.2 "这些 Agent 是自动切换还是我要手动调用？"

**自动切换**。你只需要：
1. 说出需求
2. 回答问题
3. 确认产出

Agent 之间的流转是自动的，你不需要管。

### 4.3 "如果我中途想改需求怎么办？"

两种情况：

**情况一：还没确认的**
- 直接说"这里改一下..."
- Agent 会更新记录

**情况二：已经确认/锁定的**
- 说"我要改一下之前确认的 X"
- Agent 会走变更流程
- 需要你再次确认

### 4.4 "怎么知道 Agent 有没有好好干活？"

1. **看进度**：说"现在什么进度？"
2. **看证据**：Agent 执行命令时会输出结果
3. **看报告**：每个阶段完成有总结报告
4. **铁律保障**：永乐大典有 110+ 条铁律约束 Agent 行为

### 4.5 "扫描结果有 ⚠️ 标记是什么意思？"

表示这项扫描结果**置信度较低**，需要你人工确认：
- 可能是非标准项目结构
- 可能是扫描器不确定
- 看到后请确认是否正确

### 4.6 "什么是契约变更？为什么要我批准？"

**契约** = API 接口 + 数据结构

一旦确认锁定，改动需要走流程：
- **兼容性变更**（新增功能）：自动批准，通知你
- **重大变更**（改现有接口）：需要你明确批准

这是为了防止改动破坏已有功能。

---

## 五、进阶指南

### 5.1 查看项目档案

所有记录都在 `.orchestra/` 目录：
```
.orchestra/
├── project.json          # 项目元信息
├── timeline.md           # 时间线
├── archives/             # 各阶段存档
│   ├── plan-stage-1/
│   ├── spec-stage-1/
│   └── ...
├── scans/                # 项目扫描结果
└── contracts/            # 契约快照
```

### 5.2 回滚到之前状态

说："帮我回滚到 [某个阶段/某个时间点]"

Agent 会：
1. 显示可用的快照列表
2. 让你选择回滚点
3. 执行回滚

### 5.3 查看学习技能

永乐大典会从会话中学习。你可以：
- "看看学到了什么技能"
- "禁用某个学习技能"
- "这个学习技能不对，删掉"

### 5.4 自定义流程

如果你想调整流程：
- "这个项目用快速模式"（2轮采访）
- "这个项目需要详细梳理"（4轮采访）
- "跳过测试阶段"（需确认风险）

---

## 📋 速查卡片

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  🎯 常用命令速查                                                            │
│  ═══════════════                                                            │
│                                                                             │
│  开始：                                                                     │
│  • "我想做一个 X"          → 新项目                                         │
│  • "帮我给 X 加 Y 功能"    → 迭代项目                                       │
│  • "写一个 X 函数"         → 小任务                                         │
│                                                                             │
│  确认：                                                                     │
│  • "确认" / "可以" / "好的"                                                 │
│                                                                             │
│  不确定：                                                                   │
│  • "你推荐吧"              → Agent 给推荐                                   │
│  • "都行"                  → Agent 选默认方案                               │
│                                                                             │
│  修改：                                                                     │
│  • "这里改一下..."         → 修改当前内容                                   │
│  • "回到上一步"            → 回滚                                           │
│  • "重来"                  → 从头开始                                       │
│                                                                             │
│  查询：                                                                     │
│  • "现在什么进度？"        → 查看进度                                       │
│  • "有什么问题吗？"        → 查看问题                                       │
│  • "给我看看代码"          → 查看产出                                       │
│                                                                             │
│  控制：                                                                     │
│  • "简单点做"              → 极简模式                                       │
│  • "详细梳理"              → 完整流程                                       │
│  • "暂停"                  → 暂停当前工作                                   │
│  • "继续"                  → 恢复工作                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.0 | 2026-01-25 | 初始版本：快速入门、场景指南、操作清单、常见问题、进阶指南 |

---

**📖 永乐大典 · 用户操作手册 · 完**
